import{v as _,w as F,L as w,x as T,y as H,z as B,A as R,D as j,j as o,E as P,F as N,P as M,G as I,H as O,I as V,r as h,J as $,u as z,K as U,M as Z,d as q}from"./index.js";import{C as G}from"./CardWithAnalytics.js";import{B as J,P as Q,L as X}from"./index3.js";import"./chartjs-adapter-moment.esm.js";import{L as v}from"./leaflet-src.js";import"./leaflet-heat.js";import{R as Y}from"./connection.js";import{s as D}from"./socket.js";import"./moment.js";_.register(F,w,T,H,B,R);const K=({top5Keywords:a})=>{const l=(a==null?void 0:a.map(p=>p[0]))||[],c=(a==null?void 0:a.map(p=>p[1]))||[],u={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{x:{grid:{display:!1},title:{display:!0},ticks:{color:j().theme.colors.gray[700],autoSkip:!1}},y:{grid:{display:!1},title:{display:!0,text:"Counts"},ticks:{beginAtZero:!0,color:j().theme.colors.gray[700]}}}},n={labels:l,datasets:[{barPercentage:.5,categoryPercentage:.5,label:"Count",data:c,backgroundColor:j().theme.colors.violet[500],hoverBackgroundColor:j().theme.colors.violet[600],borderRadius:4}]};return o.jsx("div",{className:"w-full mx-auto",style:{height:"300px"},children:o.jsx(J,{options:u,data:n})})};function W({top5Keywords:a}){return o.jsxs("div",{"data-name":"feature_dashboard_main_top5Keywords_chart",className:"flex flex-col col-span-full sm:col-span-6 xl:col-span-4 bg-white dark:bg-gray-800 shadow-xs rounded-xl",children:[o.jsx("header",{className:"px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:o.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Top 5 KeywordsÂ "})}),o.jsx(K,{top5Keywords:a})]})}_.register(P,B,R);const L=({projectsComparison:a})=>{const l=Object.entries(a||{}),c=(l==null?void 0:l.map(i=>i[0]))||[],u=(l==null?void 0:l.map(i=>i[1]))||[];N();const n=["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40"],p={labels:c,datasets:[{label:"Sentiment Percentage",data:u,backgroundColor:n,hoverBackgroundColor:n.map(i=>`${i}B3`),borderWidth:0}]},b={responsive:!0,plugins:{legend:{position:"top"},tooltip:{callbacks:{label:function(i){const t=i.label||"",r=i.raw||0;return`${t}: ${r}%`}}}}};return o.jsx("div",{style:{height:"300px",width:"300px",margin:"0 auto"},children:o.jsx(Q,{data:p,options:b})})};function aa({projectsComparison:a}){return o.jsxs("div",{"data-name":"feature_dashboard_main_projectComparison_chart",className:"flex flex-col col-span-full sm:col-span-6 xl:col-span-4 bg-white dark:bg-gray-800 shadow-xs rounded-xl",children:[o.jsx("header",{className:"px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:o.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Projects Comparison"})}),o.jsx(L,{projectsComparison:a})]})}_.register(F,w,M,I,H,B,R,O);const oa=({engagementLastWeek:a})=>{const l=(a==null?void 0:a.map(d=>d.date))||[],c=(a==null?void 0:a.map(d=>d.articles||0))||[],u=(a==null?void 0:a.map(d=>d.videos||0))||[],n=(a==null?void 0:a.map(d=>d.tweets||0))||[],p=(a==null?void 0:a.map(d=>d.screenshots||0))||[],{currentTheme:b}=N(),i=b==="dark",{textColor:t,gridColor:r,tooltipBodyColor:g,tooltipBgColor:C,tooltipBorderColor:e}=V,m={labels:l,datasets:[{label:"Articles",data:c,borderColor:"#60a5fa",backgroundColor:"rgba(96, 165, 250, 0.5)",fill:!0,pointBorderWidth:0,pointHoverBorderWidth:0,clip:20,tension:.2,borderWidth:2,pointRadius:0,pointHoverRadius:3},{label:"Videos",data:u,borderColor:"#f87171",backgroundColor:"rgba(248, 113, 113, 0.5)",fill:!0,pointBorderWidth:0,pointHoverBorderWidth:0,clip:20,tension:.2,borderWidth:2,pointRadius:0,pointHoverRadius:3},{label:"Tweets",data:n,borderColor:"#34d399",backgroundColor:"rgba(52, 211, 153, 0.5)",fill:!0,pointBorderWidth:0,pointHoverBorderWidth:0,clip:20,tension:.2,borderWidth:2,pointRadius:0,pointHoverRadius:3},{label:"Screenshots",data:p,borderColor:"#a78bfa",backgroundColor:"rgba(167, 139, 250, 0.5)",fill:!0,pointBorderWidth:0,pointHoverBorderWidth:0,clip:20,tension:.2,borderWidth:2,pointRadius:0,pointHoverRadius:3}]},x={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{color:i?t.dark:t.light}},tooltip:{callbacks:{label:function(d){return`${d.dataset.label}: ${d.raw}`}},backgroundColor:i?C.dark:C.light,bodyColor:i?g.dark:g.light,borderColor:i?e.dark:e.light}},scales:{x:{grid:{color:i?r.dark:r.light},title:{display:!0,text:"Date",color:i?t.dark:t.light},ticks:{color:i?t.dark:t.light,maxRotation:45,minRotation:45,autoSkip:!1}},y:{grid:{color:i?r.dark:r.light},title:{display:!0,text:"Counts",color:i?t.dark:t.light},ticks:{color:i?t.dark:t.light,stepSize:1,precision:0},beginAtZero:!0}}};return o.jsx("div",{className:"h-[305px]",children:o.jsx(X,{data:m,options:x})})};function ta({engagementLastWeek:a}){return o.jsxs("div",{"data-name":"feature_dashboard_main_engagementLastWeek_chart",className:"flex flex-col col-span-full sm:col-span-6 xl:col-span-4 bg-white dark:bg-gray-800 shadow-xs rounded-xl",children:[o.jsx("header",{className:"px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:o.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Engagement Last Week"})}),o.jsx(oa,{engagementLastWeek:a})]})}const ea=({geographicalDistribution:a})=>{const l=h.useRef(null),[c,u]=h.useState(null);return h.useEffect(()=>{if(!l.current||c)return;const n=v.map(l.current).setView([20,0],2);return v.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(n),u(n),()=>{n.remove(),u(null)}},[]),h.useEffect(()=>{if(!c||!a)return;const n=a==null?void 0:a.map(({lat:p,lng:b})=>[p,b,1e3]);v.heatLayer(n,{radius:60,blur:40,maxZoom:17,gradient:{.2:"blue",.5:"orange",.7:"yellow",.9:"red"}}).addTo(c)},[a,c]),o.jsx("div",{className:"bg-white dark:bg-slate-800 shadow-lg rounded-xl border border-slate-200 dark:border-slate-700",children:o.jsx("div",{ref:l,style:{height:"350px"}})})};function ha(){const a=$(),l=z(),c=l==null?void 0:l.userPermissions,u="module_dashboard",n="submodule_dashboard_main",p=h.useMemo(()=>U(c,u,n),[c]),[b,i]=h.useState(!1),{cardNumbers:t,graphAnalytics:r}=Z(e=>e.mainDashboard.main);h.useEffect(()=>{requestAnimationFrame(()=>{document.querySelectorAll("[data-name]").forEach(x=>{const d=x.getAttribute("data-name"),f=p.find(y=>y.id===d);f&&(f.enable||x.remove())})})},[p,b]);const g=async()=>{var e,m,x,d,f,y,k,S,A,E;a({type:"FETCH_MAIN_DASHBOARD_START"});try{const s=await Y.get(`${q}/api/main`);(s==null?void 0:s.status)===200&&a({type:"FETCH_MAIN_DASHBOARD_SUCCESS",payload:{cardNumbers:(m=(e=s==null?void 0:s.data)==null?void 0:e.data)==null?void 0:m.numbers,graphAnalytics:{top5Keywords:((d=(x=s==null?void 0:s.data)==null?void 0:x.data)==null?void 0:d.top5Keywords)||[],projectsComparison:((y=(f=s==null?void 0:s.data)==null?void 0:f.data)==null?void 0:y.projectsComparison)||[],engagementLastWeek:((S=(k=s==null?void 0:s.data)==null?void 0:k.data)==null?void 0:S.engagementLastWeek)||[],geographicalDistribution:((E=(A=s==null?void 0:s.data)==null?void 0:A.data)==null?void 0:E.geographicalDistribution)||[]}}})}catch(s){console.error(s),a({type:"FETCH_MAIN_DASHBOARD_FAILURE",payload:s.message})}};h.useEffect(()=>{g()},[]),h.useEffect(()=>(D.on("geographicalDistributionData",e=>{a({type:"FETCH_MAIN_DASHBOARD_SUCCESS",payload:{cardNumbers:t,graphAnalytics:{...r,geographicalDistribution:e}}})}),()=>{D.off("geographicalDistributionData")}),[a,t,r]);const C=[{title:"Total Points",value:(t==null?void 0:t.totalDataPoints)??0},{title:"Countries",value:(t==null?void 0:t.countries)??0},{title:"Sources",value:(t==null?void 0:t.sources)??0},{title:"Categories",value:(t==null?void 0:t.categories)??0}];return o.jsx(o.Fragment,{children:o.jsxs("div",{className:"grid grid-cols-12 gap-5 p-2",children:[C.map((e,m)=>o.jsx("div",{"data-name":"feature_dashboard_main_number_analytics",className:"col-span-12 sm:col-span-6 lg:col-span-3",children:o.jsx(G,{title:e==null?void 0:e.title,subTitle:e==null?void 0:e.subTitle,value:e==null?void 0:e.value,percentage:e==null?void 0:e.percentage},m)},m)),o.jsx("div",{className:"col-span-12 md:col-span-6",children:o.jsx(W,{top5Keywords:r==null?void 0:r.top5Keywords})}),o.jsx("div",{className:"col-span-12 md:col-span-6",children:o.jsx(aa,{projectsComparison:r==null?void 0:r.projectsComparison})}),o.jsxs("div",{className:"col-span-12 md:col-span-6",children:[" ",o.jsx(ta,{engagementLastWeek:r==null?void 0:r.engagementLastWeek})]}),o.jsx("div",{"data-name":"feature_dashboard_main_heatMap_chart",className:"col-span-12 md:col-span-6",children:o.jsx(ea,{geographicalDistribution:(r==null?void 0:r.geographicalDistribution)??[]})})]})})}export{ha as default};
