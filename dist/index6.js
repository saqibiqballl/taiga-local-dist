import{r as a,W as M,X as $,j as e,s as L,u as F,v as ae,w as le,L as re,x as ie,y as oe,z as ne,A as ce,D as de,V as me,B as z,aH as xe,b as K,K as pe}from"./index.js";import{I as B}from"./iconify.js";import{t as R}from"./toastr.js";import{D as he}from"./DropdownEditMenu.js";import{c as ue,a as O,o as fe}from"./index.esm2.js";import{u as ge,C as W}from"./index.esm.js";import{R as G}from"./index35.js";import{A as X}from"./placeholder.js";import{a as Y}from"./index.module.js";import{B as be}from"./Button.js";import{D as Z,a as J,b as Q,c as ee}from"./DialogTitle.js";import{G as q}from"./Grid.js";import{B as je}from"./index3.js";import{T as ve,a as ye}from"./Tabs.js";import{d as we}from"./GroupWork.js";import{R as se}from"./connection.js";import{D as Ne}from"./DeleteModal.js";import"./createSvgIcon2.js";import"./createSvgIcon.js";import"./resolveComponentProps.js";import"./IconButton.js";import"./Menu.js";import"./Modal.js";import"./Backdrop.js";import"./useTheme.js";import"./useSlotProps.js";import"./Paper.js";import"./Grow.js";import"./index34.js";import"./KeyboardArrowRight.js";function ke({selected:l,setSelected:v}){const[t,x]=a.useState([]),[b,y]=a.useState(!1),[w,g]=a.useState(""),[u,T]=a.useState(5),[j,p]=a.useState(1),[N,S]=a.useState(0),[C,_]=a.useState(0),[h,A]=a.useState(!1),[f,o]=a.useState([]),[m,n]=a.useState([]),[r]=Y(w,500);a.useEffect(()=>{o(l)},[l]),a.useEffect(()=>{v(f)},[f]),a.useEffect(()=>{const c=f.map(s=>`${s._id}`);n(c)},[f]),a.useEffect(()=>{A(!1)},[t]);const k=()=>{const c=t.map(i=>`${i._id}`),s=t;let d=[];if(f.forEach(i=>{d.push(i)}),h)d=d.filter(i=>!c.includes(`${i._id}`));else{let i=-1;s.forEach(D=>{i=d.findIndex(E=>E._id==D._id),i==-1&&(d=[...d,D])})}o(d),A(!h)},P=c=>{const{id:s,checked:d}=c.target;A(!1);const i=t.find(D=>D._id==s);o([...f,i]),d||o(f.filter(D=>D._id!=s))};a.useEffect(()=>{const c=setTimeout(()=>{b||I()},100);return()=>clearTimeout(c)},[r,j]),a.useEffect(()=>{p(1)},[r]);const I=async()=>{y(!0);try{const c={pageSize:u,page:j,searchValue:r},s=await M.post(`${$.sources}/getAdvancedSources`,c);if(s.status==200){const d=s.data.total;_(Math.ceil(d/u)),S(s.data.total),x(s.data.source)}y(!1)}catch{y(!1)}};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"",children:[e.jsx("div",{className:"sm:flex sm:justify-between sm:items-center mb-2",children:e.jsx("div",{className:"grid grid-flow-col sm:auto-cols-max justify-start sm:justify-end gap-2",children:e.jsx("input",{className:"form-input",placeholder:"Search...",value:w,onChange:c=>{g(c.target.value)}})})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-xs rounded-xl relative",children:[e.jsx("header",{className:"px-5 py-4",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("h2",{className:"font-semibold text-slate-700 dark:text-slate-100",children:["All Sources"," ",e.jsx("span",{className:"text-slate-400 dark:text-slate-500 font-medium",children:N})]}),e.jsx("h2",{className:"font-semibold text-slate-700 dark:text-slate-100",children:e.jsxs("span",{className:"text-slate-400 dark:text-slate-500 font-medium",children:[f.length," selected"]})})]})}),e.jsx("div",{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full dark:text-gray-300",children:[e.jsx("thead",{className:"text-xs font-semibold uppercase text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-900/20 border-t border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap w-px",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"inline-flex",children:[e.jsx("span",{className:"sr-only",children:"Select all"}),e.jsx("input",{className:"w-4 h-4 text-violet-600 bg-gray-100 border-gray-300 rounded focus:ring-violet-500 dark:focus:ring-violet-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-slate-300",type:"checkbox",checked:h,onChange:k})]})})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap"}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Label"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Domain"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Service"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold",children:"Media Type"})})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-slate-200 dark:divide-slate-700",children:t.map(c=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap w-px",children:e.jsx("div",{className:"flex items-center",children:e.jsx("label",{className:"inline-flex",children:e.jsx("input",{id:c._id,className:"w-4 h-4 text-violet-600 bg-gray-100 border-gray-300 rounded focus:ring-violet-500 dark:focus:ring-violet-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-slate-300",type:"checkbox",onChange:P,checked:m.includes(`${c._id}`)})})})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"w-10 h-10",children:c.logo?e.jsx("img",{className:"rounded-full w-full h-full object-cover",src:`${c.logo}`,alt:"Avatar"}):e.jsx("img",{className:"rounded-full w-full h-full object-cover",src:X,alt:"Avatar"})})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",style:{whiteSpace:"pre-wrap"},children:c.label})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:c.domain_name})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-center",children:c.service})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left font-medium text-sky-500",children:c.media_type})})]}))})]})})})]}),e.jsx("div",{className:"mt-8",children:e.jsx(G,{current:j,total:C,onPageChange:p})})]})})}L("img")(({theme:l})=>({width:100,height:100,marginRight:l.spacing(6),borderRadius:l.shape.borderRadius}));L(be)(({theme:l})=>({[l.breakpoints.down("sm")]:{width:"100%",textAlign:"center"}}));const Ce=ue().shape({name:O().required(),description:O().required()});function te({open:l,setOpen:v,data:t,reloadData:x}){const b=()=>v(!1),[y,w]=a.useState([]),[g,u]=a.useState(!1),[T,j]=a.useState([]),N=F().user.roles.map(m=>m._id),{register:S,reset:C,control:_,handleSubmit:h,setValue:A,formState:{errors:f}}=ge({defaultValues:{name:(t==null?void 0:t.name)||"",description:(t==null?void 0:t.description)||""},mode:"onChange",resolver:fe(Ce)});a.useEffect(()=>{const m={name:(t==null?void 0:t.name)||"",description:(t==null?void 0:t.description)||""};w((t==null?void 0:t.sources)||[]),j((t==null?void 0:t.sources)||[]),C(m)},[t,C]);const o=async m=>{var I,c;const n={};Object.keys(m).forEach(s=>{n[s]=m[s]?m[s]:""});var k=y.filter(s=>s.domain_name!=null),P=k.map(s=>({source_id:s._id,domain_name:s.domain_name}));n.sources=P,n.rolesIds=N;try{u(!0);let s;t!=null&&t.id?(n.id=t==null?void 0:t.id,s=await M.post(`${$.collection}/updateCollection/${t==null?void 0:t.id}`,n)):s=await M.post(`${$.collection}/createCollection`,n),s&&s.data&&s.data.message?(u(!1),R.success(s.data.message),b(),x&&x(),C({name:"",description:""})):(R.error("Unexpected response from server"),u(!1))}catch(s){console.error("Error:",s),R.error(((c=(I=s.response)==null?void 0:I.data)==null?void 0:c.message)||"Internal Error"),u(!1)}};return e.jsx(Z,{fullWidth:!0,open:l,onClose:b,maxWidth:"md",sx:{"& .MuiDialog-paper":{borderRadius:"10px"}},children:e.jsxs("form",{onSubmit:h(o),className:"bg-white dark:bg-gray-800 overflow-auto dark:text-slate-300",children:[e.jsx(J,{className:"sticky top-0 px-5 py-4 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700/60 z-10",children:e.jsx("h3",{className:"text-xl md:text-xl text-slate-700 dark:text-slate-100 font-bold",children:t!=null&&t.id?"Update Collection - "+(t==null?void 0:t.name):"Create Collection"})}),e.jsx(Q,{children:e.jsx(q,{container:!0,spacing:2,children:e.jsxs(q,{item:!0,md:12,children:[e.jsx(W,{name:"name",control:_,rules:{required:!0},render:({field:{value:m,onChange:n}})=>e.jsxs("div",{className:"w-full mb-3",children:[e.jsx("label",{className:"",children:"Name"}),e.jsx("input",{className:"form-input w-full mt-1",value:m,onChange:n}),f.name&&e.jsx("span",{className:"text-rose-500",children:f.name.message})]})}),e.jsx(W,{name:"description",control:_,rules:{required:!0},render:({field:{value:m,onChange:n}})=>e.jsxs("div",{className:"w-full mb-3",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{rows:4,className:"form-input w-full mt-1",value:m,onChange:n}),f.description&&e.jsx("span",{className:"text-rose-500",children:f.description.message})]})}),e.jsx(ke,{selected:T,setSelected:w})]})})}),e.jsxs(ee,{className:"sticky bottom-0 px-5 py-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700/60 z-10",children:[e.jsx("button",{className:"btn bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700/60 hover:border-gray-300 dark:hover:border-gray-600 text-gray-800 dark:text-gray-300",onClick:m=>{m.preventDefault(),m.stopPropagation(),b()},children:e.jsx("span",{className:"hidden xs:block ",children:"Cancel"})}),e.jsxs("button",{type:"submit",className:"btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white disabled:border-gray-200 dark:disabled:border-gray-700 disabled:bg-white dark:disabled:bg-gray-800 disabled:text-gray-300 dark:disabled:text-gray-600 disabled:cursor-not-allowed",disabled:g,children:[g&&e.jsx("svg",{className:"animate-spin fill-current shrink-0",width:"16",height:"16",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M8 16a7.928 7.928 0 01-3.428-.77l.857-1.807A6.006 6.006 0 0014 8c0-3.309-2.691-6-6-6a6.006 6.006 0 00-5.422 8.572l-1.806.859A7.929 7.929 0 010 8c0-4.411 3.589-8 8-8s8 3.589 8 8-3.589 8-8 8z"})}),"Save"]})]})]})})}ae.register(le,re,ie,oe,ne,ce);const Se=({collection_id:l})=>{const[v,t]=a.useState({labels:[],datasets:[]}),[x,b]=a.useState("1d"),[y,w]=a.useState(!1),g=de().theme.colors,u=g.violet,T=a.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},tooltip:{callbacks:{title:p=>v.labels[p[0].dataIndex]}}},scales:{x:{title:{display:!0,text:"Posts Counts"},grid:{display:!1},ticks:{color:g.gray[700],autoSkip:!1}},y:{grid:{display:!1},title:{display:!0,text:"Counts"},ticks:{beginAtZero:!0,color:g.gray[700]}}}}),[v.labels,g]),j=a.useCallback(async()=>{w(!0);try{const p={id:l,interval:x},N=await M.post(`${$.collection}/getChartData`,p);if(N.status===200&&Array.isArray(N.data.chartData)){const S=N.data.chartData,C=S.map(h=>h.key_as_string),_=S.map(h=>h.doc_count);t({labels:C,datasets:[{label:"Count",data:_,backgroundColor:u[500],hoverBackgroundColor:u[600],barPercentage:.66,categoryPercentage:.66}]})}}catch(p){console.error("Failed to fetch chart data",p)}finally{w(!1)}},[l,x,u]);return a.useEffect(()=>{j()},[j]),e.jsxs("div",{className:"flex flex-col col-span-full sm:col-span-6 xl:col-span-4 bg-white dark:bg-gray-800 shadow-xs rounded-xl",children:[e.jsxs("header",{className:"flex justify-between px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:[e.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Post Count Chart"}),e.jsxs("select",{className:"form-select text-sm dark:bg-gray-700 dark:text-white rounded-md",value:x,onChange:p=>b(p.target.value),children:[e.jsx("option",{value:"1d",children:"Day"}),e.jsx("option",{value:"1w",children:"Week"}),e.jsx("option",{value:"1M",children:"Month"}),e.jsx("option",{value:"1y",children:"Year"})]})]}),e.jsx("div",{className:"flex justify-center items-center h-[305px] p-4",children:y?e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"Loading chart..."}):e.jsx(je,{data:v,options:T})})]})};function _e({collection_id:l,sourceCount:v}){const[t,x]=a.useState([]),[b,y]=a.useState(!1),[w,g]=a.useState(""),[u,T]=a.useState(10),[j,p]=a.useState(1),[N,S]=a.useState(0),[C,_]=a.useState(0),[h,A]=a.useState({key:"total_feed",direction:"ascending"}),[f]=Y(w,500);a.useEffect(()=>{const r=setTimeout(()=>{b||o()},100);return()=>clearTimeout(r)},[f,j,h]),a.useEffect(()=>{p(1)},[f]);const o=async()=>{y(!0);try{const r={pageSize:u,page:j,searchValue:f,id:l,sortField:h.key,sortOrder:h.direction},k=await M.post(`${$.collection}/getCollectionSources`,r);if(k.status==200){const P=k.data.total;_(Math.ceil(P/u)),S(k.data.total),x(k.data.source)}y(!1)}catch{y(!1)}},m=r=>{let k="ascending";h.key,k=h.direction==="ascending"?"descending":"ascending",A({key:r,direction:k}),setConfig({key:r,direction:k})},n=r=>h.key===r?h.direction==="ascending"?"↑":"↓":"↕";return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 overflow-auto dark:text-slate-300",children:[e.jsx("div",{className:"sm:flex sm:justify-between sm:items-center mb-2",children:e.jsx("div",{className:"grid grid-flow-col sm:auto-cols-max justify-start sm:justify-end gap-2",children:e.jsx("input",{className:"form-input",placeholder:"Search...",value:w,onChange:r=>{g(r.target.value)}})})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-xs rounded-xl relative",children:[e.jsx("header",{className:"px-5 py-4",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("h2",{className:"font-semibold text-slate-700 dark:text-slate-100",children:["Sources"," ",e.jsx("span",{className:"text-slate-400 dark:text-slate-500 font-medium",children:N})]}),e.jsxs("h2",{className:"font-semibold text-slate-700 dark:text-slate-100",children:["Total"," ",e.jsx("span",{className:"text-slate-400 dark:text-slate-500 font-medium",children:v})]})]})}),e.jsx("div",{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full dark:text-gray-300",children:[e.jsx("thead",{className:"text-xs font-semibold uppercase text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-900/20 border-t border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap"}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Label"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Domain Name"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap cursor-pointer",onClick:()=>m("total_feed"),children:e.jsxs("div",{className:"font-semibold text-left",children:["Total Feeds ",n("total_feed")]})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap cursor-pointer",onClick:()=>m("total_post"),children:e.jsxs("div",{className:"font-semibold text-left",children:["Total Posts ",n("total_post")]})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap cursor-pointer",onClick:()=>m("total_post_last_week"),children:e.jsxs("div",{className:"font-semibold text-left",children:["Last Week Posts ",n("total_post_last_week")]})})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-slate-200 dark:divide-slate-700",children:t.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{style:{width:"40px"},children:r.logo?e.jsx("img",{className:"rounded-full w-full h-full object-cover",src:`${r.logo}`,style:{width:40,height:40,objectFit:"fill"},width:"40",height:"40",alt:"Avatar"}):e.jsx("img",{className:"rounded-full w-full h-full object-cover",src:X,width:"40",height:"40",alt:"Avatar"})})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",style:{whiteSpace:"pre-wrap"},children:e.jsx(me,{to:"//"+r.domain_name,target:"_blank",children:r.label})})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left font-medium text-emerald-500",children:r.domain_name})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left font-medium text-emerald-500",children:r.total_feed})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left font-medium text-emerald-500",children:r.total_post})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left font-medium text-emerald-500",children:r.total_post_last_week})})]}))})]})})})]}),e.jsx("div",{className:"mt-8",children:e.jsx(G,{current:j,total:C,onPageChange:p})})]})})}const De=L(l=>e.jsx(ve,{...l,TabIndicatorProps:{children:e.jsx("span",{className:"MuiTabs-indicatorSpan"})}}))({"& .MuiTabs-indicator":{display:"flex",justifyContent:"center",backgroundColor:"transparent"},"& .MuiTabs-indicatorSpan":{width:"100%",backgroundColor:"#6366f1"}}),U=L(l=>e.jsx(ye,{disableRipple:!0,...l}))(({theme:l})=>({fontWeight:l.typography.fontWeightRegular,fontSize:l.typography.pxToRem(15),marginRight:l.spacing(1),color:"#64748b",textTransform:"uppercase","&.Mui-selected":{color:"#6366f1"}}));function H(l){const{children:v,value:t,index:x,...b}=l;return e.jsx("div",{role:"tabpanel",hidden:t!==x,id:`simple-tabpanel-${x}`,"aria-labelledby":`simple-tab-${x}`,...b,children:t===x&&e.jsx(z,{sx:{p:3},children:e.jsx(e.Fragment,{children:v})})})}function Te({open:l,setOpen:v,data:t}){const[x,b]=a.useState(0);a.useEffect(()=>{b(0)},[t]);const y=(g,u)=>{b(u)},w=()=>v(!1);return e.jsx(Z,{fullWidth:!0,open:l,onClose:w,maxWidth:"md",sx:{"& .MuiDialog-paper":{borderRadius:"10px"}},children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 overflow-auto dark:text-slate-300",children:[e.jsx(J,{className:"sticky top-0 px-5 py-4 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700/60 z-10",children:e.jsxs("h3",{className:"text-xl md:text-xl text-slate-700 dark:text-slate-100 font-bold",children:["View Collection (",t==null?void 0:t.name,")"]})}),e.jsx(Q,{children:e.jsxs(z,{className:"mt-5",children:[e.jsx(z,{children:e.jsxs(De,{value:x,onChange:y,"aria-label":"styled tabs example",children:[e.jsx(U,{label:"Sources"}),e.jsx(U,{label:"Coverage Over Time"})]})}),e.jsx(H,{value:x,index:0,children:e.jsx("div",{className:"bg-white",children:e.jsx(_e,{collection_id:t==null?void 0:t._id,sourceCount:t==null?void 0:t.sourceCount})})}),e.jsx(H,{value:x,index:1,children:e.jsx(Se,{collection_id:t==null?void 0:t._id,width:389,height:450})})]})}),e.jsx(ee,{className:"sticky bottom-0 px-5 py-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700/60 z-10",children:e.jsx("button",{className:"btn bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700/60 hover:border-gray-300 dark:hover:border-gray-600 text-gray-800 dark:text-gray-300",onClick:g=>{g.preventDefault(),g.stopPropagation(),w()},children:e.jsx("span",{className:"hidden xs:block ",children:"Close"})})})]})})}const Ee="module_mediaCloud",Ae="submodule_mediaCloud_advanceCollections";function Pe({isSpinnerShow:l,setIsSpinnerShow:v,collections:t,permissionedFeatures:x,setCheckListRendered:b,reloadData:y}){const[w,g]=a.useState(!1),[u,T]=a.useState(!1),[j,p]=a.useState(!1),[N,S]=a.useState(),[C,_]=a.useState();xe();const h=K(),f=F().user.roles.map(s=>s._id),o=s=>{p(!0),S(s)},m=async()=>{M.delete(`${$.collection}/deleteCollection/${N==null?void 0:N._id}`,{data:{rolesIds:f}}).then(s=>{s.data.message?(R.success(s.data.message),se.delete(`/api/app_permission/module/${Ee}/submodule/${Ae}/feature/${N==null?void 0:N._id}`),y()):R.error("Settings Not Deleted")}).catch(s=>{console.log(s)}),S(null),p(!1)},n=async s=>{v(!0);try{const d={collection_id:s._id},i=await M.post(`${$.collection}/getCSVData`,d);i.status==200&&k(i.data.source),v(!1)}catch{v(!1)}},r=s=>{if(s.length===0)return"";const d=Object.keys(s[0]).join(",")+`
`,i=s.map(D=>Object.values(D).map(V=>typeof V=="string"&&V.includes(",")?`"${V}"`:V).join(",")).join(`
`);return d+i},k=s=>{const d=r(s),i=new Blob([d],{type:"text/csv"}),D=URL.createObjectURL(i),E=document.createElement("a");E.href=D,E.download="source_of_collection.csv",document.body.appendChild(E),E.click(),document.body.removeChild(E)},P=s=>{const d={};d.id=s._id,d.name=s.name,d.description=s.description;const E=s.sources.filter(V=>V.source_id!=null).map(V=>({_id:V.source_id,domain_name:V.domain_name}));d.sources=E,_(d),g(!0)},I=s=>{S(s),T(!0)},c=s=>{console.log(s._id),h(`/mediacloud/advanced-stories/${s._id}`)};return e.jsx("div",{children:(t==null?void 0:t.length)>0?e.jsx("div",{className:"grow",children:e.jsxs("div",{className:"p-6 p-space-y-6 ",children:[e.jsx("section",{className:"",children:e.jsx("div",{className:"grid grid-cols-12 gap-6",children:t==null?void 0:t.map((s,d)=>e.jsx("div",{"data-name":s._id,className:"col-span-full sm:col-span-6 xl:col-span-4 bg-white dark:bg-gray-800 shadow-xs rounded-xl",children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"grow p-5",children:[e.jsx("div",{className:"flex justify-between items-start",children:e.jsxs("div",{className:"flex mb-2 w-full",children:[e.jsxs(z,{className:"relative inline-flex items-start mr-5",children:[e.jsx("div",{className:"absolute top-0 right-0 -mr-2 bg-white dark:bg-slate-700 rounded-full shadow","aria-hidden":"true",children:e.jsx("svg",{className:"w-8 h-8 fill-current text-amber-500",viewBox:"0 0 32 32",children:e.jsx("path",{d:"M21 14.077a.75.75 0 01-.75-.75 1.5 1.5 0 00-1.5-1.5.75.75 0 110-1.5 1.5 1.5 0 001.5-1.5.75.75 0 111.5 0 1.5 1.5 0 001.5 1.5.75.75 0 010 1.5 1.5 1.5 0 00-1.5 1.5.75.75 0 01-.75.75zM14 24.077a1 1 0 01-1-1 4 4 0 00-4-4 1 1 0 110-2 4 4 0 004-4 1 1 0 012 0 4 4 0 004 4 1 1 0 010 2 4 4 0 00-4 4 1 1 0 01-1 1z"})})}),e.jsx(we,{className:"text-violet-500",sx:{fontSize:64}})]}),e.jsxs("div",{className:"mt-1 pr-1 flex-1 overflow-hidden mr-2",children:[e.jsx(z,{className:"inline-flex text-slate-700 dark:text-slate-100 hover:text-slate-900 dark:hover:text-slate-300",children:e.jsx("h2",{className:"text-xl leading-snug justify-center font-semibold",children:s==null?void 0:s.name})}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium text-slate-400 -mt-0.5 mr-1",children:"->"})," ",e.jsx("span",{children:s==null?void 0:s.sourceCount})]})]}),e.jsx("div",{className:"flex max-h-[33px]",children:e.jsxs(he,{align:"right",children:[e.jsx("li",{children:e.jsx("button",{"data-name":"feature_mediaCloud_advanceCollections_viewStories",className:"font-medium text-sm text-slate-600 dark:text-slate-300 hover:text-slate-700 dark:hover:text-slate-200 flex py-1 px-3",onClick:i=>{i.preventDefault(),c(s)},children:"View Stories"})}),e.jsx("li",{children:e.jsx("button",{"data-name":"feature_mediaCloud_advanceCollections_downloadCsv",className:`font-medium text-sm text-slate-600 dark:text-slate-300 hover:text-slate-700 dark:hover:text-slate-200 flex py-1 px-3 ${l?"line-through":""}`,onClick:i=>{i.preventDefault(),n(s)},disabled:l,children:"Download CSV"})}),e.jsx("li",{children:e.jsx("button",{"data-name":"feature_mediaCloud_advanceCollections_deleteCollection",className:"font-medium text-sm text-rose-500 hover:text-rose-600 flex py-1 px-3",onClick:i=>{o(s)},children:"Delete"})})]})})]})}),e.jsx("div",{className:"mt-2",children:e.jsx("div",{className:"test-sm ",children:s==null?void 0:s.description})})]}),e.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"flex divide-x divide-slate-200 dark:divide-slate-700",children:[e.jsx("button",{"data-name":"feature_mediaCloud_advanceCollections_viewCollection",className:"block flex-1 text-center text-sm text-violet-500 hover:text-violet-600 dark:hover:text-violet-400 font-medium px-3 py-4",onClick:i=>{i.preventDefault(),I(s)},children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(B,{icon:"carbon:view",width:"20",height:"20",className:"fill-current shrink-0 mr-2"}),e.jsx("span",{children:"View"})]})}),e.jsx("button",{"data-name":"feature_mediaCloud_advanceCollections_editCollection",className:"block flex-1 text-center text-sm hover:text-violet-600 dark:hover:text-violet-400 font-medium px-3 py-4",onClick:i=>{i.preventDefault(),P(s)},children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(B,{icon:"mdi:pencil",className:"text-xl"}),e.jsx("span",{children:"Edit"})]})})]})})]})},d))})}),e.jsx(Ne,{isOpen:j,onClose:s=>p(!1),onConfirm:s=>{m()}}),e.jsx(te,{open:w,setOpen:g,data:C,reloadData:y}),e.jsx(Te,{open:u,setOpen:T,data:N})]})}):l?"loading...":e.jsx("div",{className:"text-center w-full p-4 pt-10 pb-10",children:"No Data"})})}function cs(){K();const[l,v]=a.useState(""),[t,x]=a.useState(!1),b=F(),y=b==null?void 0:b.userPermissions,w="module_mediaCloud",g="submodule_mediaCloud_advanceCollections",u=a.useMemo(()=>pe(y,w,g),[y]),[T,j]=a.useState(!1),[p,N]=a.useState([]),[S,C]=a.useState(!1);b.user.roles.map(o=>o._id),a.useEffect(()=>{const o=()=>{document.querySelectorAll("[data-name]").forEach(n=>{const r=n.getAttribute("data-name"),k=u.find(P=>P.id===r);k&&(k.enable||n.remove())})};j(!1),requestAnimationFrame(o)},[u,T]);const _=()=>{x(!0)},h=async()=>{C(!0);try{const o=await M.post(`${$.collection}/getCollections`,{searchKey:l});o.status==200&&(N(o.data.collections),C(!1))}catch{C(!1)}j(!0)};a.useEffect(()=>{const o=setTimeout(()=>{h()},500);return()=>clearTimeout(o)},[l]);const A=async o=>{const m=o.map(n=>({id:n._id,project:!0,name:n.name,label:n.name,enable:n.enable||!1}));await se.post(`/api/app_permission/module/${w}/submodule/${g}/feature`,m),j(!0)};a.useEffect(()=>{p.length>0&&A(p)},[p]);const f=()=>{h(),j(!0)};return e.jsx("div",{className:"relative flex flex-col flex-1 overflow-y-auto overflow-x-hidden",children:e.jsxs("div",{className:"p-6 p-space-y-6",children:[e.jsxs("div",{className:"sm:flex sm:justify-between sm:items-center mb-8",children:[e.jsx("div",{className:"mb-4 sm:mb-0",children:e.jsx("h1",{className:"text-2xl md:text-3xl text-slate-700 dark:text-slate-100 font-bold",children:"Advanced Collections ✨"})}),e.jsxs("div",{className:"grid grid-flow-col sm:auto-cols-max justify-start sm:justify-end gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"action-search",className:"sr-only",children:"Search"}),e.jsx("input",{id:"action-search",className:"form-input pl-9 bg-white dark:bg-slate-800",type:"search",placeholder:"Search Collections",value:l,onChange:o=>v(o.target.value)}),e.jsx("button",{className:"absolute inset-0 right-auto group",type:"submit","aria-label":"Search",children:e.jsxs("svg",{className:"w-4 h-4 shrink-0 fill-current text-slate-400 dark:text-slate-500 group-hover:text-slate-500 dark:group-hover:text-slate-400 ml-3 mr-2",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M7 14c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7zM7 2C4.243 2 2 4.243 2 7s2.243 5 5 5 5-2.243 5-5-2.243-5-5-5z"}),e.jsx("path",{d:"M15.707 14.293L13.314 11.9a8.019 8.019 0 01-1.414 1.414l2.393 2.393a.997.997 0 001.414 0 .999.999 0 000-1.414z"})]})})]}),e.jsxs("button",{"data-name":"feature_mediaCloud_advanceCollections_addCollection",className:"btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white",onClick:o=>{o.preventDefault(),_()},children:[e.jsx("svg",{className:"w-4 h-4 fill-current opacity-50 shrink-0",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15 7H9V1c0-.6-.4-1-1-1S7 .4 7 1v6H1c-.6 0-1 .4-1 1s.4 1 1 1h6v6c0 .6.4 1 1 1s1-.4 1-1V9h6c.6 0 1-.4 1-1s-.4-1-1-1z"})}),e.jsx("span",{className:"hidden xs:block ml-2",children:"Add Collection"})]})]})]}),e.jsx("div",{className:"dark:bg-slate-800  mb-8",children:e.jsx("div",{className:"flex flex-col ",children:e.jsx(Pe,{collections:p,isSpinnerShow:S,setIsSpinnerShow:C,permissionedFeatures:u,setCheckListRendered:j,searchKey:l,reloadData:f})})}),e.jsx(te,{open:t,setOpen:x,reloadData:f,isSpinnerShow:S})]})})}export{cs as default};
