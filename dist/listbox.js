import{r as c,az as Q}from"./index.js";import{b as q,a as E,o as b,O as _,U as $,y as F,u as D,p as z,x as Oe,C,c as X}from"./render.js";import{h as oe,T as ie,a as Re,e as Le,u as Se,s as ye,I as V,o as Ie,b as O,r as we,c as Te}from"./Check.js";import{s as Pe,d as j,u as Ee}from"./open-closed.js";function ae(e,o){let[t,i]=c.useState(e),a=q(e);return E(()=>i(a.current),[a,i,...o]),t}function De(){return/iPhone/gi.test(window.navigator.platform)||/Mac/gi.test(window.navigator.platform)&&window.navigator.maxTouchPoints>0}function $e(){return/Android/gi.test(window.navigator.userAgent)}function Fe(){return De()||$e()}function U(e,o,t){let i=q(o);c.useEffect(()=>{function a(n){i.current(n)}return document.addEventListener(e,a,t),()=>document.removeEventListener(e,a,t)},[e,t])}function Ce(e,o,t){let i=q(o);c.useEffect(()=>{function a(n){i.current(n)}return window.addEventListener(e,a,t),()=>window.removeEventListener(e,a,t)},[e,t])}function ke(e,o,t=!0){let i=c.useRef(!1);c.useEffect(()=>{requestAnimationFrame(()=>{i.current=t})},[t]);function a(r,l){if(!i.current||r.defaultPrevented)return;let s=l(r);if(s===null||!s.getRootNode().contains(s)||!s.isConnected)return;let g=function v(f){return typeof f=="function"?v(f()):Array.isArray(f)||f instanceof Set?f:[f]}(e);for(let v of g){if(v===null)continue;let f=v instanceof HTMLElement?v:v.current;if(f!=null&&f.contains(s)||r.composed&&r.composedPath().includes(f))return}return!oe(s,ie.Loose)&&s.tabIndex!==-1&&r.preventDefault(),o(r,s)}let n=c.useRef(null);U("pointerdown",r=>{var l,s;i.current&&(n.current=((s=(l=r.composedPath)==null?void 0:l.call(r))==null?void 0:s[0])||r.target)},!0),U("mousedown",r=>{var l,s;i.current&&(n.current=((s=(l=r.composedPath)==null?void 0:l.call(r))==null?void 0:s[0])||r.target)},!0),U("click",r=>{Fe()||n.current&&(a(r,()=>n.current),n.current=null)},!0),U("touchend",r=>a(r,()=>r.target instanceof HTMLElement?r.target:null),!0),Ce("blur",r=>a(r,()=>window.document.activeElement instanceof HTMLIFrameElement?window.document.activeElement:null),!0)}function ee(e){var o;if(e.type)return e.type;let t=(o=e.as)!=null?o:"button";if(typeof t=="string"&&t.toLowerCase()==="button")return"button"}function Ae(e,o){let[t,i]=c.useState(()=>ee(e));return E(()=>{i(ee(e))},[e.type,e.as]),E(()=>{t||o.current&&o.current instanceof HTMLButtonElement&&!o.current.hasAttribute("type")&&i("button")},[t,o]),t}function te(e){return[e.screenX,e.screenY]}function Me(){let e=c.useRef([-1,-1]);return{wasMoved(o){let t=te(o);return e.current[0]===t[0]&&e.current[1]===t[1]?!1:(e.current=t,!0)},update(o){e.current=te(o)}}}function Ne(e){throw new Error("Unexpected object: "+e)}var y=(e=>(e[e.First=0]="First",e[e.Previous=1]="Previous",e[e.Next=2]="Next",e[e.Last=3]="Last",e[e.Specific=4]="Specific",e[e.Nothing=5]="Nothing",e))(y||{});function Be(e,o){let t=o.resolveItems();if(t.length<=0)return null;let i=o.resolveActiveIndex(),a=i??-1;switch(e.focus){case 0:{for(let n=0;n<t.length;++n)if(!o.resolveDisabled(t[n],n,t))return n;return i}case 1:{for(let n=a-1;n>=0;--n)if(!o.resolveDisabled(t[n],n,t))return n;return i}case 2:{for(let n=a+1;n<t.length;++n)if(!o.resolveDisabled(t[n],n,t))return n;return i}case 3:{for(let n=t.length-1;n>=0;--n)if(!o.resolveDisabled(t[n],n,t))return n;return i}case 4:{for(let n=0;n<t.length;++n)if(o.resolveId(t[n],n,t)===e.id)return n;return i}case 5:return null;default:Ne(e)}}let re=/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g;function ne(e){var o,t;let i=(o=e.innerText)!=null?o:"",a=e.cloneNode(!0);if(!(a instanceof HTMLElement))return i;let n=!1;for(let l of a.querySelectorAll('[hidden],[aria-hidden],[role="img"]'))l.remove(),n=!0;let r=n?(t=a.innerText)!=null?t:"":i;return re.test(r)&&(r=r.replace(re,"")),r}function He(e){let o=e.getAttribute("aria-label");if(typeof o=="string")return o.trim();let t=e.getAttribute("aria-labelledby");if(t){let i=t.split(" ").map(a=>{let n=document.getElementById(a);if(n){let r=n.getAttribute("aria-label");return typeof r=="string"?r.trim():ne(n).trim()}return null}).filter(Boolean);if(i.length>0)return i.join(", ")}return ne(e).trim()}function Qe(e){let o=c.useRef(""),t=c.useRef("");return b(()=>{let i=e.current;if(!i)return"";let a=i.innerText;if(o.current===a)return t.current;let n=He(i).trim().toLowerCase();return o.current=a,t.current=n,n})}var Ue=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(Ue||{}),ze=(e=>(e[e.Single=0]="Single",e[e.Multi=1]="Multi",e))(ze||{}),je=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(je||{}),qe=(e=>(e[e.OpenListbox=0]="OpenListbox",e[e.CloseListbox=1]="CloseListbox",e[e.GoToOption=2]="GoToOption",e[e.Search=3]="Search",e[e.ClearSearch=4]="ClearSearch",e[e.RegisterOption=5]="RegisterOption",e[e.UnregisterOption=6]="UnregisterOption",e[e.RegisterLabel=7]="RegisterLabel",e))(qe||{});function W(e,o=t=>t){let t=e.activeOptionIndex!==null?e.options[e.activeOptionIndex]:null,i=Te(o(e.options.slice()),n=>n.dataRef.current.domRef.current),a=t?i.indexOf(t):null;return a===-1&&(a=null),{options:i,activeOptionIndex:a}}let Ve={1(e){return e.dataRef.current.disabled||e.listboxState===1?e:{...e,activeOptionIndex:null,listboxState:1}},0(e){if(e.dataRef.current.disabled||e.listboxState===0)return e;let o=e.activeOptionIndex,{isSelected:t}=e.dataRef.current,i=e.options.findIndex(a=>t(a.dataRef.current.value));return i!==-1&&(o=i),{...e,listboxState:0,activeOptionIndex:o}},2(e,o){var t;if(e.dataRef.current.disabled||e.listboxState===1)return e;let i=W(e),a=Be(o,{resolveItems:()=>i.options,resolveActiveIndex:()=>i.activeOptionIndex,resolveId:n=>n.id,resolveDisabled:n=>n.dataRef.current.disabled});return{...e,...i,searchQuery:"",activeOptionIndex:a,activationTrigger:(t=o.trigger)!=null?t:1}},3:(e,o)=>{if(e.dataRef.current.disabled||e.listboxState===1)return e;let t=e.searchQuery!==""?0:1,i=e.searchQuery+o.value.toLowerCase(),a=(e.activeOptionIndex!==null?e.options.slice(e.activeOptionIndex+t).concat(e.options.slice(0,e.activeOptionIndex+t)):e.options).find(r=>{var l;return!r.dataRef.current.disabled&&((l=r.dataRef.current.textValue)==null?void 0:l.startsWith(i))}),n=a?e.options.indexOf(a):-1;return n===-1||n===e.activeOptionIndex?{...e,searchQuery:i}:{...e,searchQuery:i,activeOptionIndex:n,activationTrigger:1}},4(e){return e.dataRef.current.disabled||e.listboxState===1||e.searchQuery===""?e:{...e,searchQuery:""}},5:(e,o)=>{let t={id:o.id,dataRef:o.dataRef},i=W(e,a=>[...a,t]);return e.activeOptionIndex===null&&e.dataRef.current.isSelected(o.dataRef.current.value)&&(i.activeOptionIndex=i.options.indexOf(t)),{...e,...i}},6:(e,o)=>{let t=W(e,i=>{let a=i.findIndex(n=>n.id===o.id);return a!==-1&&i.splice(a,1),i});return{...e,...t,activationTrigger:1}},7:(e,o)=>({...e,labelId:o.id})},Y=c.createContext(null);Y.displayName="ListboxActionsContext";function k(e){let o=c.useContext(Y);if(o===null){let t=new Error(`<${e} /> is missing a parent <Listbox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,k),t}return o}let J=c.createContext(null);J.displayName="ListboxDataContext";function A(e){let o=c.useContext(J);if(o===null){let t=new Error(`<${e} /> is missing a parent <Listbox /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,A),t}return o}function Ge(e,o){return D(o.type,Ve,e,o)}let Ke=c.Fragment;function We(e,o){let{value:t,defaultValue:i,form:a,name:n,onChange:r,by:l=(d,p)=>d===p,disabled:s=!1,horizontal:g=!1,multiple:v=!1,...f}=e;const P=g?"horizontal":"vertical";let w=F(o),[R=v?[]:void 0,I]=Re(t,r,i),[m,u]=c.useReducer(Ge,{dataRef:c.createRef(),listboxState:1,options:[],searchQuery:"",labelId:null,activeOptionIndex:null,activationTrigger:1}),h=c.useRef({static:!1,hold:!1}),M=c.useRef(null),N=c.useRef(null),G=c.useRef(null),L=b(typeof l=="string"?(d,p)=>{let S=l;return(d==null?void 0:d[S])===(p==null?void 0:p[S])}:l),T=c.useCallback(d=>D(x.mode,{1:()=>R.some(p=>L(p,d)),0:()=>L(R,d)}),[R]),x=c.useMemo(()=>({...m,value:R,disabled:s,mode:v?1:0,orientation:P,compare:L,isSelected:T,optionsPropsRef:h,labelRef:M,buttonRef:N,optionsRef:G}),[R,s,v,m]);E(()=>{m.dataRef.current=x},[x]),ke([x.buttonRef,x.optionsRef],(d,p)=>{var S;u({type:1}),oe(p,ie.Loose)||(d.preventDefault(),(S=x.buttonRef.current)==null||S.focus())},x.listboxState===0);let le=c.useMemo(()=>({open:x.listboxState===0,disabled:s,value:R}),[x,s,R]),ue=b(d=>{let p=x.options.find(S=>S.id===d);p&&K(p.dataRef.current.value)}),se=b(()=>{if(x.activeOptionIndex!==null){let{dataRef:d,id:p}=x.options[x.activeOptionIndex];K(d.current.value),u({type:2,focus:y.Specific,id:p})}}),ce=b(()=>u({type:0})),de=b(()=>u({type:1})),pe=b((d,p,S)=>d===y.Specific?u({type:2,focus:y.Specific,id:p,trigger:S}):u({type:2,focus:d,trigger:S})),fe=b((d,p)=>(u({type:5,id:d,dataRef:p}),()=>u({type:6,id:d}))),ve=b(d=>(u({type:7,id:d}),()=>u({type:7,id:null}))),K=b(d=>D(x.mode,{0(){return I==null?void 0:I(d)},1(){let p=x.value.slice(),S=p.findIndex(H=>L(H,d));return S===-1?p.push(d):p.splice(S,1),I==null?void 0:I(p)}})),be=b(d=>u({type:3,value:d})),xe=b(()=>u({type:4})),ge=c.useMemo(()=>({onChange:K,registerOption:fe,registerLabel:ve,goToOption:pe,closeListbox:de,openListbox:ce,selectActiveOption:se,selectOption:ue,search:be,clearSearch:xe}),[]),me={ref:w},B=c.useRef(null),he=z();return c.useEffect(()=>{B.current&&i!==void 0&&he.addEventListener(B.current,"reset",()=>{I==null||I(i)})},[B,I]),Q.createElement(Y.Provider,{value:ge},Q.createElement(J.Provider,{value:x},Q.createElement(Pe,{value:D(x.listboxState,{0:j.Open,1:j.Closed})},n!=null&&R!=null&&Le({[n]:R}).map(([d,p],S)=>Q.createElement(Se,{features:ye.Hidden,ref:S===0?H=>{var Z;B.current=(Z=H==null?void 0:H.closest("form"))!=null?Z:null}:void 0,...Oe({key:d,as:"input",type:"hidden",hidden:!0,readOnly:!0,form:a,disabled:s,name:d,value:p})})),C({ourProps:me,theirProps:f,slot:le,defaultTag:Ke,name:"Listbox"}))))}let Xe="button";function Ye(e,o){var t;let i=V(),{id:a=`headlessui-listbox-button-${i}`,...n}=e,r=A("Listbox.Button"),l=k("Listbox.Button"),s=F(r.buttonRef,o),g=z(),v=b(m=>{switch(m.key){case O.Space:case O.Enter:case O.ArrowDown:m.preventDefault(),l.openListbox(),g.nextFrame(()=>{r.value||l.goToOption(y.First)});break;case O.ArrowUp:m.preventDefault(),l.openListbox(),g.nextFrame(()=>{r.value||l.goToOption(y.Last)});break}}),f=b(m=>{switch(m.key){case O.Space:m.preventDefault();break}}),P=b(m=>{if(we(m.currentTarget))return m.preventDefault();r.listboxState===0?(l.closeListbox(),g.nextFrame(()=>{var u;return(u=r.buttonRef.current)==null?void 0:u.focus({preventScroll:!0})})):(m.preventDefault(),l.openListbox())}),w=ae(()=>{if(r.labelId)return[r.labelId,a].join(" ")},[r.labelId,a]),R=c.useMemo(()=>({open:r.listboxState===0,disabled:r.disabled,value:r.value}),[r]),I={ref:s,id:a,type:Ae(e,r.buttonRef),"aria-haspopup":"listbox","aria-controls":(t=r.optionsRef.current)==null?void 0:t.id,"aria-expanded":r.listboxState===0,"aria-labelledby":w,disabled:r.disabled,onKeyDown:v,onKeyUp:f,onClick:P};return C({ourProps:I,theirProps:n,slot:R,defaultTag:Xe,name:"Listbox.Button"})}let Je="label";function Ze(e,o){let t=V(),{id:i=`headlessui-listbox-label-${t}`,...a}=e,n=A("Listbox.Label"),r=k("Listbox.Label"),l=F(n.labelRef,o);E(()=>r.registerLabel(i),[i]);let s=b(()=>{var v;return(v=n.buttonRef.current)==null?void 0:v.focus({preventScroll:!0})}),g=c.useMemo(()=>({open:n.listboxState===0,disabled:n.disabled}),[n]);return C({ourProps:{ref:l,id:i,onClick:s},theirProps:a,slot:g,defaultTag:Je,name:"Listbox.Label"})}let _e="ul",et=_.RenderStrategy|_.Static;function tt(e,o){var t;let i=V(),{id:a=`headlessui-listbox-options-${i}`,...n}=e,r=A("Listbox.Options"),l=k("Listbox.Options"),s=F(r.optionsRef,o),g=z(),v=z(),f=Ee(),P=(()=>f!==null?(f&j.Open)===j.Open:r.listboxState===0)();c.useEffect(()=>{var u;let h=r.optionsRef.current;h&&r.listboxState===0&&h!==((u=Ie(h))==null?void 0:u.activeElement)&&h.focus({preventScroll:!0})},[r.listboxState,r.optionsRef]);let w=b(u=>{switch(v.dispose(),u.key){case O.Space:if(r.searchQuery!=="")return u.preventDefault(),u.stopPropagation(),l.search(u.key);case O.Enter:if(u.preventDefault(),u.stopPropagation(),r.activeOptionIndex!==null){let{dataRef:h}=r.options[r.activeOptionIndex];l.onChange(h.current.value)}r.mode===0&&(l.closeListbox(),X().nextFrame(()=>{var h;return(h=r.buttonRef.current)==null?void 0:h.focus({preventScroll:!0})}));break;case D(r.orientation,{vertical:O.ArrowDown,horizontal:O.ArrowRight}):return u.preventDefault(),u.stopPropagation(),l.goToOption(y.Next);case D(r.orientation,{vertical:O.ArrowUp,horizontal:O.ArrowLeft}):return u.preventDefault(),u.stopPropagation(),l.goToOption(y.Previous);case O.Home:case O.PageUp:return u.preventDefault(),u.stopPropagation(),l.goToOption(y.First);case O.End:case O.PageDown:return u.preventDefault(),u.stopPropagation(),l.goToOption(y.Last);case O.Escape:return u.preventDefault(),u.stopPropagation(),l.closeListbox(),g.nextFrame(()=>{var h;return(h=r.buttonRef.current)==null?void 0:h.focus({preventScroll:!0})});case O.Tab:u.preventDefault(),u.stopPropagation();break;default:u.key.length===1&&(l.search(u.key),v.setTimeout(()=>l.clearSearch(),350));break}}),R=ae(()=>{var u;return(u=r.buttonRef.current)==null?void 0:u.id},[r.buttonRef.current]),I=c.useMemo(()=>({open:r.listboxState===0}),[r]),m={"aria-activedescendant":r.activeOptionIndex===null||(t=r.options[r.activeOptionIndex])==null?void 0:t.id,"aria-multiselectable":r.mode===1?!0:void 0,"aria-labelledby":R,"aria-orientation":r.orientation,id:a,onKeyDown:w,role:"listbox",tabIndex:0,ref:s};return C({ourProps:m,theirProps:n,slot:I,defaultTag:_e,features:et,visible:P,name:"Listbox.Options"})}let rt="li";function nt(e,o){let t=V(),{id:i=`headlessui-listbox-option-${t}`,disabled:a=!1,value:n,...r}=e,l=A("Listbox.Option"),s=k("Listbox.Option"),g=l.activeOptionIndex!==null?l.options[l.activeOptionIndex].id===i:!1,v=l.isSelected(n),f=c.useRef(null),P=Qe(f),w=q({disabled:a,value:n,domRef:f,get textValue(){return P()}}),R=F(o,f);E(()=>{if(l.listboxState!==0||!g||l.activationTrigger===0)return;let L=X();return L.requestAnimationFrame(()=>{var T,x;(x=(T=f.current)==null?void 0:T.scrollIntoView)==null||x.call(T,{block:"nearest"})}),L.dispose},[f,g,l.listboxState,l.activationTrigger,l.activeOptionIndex]),E(()=>s.registerOption(i,w),[w,i]);let I=b(L=>{if(a)return L.preventDefault();s.onChange(n),l.mode===0&&(s.closeListbox(),X().nextFrame(()=>{var T;return(T=l.buttonRef.current)==null?void 0:T.focus({preventScroll:!0})}))}),m=b(()=>{if(a)return s.goToOption(y.Nothing);s.goToOption(y.Specific,i)}),u=Me(),h=b(L=>u.update(L)),M=b(L=>{u.wasMoved(L)&&(a||g||s.goToOption(y.Specific,i,0))}),N=b(L=>{u.wasMoved(L)&&(a||g&&s.goToOption(y.Nothing))}),G=c.useMemo(()=>({active:g,selected:v,disabled:a}),[g,v,a]);return C({ourProps:{id:i,ref:R,role:"option",tabIndex:a===!0?void 0:-1,"aria-disabled":a===!0?!0:void 0,"aria-selected":v,disabled:void 0,onClick:I,onFocus:m,onPointerEnter:h,onMouseEnter:h,onPointerMove:M,onMouseMove:M,onPointerLeave:N,onMouseLeave:N},theirProps:r,slot:G,defaultTag:rt,name:"Listbox.Option"})}let ot=$(We),it=$(Ye),at=$(Ze),lt=$(tt),ut=$(nt),ft=Object.assign(ot,{Button:it,Label:at,Options:lt,Option:ut});export{ft as I};
