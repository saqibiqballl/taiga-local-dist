import{j as e,W as le,X as ee,r as i,V as be,aC as je,az as de,T as pe,C as ye,u as ve,K as we}from"./index.js";import{t as Q}from"./toastr.js";import{D as Ne}from"./DeleteModal.js";import{D as Se}from"./DropdownEditMenu.js";import{u as ke,a as Ce,C as R}from"./index.esm.js";import{S as J,c as X}from"./reactSelectStyles.js";import{c as _e,a as oe,b as Ae,o as De}from"./index.esm2.js";import{W as Me}from"./connection2.js";import{d as $e,h as Ee}from"./Remove.js";import{d as Le}from"./Add.js";import{h as Re}from"./debounce.js";import{D as Fe,a as Te,b as Ve,c as Ue}from"./DialogTitle.js";import{G as ce}from"./Grid.js";import{A as Pe}from"./Avatar.js";import{I as he}from"./IconButton.js";import{A as Ie}from"./placeholder.js";import{T as ae}from"./Tooltip.js";import{R as ze}from"./index35.js";import"./popover.js";import"./dayjs.min.js";import{a as Be}from"./index.module.js";import{B as qe}from"./ButtonLoader.js";import"./createSvgIcon2.js";import"./createSvgIcon.js";import"./resolveComponentProps.js";import"./Menu.js";import"./Modal.js";import"./Backdrop.js";import"./useTheme.js";import"./useSlotProps.js";import"./Paper.js";import"./Grow.js";import"./floating-ui.dom.js";import"./index34.js";import"./tslib.es6.js";function We({selectedItems:u,handleDeleteSources:b}){return e.jsx("div",{"data-name":"feature_mediaCloud_advanceSources_deleteSource",className:`${u.length<1&&"hidden"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"hidden xl:block text-sm italic mr-2 whitespace-nowrap",children:[e.jsx("span",{children:u.length})," items selected"]}),e.jsx("button",{className:"btn bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 hover:border-slate-300 dark:hover:border-slate-600 text-rose-500",onClick:()=>{b()},children:"Delete"})]})})}const ue=async u=>{var b;try{return(await le.delete(`${ee.sources}/delete`,{data:{sids:u}})).data}catch(l){(b=l==null?void 0:l.response)!=null&&b.data&&Q.error(l.response.data.message)}};function Ge({setOpenEdit:u,setEditableSource:b,setCheckListRendered:l,data:v,reloadData:F}){const[_,w]=i.useState(!1),N=async()=>{const f=await ue([v.sources_id]);f&&f.message&&(Q.success(f.message),setTimeout(()=>{F()},100))};return e.jsxs(e.Fragment,{children:[e.jsxs(Se,{align:"right",children:[e.jsx("li",{children:e.jsx("button",{"data-name":"feature_mediaCloud_advanceSources_editSource",className:"font-medium text-sm text-slate-600 dark:text-slate-300 hover:text-slate-700 dark:hover:text-slate-200 flex py-1 px-3",onClick:()=>{u(!0),b(v)},children:"Edit"})}),e.jsx("li",{children:e.jsx("button",{"data-name":"feature_mediaCloud_advanceSources_viewSource",className:"font-medium text-sm text-slate-600 dark:text-slate-300 hover:text-slate-700 dark:hover:text-slate-200 flex py-1 px-3",children:e.jsx(be,{to:`source/${v._id}`,children:"View"})})}),e.jsx("li",{children:e.jsx("button",{"data-name":"feature_mediaCloud_advanceSources_deleteSource",className:"font-medium text-sm text-rose-500 hover:text-rose-600 flex py-1 px-3",onClick:()=>w(!0),children:"Delete"})})]}),e.jsx(Ne,{isOpen:_,onClose:()=>w(!1),onConfirm:N,title:"Delete Source",description:`Are you sure you want to delete ${v.name}`,confirmText:"Delete",cancelText:"Cancel"})]})}const Ke=_e().shape({label:oe().required(),domain:oe().required(),urls:Ae().of(oe().url("Invalid URL").required("URL is required")).min(1,"At least one URL is required").required("URLs are required")}),xe={label:"",domain:"",primary_language:"",service:"",urls:[""],category:[],subcategory:[],country:"",state:"",media_type:[]};function He({open:u,setOpen:b,data:l,setEditableSource:v,reloadData:F}){const{languages:_,states:w,mediaType:N,countries:f,categories:h}=i.useContext(je),[S,D]=i.useState(),[k,G]=i.useState(""),[M,K]=i.useState([]),[A,C]=i.useState([]),[V,I]=i.useState(!1),U=i.useMemo(()=>(_==null?void 0:_.map(s=>({id:s,value:s,label:s})))||[],[_]),P=i.useMemo(()=>(f==null?void 0:f.map(s=>({id:s,value:s,label:s})))||[],[f]),a=i.useMemo(()=>(w==null?void 0:w.map(s=>({id:s,value:s,label:s})))||[],[w]),m=i.useMemo(()=>(N==null?void 0:N.map(s=>({value:s,label:s})))||[],[N]),$=i.useMemo(()=>(h==null?void 0:h.map(s=>({value:s.category,label:s.category})))||[],[h]),{register:y,reset:z,control:x,handleSubmit:B,setValue:q,getValues:W,formState:{errors:d}}=ke({defaultValues:xe,mode:"onChange",resolver:De(Ke)}),{fields:H,append:Y,remove:re}=Ce({control:x,name:"urls"}),ie=i.useCallback(Re(async(s,r)=>{if(!r){C(t=>t.map(n=>n.fieldName===s?{...n,status:!1}:n));return}try{const t={screenshotUrl:r},n=await Me.post(`${ee.sources}/check-url`,t);C(o=>[...o.filter(p=>p.fieldName!==s),{fieldName:s,status:n.status===200}])}catch(t){C(n=>[...n.filter(o=>o.fieldName!==s),{fieldName:s,status:!1}]),console.error("Error while checking URL:",t.message)}},500),[]),Z=i.useCallback(s=>{const r=(s==null?void 0:s.map(p=>p==null?void 0:p.value))||[],t=new Set;r.forEach(p=>{const g=h==null?void 0:h.find(L=>L.category===p);g&&g.subCategories.forEach(L=>t.add(L))});const n=[...t].map(p=>({value:p,label:p}));K(n);const o=W("subcategory");(o==null?void 0:o.length)>0&&q("subcategory",o.filter(p=>n.some(g=>g.value===p)))},[h,W,q]);i.useEffect(()=>{var s,r,t;if(u)if(l){const n=((s=l==null?void 0:l.urls)==null?void 0:s.map((p,g)=>({fieldName:`urls.${g}`,status:!0})))||[];C(n),G(l==null?void 0:l.logo);const o={label:(l==null?void 0:l.label)||"",domain:(l==null?void 0:l.domain_name)||"",primary_language:l.primary_language||"",service:(l==null?void 0:l.service)||"",urls:(r=l==null?void 0:l.urls)!=null&&r.length?l.urls:[""],category:(l==null?void 0:l.category)||[],subcategory:(l==null?void 0:l.sub_categories)||[],country:(l==null?void 0:l.pub_country)||"",state:(l==null?void 0:l.pub_state)||"",media_type:(l==null?void 0:l.media_type)||""};if(z(o),(t=l==null?void 0:l.category)!=null&&t.length){const p=l.category.map(g=>({value:g,label:g}));Z(p)}}else z(xe),C([]),K([]),G(""),D(null)},[u,l,z,Z]);const O=()=>{b(!1),v(null),C([])},c=s=>{const r=s.target.files[0];if(r){const t=new FileReader;t.onload=n=>{G(n.target.result)},t.readAsDataURL(r),D(r)}},j=async s=>{var t,n;if(!(A.length===s.urls.length&&A.every(o=>o.status===!0))){Q.error("Please ensure all URLs are valid");return}I(!0);try{const o=new FormData;Object.entries(s).forEach(([g,L])=>{Array.isArray(L)?L.forEach(se=>o.append(`${g}[]`,se)):o.append(g,L||"")}),S&&o.append("image",S),o.append("source_id",l._id);const p=await le.post(`${ee.sources}/update`,o,{headers:{"Content-Type":"multipart/form-data"}});Q.success(p.data.message),O(),F==null||F()}catch(o){Q.error(((n=(t=o.response)==null?void 0:t.data)==null?void 0:n.message)||"Internal Error")}finally{I(!1)}},E=s=>{var t,n,o;return!((t=d.urls)==null?void 0:t[s])&&((o=(n=H[s])==null?void 0:n.value)==null?void 0:o.trim())!==""};return e.jsx(Fe,{fullWidth:!0,open:u,onClose:O,maxWidth:"md",sx:{"& .MuiDialog-paper":{borderRadius:"10px"}},children:e.jsxs("form",{onSubmit:B(j),className:"bg-white dark:bg-gray-800 overflow-auto dark:text-slate-300 ",children:[e.jsx(Te,{className:"sticky top-0 px-5 py-4 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700/60 z-10",children:e.jsx("h3",{className:"text-xl md:text-xl text-slate-700 dark:text-slate-100 font-bold",children:"Edit Source"})}),e.jsx(Ve,{fullWidth:!0,children:e.jsxs(ce,{container:!0,spacing:2,children:[e.jsxs(ce,{item:!0,md:3,display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx("input",{id:"source-upload-image",style:{display:"none"},type:"file",accept:".png,.jpeg,.jpg",onChange:c}),e.jsx("label",{htmlFor:"source-upload-image",children:e.jsx(Pe,{src:k,style:{width:100,height:100,cursor:"pointer"}})}),e.jsx("label",{children:"Allowed PNG or JPEG. Max size of 800K."})]}),e.jsxs(ce,{item:!0,md:9,mb:8,children:[e.jsx(R,{name:"label",control:x,render:({field:s})=>e.jsxs("div",{className:"w-full mb-3",children:[e.jsx("label",{children:"Label"}),e.jsx("input",{className:"form-input w-full mt-1",...s}),d.label&&e.jsx("span",{className:"text-rose-500",children:d.label.message})]})}),e.jsx(R,{name:"domain",control:x,render:({field:s})=>e.jsxs("div",{className:"w-full mb-3",children:[e.jsx("label",{children:"Domain"}),e.jsx("input",{className:"form-input w-full mt-1",...s}),d.domain&&e.jsx("span",{className:"text-rose-500",children:d.domain.message})]})}),e.jsx(R,{name:"service",control:x,render:({field:s})=>e.jsxs("div",{className:"w-full mb-3",children:[e.jsx("label",{children:"Service"}),e.jsx("input",{className:"form-input w-full mt-1",...s}),d.service&&e.jsx("span",{className:"text-rose-500",children:d.service.message})]})}),e.jsx("label",{children:"URLs"}),H.map((s,r)=>{var o,p,g,L,se;const t=r<H.length-1&&E(r)&&!((o=d.urls)!=null&&o[r]),n=!t;return e.jsxs(de.Fragment,{children:[e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(R,{name:`urls.${r}`,control:x,render:({field:{name:T,value:me,onChange:ne}})=>e.jsx("input",{name:T,value:me,onChange:te=>{ne(te.target.value),/^(https?:\/\/[^\s]+)/.test(te.target.value)?ie(T,te.target.value):te.target.value===""&&C(fe=>fe.filter(ge=>ge.fieldName!==T))},className:"form-input w-full p-2 border border-gray-300 rounded-md"})})}),A.some(T=>T.fieldName===`urls.${r}`)&&e.jsx(pe,{variant:"body2",className:"mx-3",children:(p=A.find(T=>T.fieldName===`urls.${r}`))!=null&&p.status?e.jsx("span",{className:"text-green-500",children:"200"}):e.jsx("span",{className:"text-red-500",children:"Error"})}),t&&e.jsx(pe,{variant:"body2",color:"textSecondary",className:"mx-3",children:"OR"}),n&&e.jsxs(e.Fragment,{children:[e.jsx(he,{onClick:()=>{C(T=>T.filter((me,ne)=>ne!==r)),re(r)},disabled:H.length===1,children:e.jsx($e,{})}),e.jsx(he,{disabled:((g=A[r])==null?void 0:g.fieldName)===`urls.${r}`&&!((L=A[r])!=null&&L.status),onClick:()=>Y(""),children:e.jsx(Le,{})})]})]}),((se=d.urls)==null?void 0:se[r])&&e.jsx("span",{className:"text-rose-500 text-sm mt-1 block",children:d.urls[r].message})]},s.id)}),e.jsx(R,{name:"category",control:x,render:({field:{value:s,onChange:r}})=>e.jsxs("div",{className:"w-full mb-3",children:[e.jsx("label",{children:"Category"}),e.jsx(J,{className:"mt-1",options:$,value:$.filter(t=>s==null?void 0:s.includes(t.value)),onChange:t=>{r((t==null?void 0:t.map(n=>n.value))||[]),Z(t)},isSearchable:!0,isMulti:!0,placeholder:"Select categories",styles:X()}),d.category&&e.jsx("span",{className:"text-rose-500",children:d.category.message})]})}),e.jsx(R,{name:"subcategory",control:x,render:({field:{value:s,onChange:r}})=>e.jsxs("div",{className:"w-full mb-3",children:[e.jsx("label",{children:"Sub Category"}),e.jsx(J,{className:"mt-1",options:M,value:M.filter(t=>s==null?void 0:s.includes(t.value)),onChange:t=>r((t==null?void 0:t.map(n=>n.value))||[]),isSearchable:!0,isMulti:!0,placeholder:"Select sub categories",styles:X()}),d.subcategory&&e.jsx("span",{className:"text-rose-500",children:d.subcategory.message})]})}),e.jsx(R,{name:"country",control:x,render:({field:{value:s,onChange:r}})=>e.jsxs("div",{className:"w-full mb-3",children:[e.jsx("label",{children:"Publish Country"}),e.jsx(J,{className:"mt-1",options:P,value:P.find(t=>t.value===s),onChange:t=>{r((t==null?void 0:t.value)||null),t?Ee(t.id).then(n=>{setStatesOptions((n==null?void 0:n.map(o=>({value:o.name,label:o.name})))||[])}):setStatesOptions([])},isSearchable:!0,isClearable:!0,placeholder:"Select Country",styles:X()}),d.country&&e.jsx("span",{className:"text-rose-500",children:d.country.message})]})}),e.jsx(R,{name:"state",control:x,render:({field:{value:s,onChange:r}})=>e.jsxs("div",{className:"w-full mb-3",children:[e.jsx("label",{children:"Publish State"}),e.jsx(J,{className:"mt-1",options:a,value:a.find(t=>t.value===s),onChange:t=>r((t==null?void 0:t.value)||null),isSearchable:!0,isClearable:!0,placeholder:"Select States",styles:X()}),d.state&&e.jsx("span",{className:"text-rose-500",children:d.state.message})]})}),e.jsx(R,{name:"primary_language",control:x,render:({field:{value:s,onChange:r}})=>e.jsxs("div",{className:"w-full mb-3",children:[e.jsx("label",{children:"Primary Language"}),e.jsx(J,{className:"mt-1",options:U,value:U.find(t=>t.value===s),onChange:t=>r((t==null?void 0:t.value)||null),isSearchable:!0,isClearable:!0,placeholder:"Select Languages",styles:X()}),d.primary_language&&e.jsx("span",{className:"text-rose-500",children:d.primary_language.message})]})}),e.jsx(R,{name:"media_type",control:x,render:({field:{value:s,onChange:r}})=>e.jsxs("div",{className:"w-full mb-3",children:[e.jsx("label",{children:"Media Type"}),e.jsx(J,{className:"mt-1",options:m,value:m.filter(t=>s==null?void 0:s.includes(t.value)),onChange:t=>r((t==null?void 0:t.map(n=>n.value))||[]),isSearchable:!0,isMulti:!0,placeholder:"Select Media Types",styles:X()}),d.media_type&&e.jsx("span",{className:"text-rose-500",children:d.media_type.message})]})})]})]})}),e.jsxs(Ue,{className:"sticky bottom-0 px-5 py-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700/60 z-10",children:[e.jsx("button",{type:"button",className:"btn bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700/60 hover:border-gray-300 dark:hover:border-gray-600 text-gray-800 dark:text-gray-300",onClick:O,children:"Cancel"}),e.jsxs("button",{type:"submit",className:"btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white disabled:border-gray-200 dark:disabled:border-gray-700 disabled:bg-white dark:disabled:bg-gray-800 disabled:text-gray-300 dark:disabled:text-gray-600 disabled:cursor-not-allowed",disabled:V,children:[V&&e.jsx("svg",{className:"animate-spin fill-current shrink-0",width:"16",height:"16",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M8 16a7.928 7.928 0 01-3.428-.77l.857-1.807A6.006 6.006 0 0014 8c0-3.309-2.691-6-6-6a6.006 6.006 0 00-5.422 8.572l-1.806.859A7.929 7.929 0 010 8c0-4.411 3.589-8 8-8s8 3.589 8 8-3.589 8-8 8z"})}),"Save"]})]})]})})}function Je({loading:u,setCheckListRendered:b,selectedItems:l,data:v,total:F,reloadData:_,sortFilter:w,setConfig:N}){const[f,h]=i.useState(!1),[S,D]=i.useState([]),[k,G]=i.useState(w),[M,K]=de.useState(!1),[A,C]=de.useState(null);i.useEffect(()=>{h(!1),D([])},[v]);const V=()=>{h(!f),D(v.map(a=>`${a._id}`)),f&&D([])},I=a=>{const{id:m,checked:$}=a.target;h(!1),D([...S,m]),$||D(S.filter(y=>y!==m))};i.useEffect(()=>{l(S)},[S]);const U=a=>{let m="ascending";k.key,m=k.direction==="ascending"?"descending":"ascending",G({key:a,direction:m}),N({key:a,direction:m})},P=a=>k.key===a?k.direction==="ascending"?"↑":"↓":"↕";return e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-xs rounded-xl relative",children:[e.jsx("header",{className:"px-5 py-4",children:e.jsxs("h2",{className:"font-semibold text-slate-700 dark:text-slate-100",children:["All Sources"," ",e.jsx("span",{className:"text-slate-400 dark:text-slate-500 font-medium",children:F})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full dark:text-gray-300",children:[e.jsx("thead",{className:"text-xs font-semibold uppercase text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-900/20 border-t border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap w-px",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"inline-flex",children:[e.jsx("span",{className:"sr-only",children:"Select all"}),e.jsx("input",{className:"w-4 h-4 text-violet-600 bg-gray-100 border-gray-300 rounded focus:ring-violet-500 dark:focus:ring-violet-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-slate-300",type:"checkbox",checked:f,onChange:V})]})})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap"}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Label"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Domain"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Service"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Category"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Country"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Language"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold",children:"Media Type"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap cursor-pointer",onClick:()=>U("total_feed"),children:e.jsxs("div",{className:"font-semibold text-left",children:["Total Feeds ",P("total_feed")]})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap cursor-pointer",onClick:()=>U("total_post"),children:e.jsxs("div",{className:"font-semibold text-left",children:["Total Posts ",P("total_post")]})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap cursor-pointer",onClick:()=>U("total_post_last_week"),children:e.jsxs("div",{className:"font-semibold text-left",children:["Last Week Posts ",P("total_post_last_week")]})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("span",{className:"sr-only",children:"Menu"})})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-slate-200 dark:divide-slate-700",children:u?e.jsx("tr",{children:e.jsx("td",{colSpan:"100%",style:{textAlign:"center",padding:"22px"},children:e.jsx(ye,{})})}):v.map(a=>{var x,B,q,W;let m=Array.isArray(a==null?void 0:a.category)?(x=a==null?void 0:a.category)==null?void 0:x.join(", "):[a==null?void 0:a.category].join(", "),$=`${m==null?void 0:m.slice(0,20)}${(m==null?void 0:m.length)>20?"...":""}`,y=Array.isArray(a==null?void 0:a.media_type)?(B=a==null?void 0:a.media_type)==null?void 0:B.join(", "):[a==null?void 0:a.media_type].join(", "),z=`${y==null?void 0:y.slice(0,10)}${(y==null?void 0:y.length)>10?"...":""}`;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap w-px",children:e.jsx("div",{className:"flex items-center",children:e.jsx("label",{className:"inline-flex",children:e.jsx("input",{id:a._id,className:"w-4 h-4 text-violet-600 bg-gray-100 border-gray-300 rounded focus:ring-violet-500 dark:focus:ring-violet-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-slate-300",type:"checkbox",onChange:I,checked:S.includes(`${a._id}`)})})})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"w-10 h-10",children:a.logo?e.jsx("img",{className:"rounded-full w-full h-full object-cover",src:`${a.logo}`,alt:"Avatar"}):e.jsx("img",{className:"rounded-full w-full h-full object-cover",src:Ie,alt:"Avatar"})})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx(ae,{title:(a==null?void 0:a.label)||"",children:e.jsx("div",{className:"text-left",children:`${(q=a==null?void 0:a.label)==null?void 0:q.slice(0,10)}...`})})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx(ae,{title:(a==null?void 0:a.domain_name)||"",children:e.jsx("div",{className:"text-left",children:`${(W=a==null?void 0:a.domain_name)==null?void 0:W.slice(0,10)}...`})})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-center",children:a==null?void 0:a.service})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx(ae,{title:m||"",children:e.jsx("div",{className:"text-left",children:`${$}`})})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-center",children:a.pub_country})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-center",children:a.primary_language})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx(ae,{title:y||"",children:e.jsx("div",{className:"text-left text-violet-500 dark:text-violet-400 font-medium text-sky-500",children:`${z}`})})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left font-medium text-emerald-500",children:a.total_feed})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left font-medium text-emerald-500",children:a.total_post??0})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left font-medium text-emerald-500",children:a.total_post_last_week??0})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap w-px",children:e.jsx(Ge,{setOpenEdit:K,setEditableSource:C,setCheckListRendered:b,data:a,reloadData:_})})]},a._id)})})]})}),e.jsx(He,{open:M,setOpen:K,data:A,setEditableSource:C,reloadData:_})]})}function $s(){const[u,b]=i.useState([]),[l,v]=i.useState({key:"total_feed",direction:"ascending"}),[F,_]=i.useState([]),[w,N]=i.useState(!1),[f,h]=i.useState(!1),[S,D]=i.useState(""),[k,G]=i.useState(),[M,K]=i.useState(),[A,C]=i.useState(10),[V,I]=i.useState(1),[U,P]=i.useState(0),[a,m]=i.useState(0),$=ve(),y=$==null?void 0:$.userPermissions,z="module_mediaCloud",x="submodule_mediaCloud_advanceSources",B=i.useMemo(()=>we(y,z,x),[y]),[q,W]=i.useState(!1),[d]=Be(S,500);i.useEffect(()=>{requestAnimationFrame(()=>{document.querySelectorAll("[data-name]").forEach(E=>{const s=E.getAttribute("data-name"),r=B.find(t=>t.id===s);r&&(r.enable||E.remove())})})},[B,q]);const H=c=>{b([...c])};i.useEffect(()=>{const c=setTimeout(()=>{w||Y()},100);return()=>clearTimeout(c)},[d,l,V,M,k]),i.useEffect(()=>{I(1)},[d,l]);const Y=async()=>{N(!0);try{const c={pageSize:A,page:V,searchValue:d,from:M?new Date(M):void 0,to:k?new Date(k):void 0,sortKey:l.key,sortDirection:l.direction},j=await le.post(`${ee.sources}/getAdvancedSources`,c);if(j.status===200){const E=j.data.total;m(Math.ceil(E/A)),P(j.data.total),_(j.data.source),b([])}N(!1)}catch(c){console.error(c),N(!1)}},re=async()=>{h(!0);try{console.log(M);const c={searchValue:S,from:new Date(M),to:new Date(k)},j=await le.post(`${ee.sources}/getCSVData`,c);j.status==200&&Z(j.data.source),h(!1)}catch{h(!1)}},ie=c=>{if(c.length===0)return"";const j=Object.keys(c[0]).join(",")+`
`,E=c.map(s=>Object.values(s).map(t=>typeof t=="string"&&t.includes(",")?`"${t}"`:t).join(",")).join(`
`);return j+E},Z=c=>{const j=ie(c),E=new Blob([j],{type:"text/csv"}),s=URL.createObjectURL(E),r=document.createElement("a");r.href=s,r.download="data.csv",document.body.appendChild(r),r.click(),document.body.removeChild(r)},O=async()=>{const c=await ue(u);c&&c.message&&(b([]),Q.success(c.message),setTimeout(()=>{Y()},100))};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-6 p-space-y-6",children:[e.jsxs("div",{className:"sm:flex sm:justify-between sm:items-center mb-8",children:[e.jsx("div",{className:"mb-4 sm:mb-0",children:e.jsx("h1",{className:"text-2xl md:text-3xl text-slate-700 dark:text-slate-100 font-bold",children:"Advanced Sources ✨"})}),e.jsxs("div",{className:"grid grid-flow-col sm:auto-cols-max justify-start sm:justify-end gap-1",children:[e.jsx(We,{selectedItems:u,handleDeleteSources:O}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"action-search",className:"sr-only",children:"Search"}),e.jsx("input",{id:"action-search",className:"form-input pl-9 bg-white dark:bg-slate-800",type:"search",placeholder:"Search Sources",value:S,onChange:c=>D(c.target.value)}),e.jsx("button",{className:"absolute inset-0 right-auto group",type:"submit","aria-label":"Search",children:e.jsxs("svg",{className:"w-4 h-4 shrink-0 fill-current text-slate-400 dark:text-slate-500 group-hover:text-slate-500 dark:group-hover:text-slate-400 ml-3 mr-2",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M7 14c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7zM7 2C4.243 2 2 4.243 2 7s2.243 5 5 5 5-2.243 5-5-2.243-5-5-5z"}),e.jsx("path",{d:"M15.707 14.293L13.314 11.9a8.019 8.019 0 01-1.414 1.414l2.393 2.393a.997.997 0 001.414 0 .999.999 0 000-1.414z"})]})})]}),e.jsx("div",{"data-name":"feature_mediaCloud_advanceSources_dateFilter"}),e.jsx("button",{"data-name":"feature_mediaCloud_advanceSources_downloadCsv",className:"btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white",onClick:c=>{re()},disabled:f,children:f?e.jsx(qe,{}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-4 h-4 fill-current opacity-50 shrink-0",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M8 0a1 1 0 0 1 1 1v8.586l2.707-2.707a1 1 0 0 1 1.414 1.414l-4 4a1 1 0 0 1-1.414 0l-4-4a1 1 0 0 1 1.414-1.414L7 9.586V1a1 1 0 0 1 1-1z"}),e.jsx("path",{d:"M2 13a1 1 0 0 0-1 1v1h14v-1a1 1 0 0 0-1-1H2z"})]}),e.jsx("span",{className:"hidden xs:block ml-2",children:"Download CSV"})]})})]})]}),e.jsx(Je,{selectedItems:H,loading:w,data:F,total:U,reloadData:Y,sortFilter:l,setConfig:c=>{v(c)},setCheckListRendered:W}),e.jsx("div",{className:"mt-8",children:e.jsx(ze,{current:V,total:a,onPageChange:I})})]})})}export{$s as default};
