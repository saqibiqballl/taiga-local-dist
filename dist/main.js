import{r,aH as W,b as z,u as B,O as X,d as g,j as s,B as O,C as Z,K}from"./index.js";import{S as j}from"./secureFetch.js";import{I as A}from"./iconify.js";import{R as T}from"./connection.js";import{t as c}from"./toastr.js";import{D as tt}from"./DropdownEditMenu.js";import{D as E}from"./DeleteModal.js";import{I as st}from"./InfoModal.js";import"./createSvgIcon2.js";import"./createSvgIcon.js";import"./resolveComponentProps.js";import"./IconButton.js";import"./Menu.js";import"./Modal.js";import"./Backdrop.js";import"./useTheme.js";import"./useSlotProps.js";import"./Paper.js";import"./Grow.js";function et({setCheckRendered:_,searchKey:f}){var I;const k="module_socialRadar",p="submodule_socialRadar_projects",[w,v]=r.useState(!1),[D,m]=r.useState(!1),[i,d]=r.useState(),b=W(),u=z(),h=B(),[C,R]=r.useState(0),[M,$]=r.useState([]),l=X(t=>t.socialRadar.allFetchSettings),[S,o]=r.useState(!1),[F,P]=r.useState(!1);r.useEffect(()=>{const t=setTimeout(()=>{N()},500);return()=>clearTimeout(t)},[f]);const L=t=>{try{const e={name:t==null?void 0:t.name,andKeywords:[...t==null?void 0:t.andKeywords],orKeywords:[...t==null?void 0:t.orKeywords],notKeywords:[...t==null?void 0:t.notKeywords],topics:[...t==null?void 0:t.topics],iterations:t==null?void 0:t.iterations};j.post(`${g}/api/fetch/newfetchsettings`,e).then(a=>{if(a.error){c.error(a.err),o(!1);return}else if(a.data){c.success("Settings Successfully duplicated"),o(!1),N(),P(!1);return}else{c.info(`Setting:${JSON.stringify(a)}`),o(!1);return}})}catch(e){c.error(e.message)}},V=(t,e,a)=>{var n="(";return t==null||t.map((x,y)=>{y<t.length-1?n+=x+" AND ":n+=x+")"}),n+=" AND (",e==null||e.map((x,y)=>{y<e.length-1?n+=x+" OR ":n+=x+")"}),n+=" AND (",a==null||a.map((x,y)=>{y<a.length-1?n+=x+" NOT ":n+=x+")"}),n.length>120?n.substring(0,119)+"...":n};r.useEffect(()=>{var t;(t=h==null?void 0:h.user)!=null&&t._id&&N()},[(I=h==null?void 0:h.user)==null?void 0:I._id]);const N=async()=>{o(!0);const t=await j.post(`${g}/api/fetch/getfetchsettings?searchKey=${f}`,{searchKey:f});$([...t.selectData]),b({type:"allfetchsettings/set",payload:[...t.selectData]}),t.length>0&&R(0),o(!1),_(!0)},q=t=>{v(!0),d(t)},H=t=>{m(!0),d(t)},Q=async()=>{o(!0),j.delete(`${g}/api/fetch/deletefetchsetting/${i==null?void 0:i._id}`,{settingId:i==null?void 0:i._id}).then(t=>{t!=null&&t.message?(c.success("Project deleted successfully!"),T.delete(`/api/app_permission/module/${k}/submodule/${p}/feature/${i==null?void 0:i._id}`),N()):c.error("Settings Not Deleted")}).catch(t=>{console.log(t)}),d(null),v(!1),o(!1)},Y=async()=>{o(!0),j.post(`${g}/api/post/deleteposts`,{settingId:i==null?void 0:i._id}).then(t=>{t!=null&&t.message?(c.error(t==null?void 0:t.message),N()):c.error("Posts Not Deleted")}).catch(t=>{console.log(t)}),d(null),m(!1),o(!1)},J=t=>{o(!0),j.post(`${g}/api/post/fetchsettingposts`,{fetchSettingId:t==null?void 0:t._id}).then(e=>{e!=null&&e.data?(localStorage.setItem("fetchsettingid",t==null?void 0:t._id),b({type:"fetchsettings/set",payload:{...t}}),u(`/socialradar/settings/author-resources/${t==null?void 0:t._id}`,{state:{from:`${t==null?void 0:t._id}`}})):c.error("There is no post available on these settings")}).catch(e=>{console.log(e)}),o(!1)},U=t=>{o(!0),j.post(`${g}/api/post/fetchsettingposts`,{fetchSettingId:t==null?void 0:t._id}).then(e=>{e!=null&&e.data?(localStorage.setItem("fetchsettingid",t==null?void 0:t._id),b({type:"fetchsettings/set",payload:{...t}}),u(`/socialradar/posts/${t==null?void 0:t._id}`,{state:{from:`${t==null?void 0:t._id}`}})):c.error("There is no post available on these settings")}).catch(e=>{console.log(e)}),o(!1)},G=async t=>{const e=t.map(a=>({id:a._id,project:!0,name:a.name,label:a.name,enable:a.enable||!1}));await T.post(`/api/app_permission/module/${k}/submodule/${p}/feature`,e),_(!0)};return r.useEffect(()=>{l.length>0&&G(l)},[l]),s.jsx("div",{children:(l==null?void 0:l.length)>0?s.jsx("div",{className:"grow",children:s.jsxs("div",{className:"p-space-y-6",children:[s.jsx("section",{className:"border-slate-200 dark:border-slate-700",children:s.jsx("div",{className:"grid grid-cols-12 gap-6",children:l==null?void 0:l.map((t,e)=>s.jsx("div",{"data-name":t._id,className:"col-span-full sm:col-span-6 xl:col-span-4 bg-white dark:bg-gray-800 shadow-xs rounded-xl",children:s.jsxs("div",{className:"flex flex-col h-full",children:[s.jsxs("div",{className:"grow p-5",children:[s.jsx("div",{className:"flex justify-between items-start",children:s.jsxs("div",{className:"flex mb-2 w-full",children:[s.jsxs(O,{className:"relative inline-flex items-start mr-5",children:[s.jsx("div",{className:"absolute top-0 right-0 -mr-2 bg-white dark:bg-slate-700 rounded-full shadow","aria-hidden":"true",children:s.jsx("svg",{className:"w-8 h-8 fill-current text-amber-500",viewBox:"0 0 32 32",children:s.jsx("path",{d:"M21 14.077a.75.75 0 01-.75-.75 1.5 1.5 0 00-1.5-1.5.75.75 0 110-1.5 1.5 1.5 0 001.5-1.5.75.75 0 111.5 0 1.5 1.5 0 001.5 1.5.75.75 0 010 1.5 1.5 1.5 0 00-1.5 1.5.75.75 0 01-.75.75zM14 24.077a1 1 0 01-1-1 4 4 0 00-4-4 1 1 0 110-2 4 4 0 004-4 1 1 0 012 0 4 4 0 004 4 1 1 0 010 2 4 4 0 00-4 4 1 1 0 01-1 1z"})})}),s.jsx(A,{icon:"skill-icons:twitter",width:"34",height:"34",className:"rounded-full",style:{width:64,height:64}})]}),s.jsxs("div",{className:"mt-1 pr-1 flex-1 overflow-hidden mr-2",children:[s.jsx(O,{className:"inline-flex text-slate-700 dark:text-slate-100 hover:text-slate-900 dark:hover:text-slate-300",children:s.jsx("h2",{className:"text-xl leading-snug justify-center font-semibold",children:t==null?void 0:t.name})}),s.jsxs("div",{className:"flex items-center",children:[s.jsx("span",{className:"text-sm font-medium text-slate-400 -mt-0.5 mr-1",children:"->"})," ",s.jsx("span",{children:t==null?void 0:t.iterations})]})]}),s.jsx("div",{className:"flex max-h-[33px]",children:s.jsxs(tt,{align:"right",children:[s.jsx("li",{children:s.jsx("button",{"data-name":"feature_socialRadar_main_resources",className:"font-medium text-sm text-slate-600 dark:text-slate-300 hover:text-slate-700 dark:hover:text-slate-200 flex py-1 px-3",onClick:a=>{a.preventDefault(),J(t)},children:"Resources"})}),s.jsx("li",{children:s.jsx("button",{"data-name":"feature_socialRadar_main_duplicate",className:"font-medium text-sm text-slate-600 dark:text-slate-300 hover:text-slate-700 dark:hover:text-slate-200 flex py-1 px-3",to:"#0",onClick:a=>{a.preventDefault(),P(!0),d(t)},children:"Duplicate"})}),s.jsx("li",{children:s.jsx("button",{"data-name":"feature_socialRadar_main_deletePosts",className:"font-medium text-sm text-slate-600 dark:text-slate-300 hover:text-slate-700 dark:hover:text-slate-200 flex py-1 px-3",to:"#0",onClick:a=>{a.preventDefault(),H(t)},children:"Delete Posts"})}),s.jsx("li",{children:s.jsx("button",{"data-name":"feature_socialRadar_main_deleteCollection",className:"font-medium text-sm text-rose-500 hover:text-rose-600 flex py-1 px-3",onClick:a=>{q(t)},children:"Delete"})})]})})]})}),s.jsxs("div",{className:"mt-2",children:[s.jsx("div",{className:"test-sm font-medium",children:"Query:"}),s.jsx("div",{className:"text-sm",children:V(t==null?void 0:t.andKeywords,t==null?void 0:t.orKeywords,t==null?void 0:t.notKeywords)})]})]}),s.jsx("div",{className:"border-t border-slate-200 dark:border-slate-700",children:s.jsxs("div",{className:"flex divide-x divide-slate-200 dark:divide-slate-700",children:[s.jsx("button",{"data-name":"feature_socialRadar_main_viewCollection",className:"block flex-1 text-center text-sm text-violet-500 hover:text-violet-600 dark:hover:text-violet-400 font-medium px-3 py-4",onClick:a=>{a.preventDefault(),U(t)},children:s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx(A,{icon:"carbon:view",width:"20",height:"20",className:"fill-current shrink-0 mr-2"}),s.jsx("span",{children:"View"})]})}),s.jsx("button",{"data-name":"feature_socialRadar_main_editCollection",className:"block flex-1 text-center text-sm hover:text-violet-600 dark:hover:text-violet-400 font-medium px-3 py-4",onClick:a=>{a.preventDefault(),u("/socialradar/settings/updatefetchsettings",{state:{key:t==null?void 0:t._id,rootKey:e,name:t==null?void 0:t.name,...t}})},children:s.jsxs("div",{className:"flex items-center justify-center",children:[s.jsx(A,{icon:"mdi:pencil",className:"text-xl"}),s.jsx("span",{children:"Edit"})]})})]})})]})},e))})}),s.jsx(E,{id:"danger-modal",isOpen:w,isLoading:S,onClose:()=>{v(!1)},onConfirm:()=>{Q()}}),s.jsx(E,{id:"danger-post-modal",isOpen:D,onClose:()=>{m(!1)},title:"Are you sure?",description:"Do you want to delete all posts of this project? This action could be not reverted.",confirmText:"Yes, Delete it",cancelText:"Cancel",onConfirm:()=>{Y()},isLoading:S}),s.jsx(st,{id:"info-modal",isOpen:F,title:"Duplicate Collection",description:"Are you sure you want to duplicate this collection?",confirmText:"Yes, Duplicate it",cancelText:"Cancel",onClose:()=>{P(!1)},onConfirm:()=>{L(i)},isLoading:S})]})}):S?s.jsx(Z,{}):s.jsx("div",{className:"text-center w-full p-4 pt-10 pb-10",children:"No Data"})})}function yt(){const _=z(),[f,k]=r.useState(""),p=B(),w=p==null?void 0:p.userPermissions,v="module_socialRadar",D="submodule_socialRadar_projects",m=r.useMemo(()=>K(w,v,D),[w]),[i,d]=r.useState(!1);r.useEffect(()=>{requestAnimationFrame(()=>{document.querySelectorAll("[data-name]").forEach(C=>{const R=C.getAttribute("data-name"),M=m.find($=>$.id===R);M&&(M.enable||C.remove())})}),d(!1)},[m,i]);const b=()=>{_("/socialradar/settings/newfetchsettings")};return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"p-6 p-space-y-6",children:[s.jsxs("div",{className:"sm:flex sm:justify-between sm:items-center mb-8",children:[s.jsx("div",{className:"mb-4 sm:mb-0",children:s.jsx("h1",{className:"text-2xl md:text-3xl text-slate-700 dark:text-slate-100 font-bold",children:"Social Buzz Projects âœ¨"})}),s.jsxs("div",{className:"grid grid-flow-col sm:auto-cols-max justify-start sm:justify-end gap-2",children:[s.jsxs("div",{className:"relative",children:[s.jsx("label",{htmlFor:"action-search",className:"sr-only",children:"Search"}),s.jsx("input",{id:"action-search",className:"form-input pl-9 bg-white dark:bg-slate-800",type:"search",placeholder:"Search Projects",value:f,onChange:u=>k(u.target.value)}),s.jsx("button",{className:"absolute inset-0 right-auto group",type:"submit","aria-label":"Search",children:s.jsxs("svg",{className:"w-4 h-4 shrink-0 fill-current text-slate-400 dark:text-slate-500 group-hover:text-slate-500 dark:group-hover:text-slate-400 ml-3 mr-2",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("path",{d:"M7 14c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7zM7 2C4.243 2 2 4.243 2 7s2.243 5 5 5 5-2.243 5-5-2.243-5-5-5z"}),s.jsx("path",{d:"M15.707 14.293L13.314 11.9a8.019 8.019 0 01-1.414 1.414l2.393 2.393a.997.997 0 001.414 0 .999.999 0 000-1.414z"})]})})]}),s.jsxs("button",{"data-name":"feature_socialRadar_main_addCollection",className:"btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white",onClick:u=>{u.preventDefault(),b()},children:[s.jsx("svg",{className:"w-4 h-4 fill-current opacity-50 shrink-0",viewBox:"0 0 16 16",children:s.jsx("path",{d:"M15 7H9V1c0-.6-.4-1-1-1S7 .4 7 1v6H1c-.6 0-1 .4-1 1s.4 1 1 1h6v6c0 .6.4 1 1 1s1-.4 1-1V9h6c.6 0 1-.4 1-1s-.4-1-1-1z"})}),s.jsx("span",{className:"hidden xs:block ml-2",children:"Add Project"})]})]})]}),s.jsx("div",{className:"dark:bg-slate-800 rounded-xl mb-8",children:s.jsx("div",{className:"flex flex-col md:flex-row md:-mr-px",children:s.jsx(et,{setCheckRendered:d,searchKey:f})})})]})})}export{yt as default};
