import{j as e,V as ve,J as Ne,r as l,b as X,u as je,K as we,d as H,Z as pe,c as ke}from"./index.js";import{u as Se}from"./index.esm.js";import{M as Te}from"./MuiDialog.js";import{S as Ae}from"./secureFetch.js";import"./iconify.js";import{t as x}from"./toastr.js";import"./DialogTitle.js";import"./useTheme.js";import"./Backdrop.js";import"./Modal.js";import"./resolveComponentProps.js";import"./useSlotProps.js";import"./Paper.js";const $e="/topic.png";function qe(t){return e.jsx("div",{className:"shadow-lg rounded-xl border px-5 py-4 bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700",children:e.jsxs("div",{className:"md:flex justify-between items-center space-y-4 md:space-y-0 space-x-2",children:[e.jsxs("div",{className:"flex items-start space-x-3 md:space-x-4",children:[e.jsx("div",{className:"w-9 h-9 shrink-0 mt-1",children:e.jsx("img",{className:"w-9 h-9 rounded-full",src:$e,width:"36",height:"36",alt:t.name})}),e.jsxs("div",{children:[e.jsx(ve,{className:"inline-flex font-semibold text-slate-700 dark:text-slate-100",to:"#",children:t.name}),e.jsx("div",{className:"text-sm break-words w-[20rem]",children:t.subtopics})]})]}),e.jsxs("div",{className:"flex items-center space-x-4 pl-10 md:pl-0",children:[e.jsx("button",{className:`btn btn-sm ${t.fav?"text-amber-500":"text-slate-50 dark:text-slate-600 hover:text-slate-400 dark:hover:text-slate-500 dark:bg-green-600 bg-green-500 "}`,onClick:b=>{t==null||t.edit(b)},children:"Edit"}),e.jsx("button",{className:`btn btn-sm ${t.fav?"text-amber-500":"text-slate-50 dark:text-slate-600 hover:text-slate-400 dark:hover:text-slate-500 dark:bg-red-600 bg-red-500"}`,onClick:b=>{t==null||t.delete(b)},children:"Delete"})]})]})})}const v=480;function J(t){var M,Z,V,B,U,Q,W;const b=Ne(),m=l.useRef(),S=X(),[T,N]=l.useState(""),[A,j]=l.useState(""),[Y,G]=l.useState([{name:"",op:""}]),[u,p]=l.useState([]),[ee,te]=l.useState(""),[w,F]=l.useState(10),[$,D]=l.useState("create"),[Fe,ae]=l.useState(""),[se,y]=l.useState(!1),[I,K]=l.useState(!1),[q,R]=l.useState(""),[c,O]=l.useState(""),[d,E]=l.useState(""),[o,C]=l.useState(""),[le,ne]=l.useState(""),[L,re]=l.useState(0),k=je(),P=k==null?void 0:k.userPermissions,ie="module_socialRadar",ce="submodule_socialRadar_newfetchsettings",_=l.useMemo(()=>we(P,ie,ce),[P]),[de,De]=l.useState(!1),oe=k.user.roles.map(a=>a._id);l.useEffect(()=>{requestAnimationFrame(()=>{document.querySelectorAll("[data-name]").forEach(r=>{const h=r.getAttribute("data-name"),n=_.find(i=>i.id===h);n&&(n.enable||r.remove())})})},[_,de]);const{register:z,handleSubmit:me,formState:{errors:g}}=Se();l.useEffect(()=>{var a,s,r;((t==null?void 0:t.rootKey)===0||(t==null?void 0:t.rootKey)>0)&&(R(t==null?void 0:t.name),O((a=t==null?void 0:t.andKeywords)==null?void 0:a.join(",")),E((s=t==null?void 0:t.orKeywords)==null?void 0:s.join(",")),C((r=t==null?void 0:t.notKeywords)==null?void 0:r.join(",")),p([...t==null?void 0:t.topics]),F(t==null?void 0:t.iterations),N("Update"),j("update"),ae("update"))},[t]);const ue=async a=>{var r;a.preventDefault();const s=a.target.files[0];if(s){((r=s.name)==null?void 0:r.toLowerCase().endsWith(".txt"))||x.warning("Please select a valid .txt file.");try{const n=new FileReader;n.onload=i=>{i.preventDefault(),i.stopPropagation();const f=i.target.result;/^[a-zA-Z0-9 ,]*$/.test(f)?(G(f),m.current.value=""):(x.error("Invalid content. Please enter alphanumeric characters, commas, and spaces only."),m.current.value="")},n.readAsText(s)}catch(n){console.error("Error reading the file:",n)}}},xe=()=>{u.push({name:T,subtopics:A}),p([...u]),y(!1)},he=()=>{p([...u==null?void 0:u.map(a=>a.name===ee?{...a,name:T,subtopics:A}:a)]),y(!1)},fe=async a=>{if(Y.length===0){x.error("Please enter some keyword in order to create a new template");return}if(u.length===0){x.error("Please add some topics in order to create a new template");return}if(w===0||w<10){x.error("Please enter value greater than equal to 10 in order to create a new template");return}if(L>v){x.error(`Total combination of AND, OR, NOT keywords characters should not exceed ${v}.`);return}const s=c.replace(/^,*(.*?),*$/g,"$1"),r=d.replace(/^,*(.*?),*$/g,"$1"),h=o.replace(/^,*(.*?),*$/g,"$1"),n={...(t==null?void 0:t.opType)==="update"&&{_id:t==null?void 0:t._id},name:q,andKeywords:[...s==null?void 0:s.split(",")],orKeywords:[...r==null?void 0:r.split(",")],notKeywords:[...h==null?void 0:h.split(",")],topics:[...u],iterations:w,rolesIds:oe};try{K(!0);const i=(t==null?void 0:t.opType)==="create"?`${H}/api/fetch/newfetchsettings`:`${H}/api/fetch/updatefetchsettings`,f=await Ae.post(i,n);if(f.error){x.error(`Error: ${f.error||f.err}`);return}f.data?((t==null?void 0:t.opType)==="update"&&b({type:"allfetchsettings-update-setting",payload:{...n}}),x.success(`Settings Successfully ${(t==null?void 0:t.opType)==="create"?"Created":"Updated"}`),S("/socialradar/projects")):x.info(`Setting: ${JSON.stringify(f)}`)}catch(i){x.error(`Error: ${i.message}`)}finally{K(!1)}};l.useEffect(()=>{var s,r,h;var a="(";(s=c==null?void 0:c.split(","))==null||s.map((n,i)=>{i<(c==null?void 0:c.split(",").length)-1?a+=n+" AND ":a+=n}),a+=" ) AND (",(r=d==null?void 0:d.split(","))==null||r.map((n,i)=>{i<(d==null?void 0:d.split(",").length)-1?a+=n+" OR ":a+=n}),a+=" ) AND (",(h=o==null?void 0:o.split(","))==null||h.map((n,i)=>{i<(o==null?void 0:o.split(",").length)-1?a+=n+" NOT ":a+=n}),a+=" )",re(c.length+d.length+o.length),ne(`${a}`)},[c,d,o]);const ge=a=>{a.preventDefault();const s=a.target.value;/^[a-zA-Z0-9,]*$/.test(s)&&s.length+d.length+o.length<=v&&O(s)},be=a=>{a.preventDefault();const s=a.target.value;/^[a-zA-Z0-9,]*$/.test(s)&&c.length+s.length+o.length<=v&&E(s)},ye=a=>{a.preventDefault();const s=a.target.value;/^[a-zA-Z0-9,]*$/.test(s)&&c.length+d.length+s.length<=v&&C(s)};return e.jsx("div",{className:"grow",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("form",{onSubmit:me(fe),children:[e.jsxs("section",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-slate-700 dark:text-slate-100",htmlFor:"default",children:"Setting Title *"}),e.jsx("div",{className:"sm:flex sm:items-center space-y-4 sm:space-y-0 sm:space-x-4 mt-2",children:e.jsxs("div",{className:"w-full",children:[e.jsx("input",{className:"form-input w-full",type:"text",id:"settingName",name:"settingName",value:q,onInput:a=>{a.preventDefault(),R(a.target.value)},...z("settingName",{required:q===""})}),((M=g.settingName)==null?void 0:M.type)==="required"&&e.jsx("span",{className:"d-block ps-3 text-red-600 text-danger text-start",children:"Settings name is required"})]})}),e.jsx("div",{className:"sm:flex sm:items-center space-y-4 sm:space-y-0 sm:space-x-4 mt-4",children:e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-slate-700 dark:text-slate-100",htmlFor:"default",children:"And Keywords *"}),e.jsx("textarea",{className:"w-full h-40 form-textarea",type:"textarea",id:"andKeywords",name:"andKeywords",placeholder:"Enter value for AND operation enter value with comma seperation",value:c,onInput:ge}),((Z=g.andKeywords)==null?void 0:Z.type)==="required"&&e.jsx("span",{className:"d-block ps-3 text-red-600 text-danger text-start",children:"And Keywords are required"})]})}),e.jsx("div",{className:"sm:flex sm:items-center space-y-4 sm:space-y-0 sm:space-x-4 mt-2",children:e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-slate-700 dark:text-slate-100",htmlFor:"default",children:"OR Keywords *"}),e.jsx("textarea",{className:"w-full h-40 form-textarea",type:"textarea",id:"orInput",name:"orKeywords",placeholder:"Enter value for OR operation with comma seperation",value:d,onInput:be}),((V=g.orKeywords)==null?void 0:V.type)==="required"&&e.jsx("span",{className:"d-block ps-3 text-red-600 text-danger text-start",children:"OR Keywords are required"})]})}),e.jsx("div",{className:"sm:flex sm:items-center space-y-4 sm:space-y-0 sm:space-x-4 mt-2",children:e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium mb-1 text-slate-700 dark:text-slate-100",htmlFor:"default",children:"NOT Keywords *"}),e.jsx("textarea",{className:"w-full h-40 form-textarea",type:"textarea",id:"notKeywords",name:"notKeywords",placeholder:"Enter value for NOT operation with comma seperation",value:o,onInput:ye}),((B=g.notKeywords)==null?void 0:B.type)==="required"&&e.jsx("span",{className:"d-block ps-3 text-red-600 text-danger text-start",children:"Not Keywords are required"})]})}),e.jsxs("div",{children:[e.jsxs("div",{className:" mt-1",children:[e.jsx("div",{className:"sm:w-1/3 w-60",children:e.jsx("input",{id:`${t==null?void 0:t.name}-fileInput`,type:"file",style:{visibility:"hidden"},ref:m,accept:".txt",onChange:ue})}),e.jsxs("div",{className:"w-full max-w-[980px]",children:[e.jsxs("label",{className:"text-slate-700 dark:text-slate-100 font-bold",htmlFor:"",children:["Query: ",L," (max characters: ",v,")"]}),e.jsx("p",{id:`${t==null?void 0:t.name}-query`,className:"text-slate-700 dark:text-slate-100 text-sm break-words",children:le})]})]}),e.jsx("button",{"data-name":"feature_socialRadar_newfetchsettings_addTopics",className:"btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white","aria-controls":"basic-modal",onClick:a=>{a.preventDefault(),a.stopPropagation(),N(""),j(""),D("create"),y(!0)},children:"Add Topic"}),e.jsx("div",{className:"space-y-2 mt-2",children:u.map(a=>e.jsx(qe,{name:a.name,image:a.image,subtopics:a.subtopics,type:a.type,delete:s=>{s.preventDefault(),s.stopPropagation(),u.pop(),p([...u])},edit:s=>{s.preventDefault(),s.stopPropagation(),N(a.name),j(a.subtopics),D("edit"),te(a.name),y(!0)}},a.name))}),e.jsx("label",{className:"mt-3 block text-sm font-medium mb-1 text-slate-700 dark:text-slate-100",htmlFor:"default",children:"Target Size *"}),e.jsx("div",{className:"sm:flex sm:items-center space-y-4 sm:space-y-0 sm:space-x-4 mt-2",children:e.jsxs("div",{className:"w-full",children:[e.jsx("input",{className:"form-input w-full",type:"text",id:"iterations",name:"iterations",value:w,onInput:a=>{a.preventDefault(),/^[0-9]*$/.test(a.target.value)&&F(a.target.value)},...z("iterations",{required:w===""})}),((U=g.iterations)==null?void 0:U.type)==="required"&&e.jsx("span",{className:"d-block ps-3 text-red-600 text-danger text-start",children:"Iterations is required"})]})})]})]}),e.jsx("footer",{"data-name":"feature_socialRadar_newfetchsettings_createSettings",children:e.jsx("div",{className:"flex flex-col px-6 py-5 border-slate-200 dark:border-slate-700",children:e.jsx("div",{className:"flex self-end",children:e.jsxs("button",{type:"submit",className:"btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white disabled:border-gray-200 dark:disabled:border-gray-700 disabled:bg-white dark:disabled:bg-gray-800 disabled:text-gray-300 dark:disabled:text-gray-600 disabled:cursor-not-allowed",disabled:I,children:[I&&e.jsx("svg",{className:"animate-spin fill-current shrink-0",width:"16",height:"16",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M8 16a7.928 7.928 0 01-3.428-.77l.857-1.807A6.006 6.006 0 0014 8c0-3.309-2.691-6-6-6a6.006 6.006 0 00-5.422 8.572l-1.806.859A7.929 7.929 0 010 8c0-4.411 3.589-8 8-8s8 3.589 8 8-3.589 8-8 8z"})}),t!=null&&t.iterations?"Update Settings":"Create Settings"]})})})})]}),e.jsx(Te,{id:"topic-modal-1234",open:se,setOpen:()=>y(!1),title:"Add New Topic Settings",fullWidth:!0,maxWidth:"md",isAction:!0,cancelHandler:()=>y(!1),opType:$==="edit"?"update":"create",submitHandler:()=>{$==="create"&&xe(),$==="edit"&&he()},paperOverflow:!0,children:e.jsx("div",{className:"px-5 pt-4 pb-1",children:e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"sm:flex sm:items-center space-y-4 sm:space-y-0 sm:space-x-4 mt-5",children:e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"Topic Name",children:"Topic Name *"}),e.jsx("input",{className:"form-input w-full",type:"text",id:"topicname",name:"topicname",value:T,onInput:a=>{a.preventDefault(),/^[a-zA-Z0-9]*$/.test(a.target.value)&&N(a.target.value)},onChange:a=>N(a.target.value)}),((Q=g.topicname)==null?void 0:Q.type)==="required"&&e.jsx("span",{className:"d-block ps-3 text-red-600 text-danger text-start",children:"Topic Name is required"})]})}),e.jsx("div",{className:"sm:flex sm:items-center space-y-4 sm:space-y-0 sm:space-x-4 mt-5",children:e.jsxs("div",{className:"w-full",children:[e.jsx("label",{htmlFor:"topics",children:"Subtopics *"}),e.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-100 mb-2 text-xs",children:"seperate by comma"}),e.jsx("textarea",{className:"form-textarea w-full",id:"subtopics",name:"subtopics",placeholder:"",value:A,onInput:a=>{a.preventDefault(),/^[a-zA-Z0-9,]*$/.test(a.target.value)&&j(a.target.value)},onChange:a=>j(a.target.value)}),((W=g.subtopics)==null?void 0:W.type)==="required"&&e.jsx("span",{className:"d-block ps-3 text-red-600 text-danger text-start",children:"subtopics are required"})]})})]})})})]})})}function Be(){const t=pe(),m=ke().state,S=X();return l.useEffect(()=>{!m&&t.operation==="updatefetchsettings"&&S("/socialradar/projects")},[m,t]),e.jsx("div",{className:"flex h-[100dvh] overflow-hidden",children:e.jsx("div",{className:"relative flex flex-col flex-1 overflow-y-auto overflow-x-hidden",children:e.jsx(e.Fragment,{children:e.jsxs("div",{className:"px-4 sm:px-6 lg:px-8 py-8 w-full max-w-9xl mx-auto",children:[e.jsx("div",{className:"mb-8",children:e.jsx("h1",{className:"text-2xl md:text-3xl text-slate-700 dark:text-slate-100 font-bold",children:"Social Buzz Settings ✨"})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl mb-8 flex justify-center",children:e.jsxs("div",{className:"flex md:-mr-px w-full",children:[t.operation==="updatefetchsettings"&&e.jsx(J,{rootKey:m==null?void 0:m.rootKey,opType:"update",...m}),t.operation==="newfetchsettings"&&e.jsx(J,{opType:"create"})]})})]})})})})}export{Be as default};
