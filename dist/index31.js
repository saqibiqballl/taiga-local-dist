import{v as b,w as x,L as y,P as F,G as A,y as S,z as w,A as _,H as L,F as M,D as p,j as t,x as E,r as l,J as R,u as Z,K as $,M as U}from"./index.js";import{C as W}from"./CardWithAnalytics.js";import{L as I,B as O}from"./index3.js";import"./chartjs-adapter-moment.esm.js";import{L as h}from"./leaflet-src.js";import"./leaflet-heat.js";import{W as V}from"./connection2.js";import{a as D}from"./apiBaseEndPoints.js";import{w as j}from"./socket.js";import"./moment.js";b.register(x,y,F,A,S,w,_,L);const q=({screenshotsPerDay:e})=>{M();const n={labels:[...new Set(e==null?void 0:e.map(s=>s.date))].sort(),datasets:[{label:"Screenshots",data:e==null?void 0:e.map(s=>s?s.screenshots:0),borderColor:p().theme.colors.blue[500],backgroundColor:`${p().theme.colors.blue[500]}33`,fill:!0,borderWidth:2,pointRadius:0,pointHoverRadius:3,pointBackgroundColor:p().theme.colors.blue[500],pointHoverBackgroundColor:p().theme.colors.blue[500],pointBorderWidth:0,pointHoverBorderWidth:0,clip:20,tension:.2}]},r={responsive:!0,plugins:{legend:{position:"top"},tooltip:{callbacks:{label:function(s){return`${s.dataset.label}: ${s.raw} screenshots`}}}},scales:{x:{grid:{display:!1},title:{display:!0,text:"Date"}},y:{grid:{display:!1},title:{display:!0,text:"Screenshots"},beginAtZero:!0}}};return t.jsx(I,{data:n,options:r})};function G({screenshotsPerDay:e,dateFilter:o,setDateFilter:n}){return t.jsxs("div",{className:"flex flex-col col-span-full sm:col-span-12 bg-white dark:bg-slate-800 shadow-lg rounded-xl border border-slate-200 dark:border-slate-700",children:[t.jsxs("header",{className:"flex justify-between items-center px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:[t.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Screenshots Per Day of Current Month"}),t.jsx("input",{className:"form-input",type:"month",value:o,onChange:r=>{n(r.target.value)}})]}),t.jsx(q,{screenshotsPerDay:e})]})}b.register(x,y,E,S,w,_);const P=({geographicalDistribution:e=[]})=>{const[o,n]=l.useState(window.innerHeight*.6);l.useEffect(()=>{const s=()=>{n(window.innerHeight*.6)};return window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s)}},[]);const r=l.useRef(null);return l.useEffect(()=>{if(!r.current||!h.version)return;const s=h.map(r.current).setView([20,0],2);h.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(s);const i=e==null?void 0:e.map(({lat:f,lng:v,successful_screenshots:a})=>[f,v,a*1e3]);return h.heatLayer(i,{radius:60,blur:40,maxZoom:17,gradient:{.2:"blue",.5:"orange",.7:"yellow",.9:"red"}}).addTo(s),()=>{s.remove()}},[e]),t.jsx("div",{className:"bg-white dark:bg-slate-800 shadow-lg rounded-xl border border-slate-200 dark:border-slate-700",children:t.jsx("div",{ref:r,style:{height:`${o}px`}})})};function J({capturedScreenshotsByCountry:e}){return t.jsxs("div",{className:"flex flex-col col-span-full sm:col-span-6 xl:col-span-4 bg-white dark:bg-gray-800 shadow-xs rounded-xl",children:[t.jsx("header",{className:"px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:t.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Captured Screenshots By Country"})}),t.jsx(P,{geographicalDistribution:e})]})}b.register(x,y,E,S,w,_);const K=({capturedScreenshotsByCategory:e})=>{const o=e==null?void 0:e.map(i=>i._id?i._id.length>10?`${i._id.slice(0,10)}...`:i._id:"Unknown"),n=e==null?void 0:e.map(i=>i.successful_screenshots),r={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{x:{grid:{display:!1},ticks:{color:p().theme.colors.gray[700],autoSkip:!1}},y:{grid:{display:!1},title:{display:!0,text:"Successful Screenshots"},ticks:{beginAtZero:!0,color:p().theme.colors.gray[700]}}}},s={labels:o,datasets:[{barPercentage:.5,categoryPercentage:.5,label:"Successful Screenshots",data:n,backgroundColor:p().theme.colors.violet[500],hoverBackgroundColor:p().theme.colors.violet[600],borderRadius:4}]};return t.jsx("div",{className:"w-full mx-auto",style:{height:"100%"},children:t.jsx(O,{options:r,data:s})})};function Y({capturedScreenshotsByCategory:e}){const[o,n]=l.useState(window.innerHeight*.7);return l.useEffect(()=>{const r=()=>{n(window.innerHeight*.7)};return window.addEventListener("resize",r),()=>{window.removeEventListener("resize",r)}},[]),t.jsxs("div",{style:{height:`${o}px`},className:"flex flex-col col-span-full sm:col-span-6 xl:col-span-4 bg-white dark:bg-gray-800 shadow-xs rounded-xl",children:[t.jsx("header",{className:"px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:t.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Captured Screenshots By Category"})}),t.jsx(K,{capturedScreenshotsByCategory:e})]})}function ie(){const e=R(),o=Z(),n=o==null?void 0:o.userPermissions,r="module_webshotBuzz",s="submodule_webshotBuzz_main",i=l.useMemo(()=>$(n,r,s),[n]),[f,v]=l.useState(!1);l.useEffect(()=>{requestAnimationFrame(()=>{document.querySelectorAll("[data-name]").forEach(u=>{const T=u.getAttribute("data-name"),B=i.find(N=>N.id===T);B&&(B.enable||u.remove())})})},[i,f]);const{cardNumbers:a,graphAnalytics:d}=U(c=>c.webShotBuzz.webShotBuzzMain),C=new Date,[g,z]=l.useState(`${C.getFullYear()}-${String(C.getMonth()+1).padStart(2,"0")}`),k=[{title:"Total Screenshots",value:(a==null?void 0:a.totalScreenshots)??0},{title:"Total Sources",value:(a==null?void 0:a.totalSources)??0},{title:"Total Urls",value:(a==null?void 0:a.totalUrls)??0},{title:"Total Countries",value:(a==null?void 0:a.totalCountries)??0}],H=async()=>{const[c,m]=g.split("-").map(Number);e({type:"FETCH_WEBSHOT_BUZZ_MAIN_START"});try{const u=await V.get(`${D.dashboard}?year=${c}&month=${m}`);u.status===200&&e({type:"FETCH_WEBSHOT_BUZZ_MAIN_SUCCESS",payload:{cardNumbers:u.data.numbers,graphAnalytics:u.data.graphs}})}catch(u){console.error(u),e({type:"FETCH_WEBSHOT_BUZZ_MAIN_FAILURE",payload:u.message})}};return l.useEffect(()=>(j.on("capturedScreenshotsByCountry",c=>{e({type:"FETCH_WEBSHOT_BUZZ_MAIN_SUCCESS",payload:{cardNumbers:a,graphAnalytics:{...d,capturedScreenshotsByCountry:c}}})}),()=>{j.off("capturedScreenshotsByCountry")}),[e,a,d]),l.useEffect(()=>{H()},[g]),t.jsx(t.Fragment,{children:t.jsxs("div",{className:"grid grid-cols-12 gap-5 p-2",children:[k.map((c,m)=>t.jsx("div",{"data-name":"feature_webshotBuzz_main_number_analytics",className:"col-span-12 sm:col-span-6 lg:col-span-3",children:t.jsx(W,{title:c.title,subTitle:c.subTitle,value:c.value,percentage:c.percentage},m)},m)),t.jsx("div",{"data-name":"feature_webshotBuzz_main_capturedScreenshotsByCountry",className:"col-span-12 md:col-span-6",children:t.jsx(J,{capturedScreenshotsByCountry:d==null?void 0:d.capturedScreenshotsByCountry})}),t.jsx("div",{"data-name":"feature_webshotBuzz_main_capturedScreenshotsByCategory",className:"col-span-12 md:col-span-6",children:t.jsx(Y,{capturedScreenshotsByCategory:d==null?void 0:d.capturedScreenshotsByCategory})}),t.jsx("div",{"data-name":"feature_webshotBuzz_main_screenshotsPerDayOfCurrentMonth",className:"col-span-12 md:col-span-12",children:t.jsx(G,{screenshotsPerDay:d==null?void 0:d.screenshotsPerDay,dateFilter:g,setDateFilter:z})})]})})}export{ie as default};
