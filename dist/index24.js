import{v as j,w as R,L as S,x as I,y as A,z as v,A as E,D as w,j as e,E as U,r as p,aD as $,G as L,H as D,P as H,aE as Z,F as V,I as O,C as K,J as W,u as Y,K as q,M as z,d as T}from"./index.js";import{C as G}from"./CardWithAnalytics.js";import{B as J,P as Q,L as X}from"./index3.js";import"./chartjs-adapter-moment.esm.js";import"./dayjs.min.js";import{S as ee}from"./SingleSelectDropdown.js";import{R as B}from"./connection.js";import"./moment.js";j.register(R,S,I,A,v,E);const ae=({trendingTopics:a})=>{const r=a==null?void 0:a.map(o=>o._id.length>10?`${o._id.slice(0,10)}...`:o._id),t=a==null?void 0:a.map(o=>o.count),s={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},tooltip:{callbacks:{title:o=>a[o[0].dataIndex]._id}}},scales:{x:{grid:{display:!1},ticks:{color:w().theme.colors.gray[700],autoSkip:!1}},y:{grid:{display:!1},title:{display:!0,text:"Counts"},ticks:{beginAtZero:!0,color:w().theme.colors.gray[700]}}}},d={labels:r,datasets:[{barPercentage:.5,categoryPercentage:.5,label:"Count",data:t,backgroundColor:w().theme.colors.violet[500],hoverBackgroundColor:w().theme.colors.violet[600],borderRadius:4}]};return e.jsx("div",{className:"h-[305px]",children:e.jsx(J,{options:s,data:d})})};function te({trendingTopics:a}){return e.jsxs("div",{className:"flex flex-col col-span-full sm:col-span-6 xl:col-span-4 bg-white dark:bg-gray-800 shadow-xs rounded-xl",children:[e.jsx("header",{className:"px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:e.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Trending Topics"})}),e.jsx(ae,{trendingTopics:a})]})}j.register(R,S,I,A,v,E);function se({data:a,columns:r}){return e.jsx("div",{children:e.jsx("div",{className:"p-3",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full dark:text-gray-300",children:[e.jsx("thead",{className:"text-xs uppercase text-gray-400 dark:text-gray-500 bg-gray-50 dark:bg-gray-700 dark:bg-opacity-50 rounded-sm",children:e.jsx("tr",{children:r==null?void 0:r.map((t,s)=>e.jsx("th",{className:"p-2 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:t})},s))})}),e.jsx("tbody",{className:"text-sm divide-y divide-gray-100 dark:divide-gray-700/60",children:a==null?void 0:a.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 whitespace-nowrap",children:t==null?void 0:t._id}),e.jsx("td",{className:"p-2 whitespace-nowrap",children:t==null?void 0:t.count})]},s))})]})})})})}function re({trendingHashtags:a}){const r=["Hash Tag","Count"];return e.jsxs("div",{className:"flex flex-col col-span-full sm:col-span-6 xl:col-span-4 bg-white dark:bg-gray-800 shadow-xs rounded-xl",children:[e.jsx("header",{className:"px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:e.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Trending Hashtags"})}),e.jsx(se,{columns:r,data:a})]})}j.register(R,S,I,A,v,E);function le({data:a,columns:r}){return e.jsx("div",{children:e.jsx("div",{className:"p-3",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full dark:text-gray-300",children:[e.jsx("thead",{className:"text-xs uppercase text-gray-400 dark:text-gray-500 bg-gray-50 dark:bg-gray-700 dark:bg-opacity-50 rounded-sm",children:e.jsx("tr",{children:r==null?void 0:r.map((t,s)=>e.jsx("th",{className:"p-2 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:t})},s))})}),e.jsx("tbody",{className:"text-sm divide-y divide-gray-100 dark:divide-gray-700/60",children:a==null?void 0:a.map((t,s)=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 whitespace-nowrap",children:t==null?void 0:t.username}),e.jsx("td",{className:"p-2 whitespace-nowrap",children:t==null?void 0:t.followers})]},s))})]})})})})}function oe({topInfluencers:a}){const r=["User Name","Followers"];return e.jsxs("div",{className:"flex flex-col col-span-full sm:col-span-6 xl:col-span-4 bg-white dark:bg-gray-800 shadow-xs rounded-xl",children:[e.jsx("header",{className:"px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:e.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Trending Influencers"})}),e.jsx(le,{data:a,columns:r})]})}j.register(U,v,E);const ne=({chartData:a})=>{const r=["Positive","Negative","Neutral"],t=p.useMemo(()=>{const c=a==null?void 0:a.sentimentBreakdown;if(!c)return[0,0,0];const{positive:m=0,negative:f=0,neutral:g=0}=c,b=m+f+g;return b===0?[0,0,0]:[(m/b*100).toFixed(2),(f/b*100).toFixed(2),(g/b*100).toFixed(2)]},[a]),s=["#36A2EB","#FF6384","#FFCE56"],d={labels:r,datasets:[{label:"Sentiment Percentage",data:t,backgroundColor:s,hoverBackgroundColor:s.map(c=>`${c}B3`),borderWidth:0}]},o={responsive:!0,plugins:{legend:{position:"left"},tooltip:{callbacks:{label:function(c){const m=c.label||"",f=c.raw||0;return`${m}: ${f}%`}}}}};return e.jsx("div",{style:{height:"267px",width:"300px",margin:"0 auto"},children:e.jsx(Q,{data:d,options:o})})};j.register($,L,D,H,S,Z,v);function ie({sentimentBreakdown:a}){const[r,t]=p.useState(""),s=p.useMemo(()=>a==null?void 0:a.map(o=>({label:o.topic,value:o.topic})),[a]);p.useEffect(()=>{(s==null?void 0:s.length)>0&&t(s[0])},[s]);const d=p.useMemo(()=>a==null?void 0:a.find(o=>o.topic===r.value),[r]);return e.jsxs("div",{className:"flex flex-col col-span-full sm:col-span-6 xl:col-span-4 bg-white dark:bg-gray-800 shadow-xs rounded-xl",children:[e.jsxs("header",{className:"px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:[e.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Sentiment Breakdown"}),e.jsx(ee,{options:s,labelNValue:!0,selectedValue:r.value,onSelect:o=>t(o),label:"Select a topic",clearable:!1})]}),e.jsx(ne,{chartData:d})]})}j.register(R,S,H,L,A,v,E);const de=({engagementMetrics:a=[]})=>{const{currentTheme:r}=V(),t=r==="dark",{textColor:s,gridColor:d,tooltipBodyColor:o,tooltipBgColor:c,tooltipBorderColor:m}=O,g=(()=>{if(a.length===0||a[0].dailyMetrics.length===0)return[];const u=new Date(a[0].dailyMetrics[0].date),y=u.getFullYear(),h=u.getMonth(),_=new Date(y,h+1,0).getDate();return Array.from({length:_},(k,l)=>{const x=l+1;return`${y}-${String(h+1).padStart(2,"0")}-${String(x).padStart(2,"0")}`})})(),b=a==null?void 0:a.map((u,y)=>{const h=w().theme.colors,_=["white","gray","slate","red","yellow","orange","pink","black","current","neutral","transparent","stone","zinc","inherit"],k=Object.keys(h).filter(C=>!_.includes(C)),l=500,x=k[y%k.length],F=g==null?void 0:g.map(C=>{var M;const N=(M=u==null?void 0:u.dailyMetrics)==null?void 0:M.find(P=>P.date===C);return N?N.retweets:0});return{label:u._id,data:F,borderColor:h[x][l],fill:!1,borderWidth:2,pointRadius:0,pointHoverRadius:3,pointBackgroundColor:h[x][l],pointHoverBackgroundColor:h[x][l],pointBorderWidth:0,pointHoverBorderWidth:0,clip:20,tension:.2}}),i={labels:g,datasets:b},n={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{color:t?s.dark:s.light}},tooltip:{callbacks:{label:function(u){return`${u.dataset.label}: ${u.raw} points`}},backgroundColor:t?c.dark:c.light,bodyColor:t?o.dark:o.light,borderColor:t?m.dark:m.light}},scales:{x:{grid:{color:t?d.dark:d.light},title:{display:!0,text:"Date",color:t?s.dark:s.light},ticks:{color:t?s.dark:s.light,maxRotation:45,minRotation:45,autoSkip:!1}},y:{grid:{color:t?d.dark:d.light},title:{display:!0,text:"Retweets",color:t?s.dark:s.light},ticks:{color:t?s.dark:s.light},beginAtZero:!0}}};return e.jsx("div",{className:"h-[305px]",children:e.jsx(X,{data:i,options:n})})};function ce({engagementMetricsLoading:a,engagementMetrics:r,engagementMonthFilter:t,setEngagementMonthFilter:s}){return e.jsxs("div",{className:"flex flex-col col-span-full sm:col-span-12 bg-white dark:bg-slate-800 shadow-lg rounded-xl border border-slate-200 dark:border-slate-700",children:[e.jsxs("header",{className:"flex justify-between items-center px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:[e.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Engagement Metrics"}),e.jsx("input",{className:"form-input",type:"month",disabled:a,value:t,onChange:d=>{s(d.target.value)}})]}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{engagementMetrics:r}),a&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(K,{})})]})]})}function ye(){const a=W(),r=Y(),t=r==null?void 0:r.userPermissions,s="module_socialRadar",d="submodule_socialRadar_main",o=p.useMemo(()=>q(t,s,d),[t]),[c,m]=p.useState(!1),f=new Date,[g,b]=p.useState(`${f.getFullYear()}-${String(f.getMonth()+1).padStart(2,"0")}`),{cardNumbers:i,graphAnalytics:n}=z(l=>l.socialRadar.socialMain),[u,y]=p.useState(!1);p.useEffect(()=>{requestAnimationFrame(()=>{document.querySelectorAll("[data-name]").forEach(F=>{const C=F.getAttribute("data-name"),N=o.find(M=>M.id===C);N&&(N.enable||F.remove())})})},[o,c]);const h=async()=>{a({type:"FETCH_SOCIAL_BUZZ_MAIN_START"});try{const l=await B.get(`${T}/api/social_main`);l.status===200&&a({type:"FETCH_SOCIAL_BUZZ_MAIN_SUCCESS",payload:{cardNumbers:l.data.numbers,graphAnalytics:l.data.graphAnalytics}})}catch(l){console.error(l),a({type:"FETCH_SOCIAL_BUZZ_MAIN_FAILURE",payload:l.message})}},_=async()=>{y(!0);try{const l=await B.post(`${T}/api/social_main/engagementMetrics`,{monthYearFilter:g});l.status===200&&(a({type:"FETCH_SOCIAL_BUZZ_MAIN_SUCCESS",payload:{cardNumbers:i,graphAnalytics:{...n,engagementMetrics:l.data.engagementMetrics}}}),y(!1))}catch(l){console.error(l),y(!1),a({type:"FETCH_SOCIAL_BUZZ_MAIN_FAILURE",payload:l.message})}};p.useEffect(()=>{_()},[g]),p.useEffect(()=>{h()},[]);const k=[{title:"Total Tweets",value:(i==null?void 0:i.totalTweets)??0},{title:"Verified Users",value:(i==null?void 0:i.verifiedUsers)??0},{title:"Keywords",value:(i==null?void 0:i.totalKeywords)??0},{title:"Projects",value:(i==null?void 0:i.totalProjects)??0}];return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-12 gap-5 p-2",children:[k.map((l,x)=>e.jsx("div",{"data-name":"feature_socialRadar_main_number_analytics",className:"col-span-12 sm:col-span-6 lg:col-span-3",children:e.jsx(G,{title:l.title,subTitle:l.subTitle,value:l.value,percentage:l.percentage},x)},x)),e.jsx("div",{"data-name":"feature_socialRadar_main_trending_topics_chart",className:"col-span-12 md:col-span-6",children:e.jsx(te,{trendingTopics:n==null?void 0:n.trendingTopics})}),e.jsx("div",{"data-name":"feature_socialRadar_main_sentiment_breakdown_chart",className:"col-span-12 md:col-span-6",children:e.jsx(ie,{sentimentBreakdown:n==null?void 0:n.sentimentBreakdownByTopics})}),e.jsx("div",{"data-name":"feature_socialRadar_main_trending_hashtag_chart",className:"col-span-12 md:col-span-6",children:e.jsx(re,{trendingHashtags:n==null?void 0:n.trendingHashtags})}),e.jsx("div",{"data-name":"feature_socialRadar_main_trending_influencers_chart",className:"col-span-12 md:col-span-6",children:e.jsx(oe,{topInfluencers:n==null?void 0:n.topInfluencers})}),e.jsx("div",{"data-name":"feature_socialRadar_main_engagementMatrics_chart",className:"col-span-12 md:col-span-12",children:e.jsx(ce,{engagementMetricsLoading:u,engagementMetrics:n==null?void 0:n.engagementMetrics,engagementMonthFilter:g,setEngagementMonthFilter:b})})]})})}export{ye as default};
