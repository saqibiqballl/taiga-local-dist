import{v as S,w as E,L as M,P as U,G as z,y as N,z as A,A as D,F as B,j as e,I as Y,r as n,x as O,D as b,J as $,u as V,K as W,M as q,W as C,X as _}from"./index.js";import{C as Z}from"./CardWithAnalytics.js";import{d as v}from"./dayjs.min.js";import{L as G,B as J}from"./index3.js";import{S as K}from"./SingleSelectDropdown.js";import"./chartjs-adapter-moment.esm.js";import{L as y}from"./leaflet-src.js";import"./leaflet-heat.js";import{m as k}from"./socket.js";import"./moment.js";S.register(E,M,U,z,N,A,D);const X=({postCountData:a})=>{const{currentTheme:r}=B(),s=r==="dark",{textColor:t,gridColor:o,tooltipBodyColor:d,tooltipBgColor:x,tooltipBorderColor:p}=Y,h=(a==null?void 0:a.map(g=>g.date))||[],i=(a==null?void 0:a.map(g=>g.count))||[],u={labels:h,datasets:[{label:"Post Count",data:i,borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.2)",fill:!0,borderWidth:2,pointRadius:4,pointBackgroundColor:"#3b82f6",pointHoverRadius:6,tension:.3}]},c={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{color:s?t.dark:t.light}},tooltip:{backgroundColor:s?x.dark:x.light,titleColor:s?d.dark:d.light,bodyColor:s?d.dark:d.light,borderColor:s?p.dark:p.light,borderWidth:1,callbacks:{label:function(g){return`${g.label}: ${g.raw}`}}}},scales:{x:{grid:{color:s?o.dark:o.light},title:{display:!0,text:"Date",color:s?t.dark:t.light},ticks:{color:s?t.dark:t.light}},y:{beginAtZero:!0,grid:{color:s?o.dark:o.light},title:{display:!0,text:"Post Count",color:s?t.dark:t.light},ticks:{color:s?t.dark:t.light,stepSize:10},suggestedMin:0}}};return e.jsx("div",{style:{height:"100%"},children:e.jsx(G,{data:u,options:c})})};function Q({postCountSelectedMonth:a,setPostCountSelectedMonth:r,postCountData:s}){const[t,o]=n.useState(window.innerHeight*.6),[d,x]=n.useState([]);return n.useEffect(()=>{const p=()=>{o(window.innerHeight*.6)};return window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)}},[]),n.useEffect(()=>{x((()=>{const h=[];for(let i=0;i<5;i++){const u=v().subtract(i,"month");h.push({label:u.format("MMMM YYYY"),value:u.format("YYYY-MM")})}return h.reverse()})())},[]),e.jsxs("div",{style:{height:`${t}px`},className:"flex flex-col col-span-full sm:col-span-6 xl:col-span-4 bg-white dark:bg-gray-800 shadow-xs rounded-xl",children:[e.jsxs("header",{className:"flex justify-between px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:[e.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Last 5 Months Post Counts"}),e.jsx("div",{className:"font-semibold text-gray-800 dark:text-gray-100",children:e.jsx(K,{options:d,labelNValue:!0,label:"Select a month",selectedValue:a==null?void 0:a.value,onSelect:p=>{r(p)},clearable:!1})})]}),e.jsx(X,{postCountData:s})]})}S.register(E,M,O,N,A,D);const ee=({publicationFrequencySelectedDate:a,publicationFrequency:r})=>{console.log("publicationFrequency",r);const s=r==null?void 0:r.labels,t=r==null?void 0:r.data,o={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{x:{grid:{display:!1},title:{display:!0,text:v(a).format("MMM")},ticks:{color:b().theme.colors.gray[700],autoSkip:!1}},y:{grid:{display:!1},title:{display:!0,text:"Counts"},ticks:{beginAtZero:!0,color:b().theme.colors.gray[700]}}}},d={labels:s,datasets:[{barPercentage:.5,categoryPercentage:.5,label:"Count",data:t,backgroundColor:b().theme.colors.violet[500],hoverBackgroundColor:b().theme.colors.violet[600],borderRadius:4}]};return e.jsx("div",{style:{height:"100%",width:"100%"},children:e.jsx(J,{options:o,data:d})})};function te({publicationFrequencySelectedDate:a,setPublicationFrequencySelectedDate:r,publicationFrequency:s}){const[t,o]=n.useState(window.innerHeight*.6);return n.useEffect(()=>{const d=()=>{o(window.innerHeight*.6)};return window.addEventListener("resize",d),()=>{window.removeEventListener("resize",d)}},[]),e.jsxs("div",{style:{height:`${t}px`},className:"flex flex-col col-span-full sm:col-span-6 xl:col-span-4 bg-white dark:bg-gray-800 shadow-xs rounded-xl",children:[e.jsxs("header",{className:"flex justify-between px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:[e.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:"Publication FrequencyÂ "}),e.jsx("input",{className:"form-input",type:"month",value:a,onChange:d=>{r(d.target.value)}})]}),e.jsx(ee,{publicationFrequencySelectedDate:a,publicationFrequency:s})]})}const ae=({geographicalDistribution:a=[]})=>{const[r,s]=n.useState(window.innerHeight*.6);n.useEffect(()=>{const o=()=>{s(window.innerHeight*.6)};return window.addEventListener("resize",o),()=>{window.removeEventListener("resize",o)}},[]);const t=n.useRef(null);return n.useEffect(()=>{if(!t.current||!y.version)return;const o=y.map(t.current).setView([20,0],2);y.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors"}).addTo(o);const d=a==null?void 0:a.map(({lat:x,lng:p,percentage:h})=>[x,p,1e3]);return y.heatLayer(d,{radius:60,blur:40,maxZoom:17,gradient:{.2:"blue",.5:"orange",.7:"yellow",.9:"red"}}).addTo(o),()=>{o.remove()}},[a]),e.jsx("div",{className:"bg-white dark:bg-slate-800 shadow-lg rounded-xl border border-slate-200 dark:border-slate-700",children:e.jsx("div",{ref:t,style:{height:`${r}px`}})})};function se({title:a,data:r,columns:s}){return e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-lg rounded-xl border border-slate-200 dark:border-slate-700",children:[e.jsx("header",{className:"px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:e.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:a})}),e.jsx("div",{className:"p-3",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full dark:text-gray-300",children:[e.jsx("thead",{className:"text-xs uppercase text-gray-400 dark:text-gray-500 bg-gray-50 dark:bg-gray-700 dark:bg-opacity-50 rounded-sm",children:e.jsx("tr",{children:s==null?void 0:s.map((t,o)=>e.jsx("th",{className:"p-2 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:t})},o))})}),e.jsx("tbody",{className:"text-sm divide-y divide-gray-100 dark:divide-gray-700/60",children:r==null?void 0:r.map((t,o)=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 whitespace-nowrap",children:t==null?void 0:t.domain_name}),e.jsx("td",{className:"p-2 whitespace-nowrap",children:t==null?void 0:t.total_post})]},o))})]})})})]})}function re({title:a,data:r,columns:s}){return e.jsxs("div",{className:"bg-white dark:bg-slate-800 shadow-lg rounded-xl border border-slate-200 dark:border-slate-700",children:[e.jsx("header",{className:"px-5 py-4 border-b border-gray-100 dark:border-gray-700/60",children:e.jsx("h2",{className:"font-semibold text-gray-800 dark:text-gray-100",children:a})}),e.jsx("div",{className:"p-3",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full dark:text-gray-300",children:[e.jsx("thead",{className:"text-xs uppercase text-gray-400 dark:text-gray-500 bg-gray-50 dark:bg-gray-700 dark:bg-opacity-50 rounded-sm",children:e.jsx("tr",{children:s==null?void 0:s.map((t,o)=>e.jsx("th",{className:"p-2 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:t})},o))})}),e.jsx("tbody",{className:"text-sm divide-y divide-gray-100 dark:divide-gray-700/60",children:r==null?void 0:r.map((t,o)=>e.jsxs("tr",{children:[e.jsx("td",{className:"p-2 whitespace-nowrap",children:t==null?void 0:t.title}),e.jsx("td",{className:"p-2 whitespace-nowrap",children:t==null?void 0:t.source}),e.jsx("td",{className:"p-2 whitespace-nowrap",children:v(t==null?void 0:t.pubDate).format("YYYY-DD-MM")})]},o))})]})})})]})}function me(){const a=$(),r=V(),s=r==null?void 0:r.userPermissions,t="module_mediaCloud",o="submodule_mediaCloud_main",d=n.useMemo(()=>W(s,t,o),[s]),[x,p]=n.useState(!1);n.useEffect(()=>{requestAnimationFrame(()=>{document.querySelectorAll("[data-name]").forEach(w=>{const P=w.getAttribute("data-name"),j=d.find(R=>R.id===P);j&&(j.enable||w.remove())})})},[d,x]);const h=new Date,{cardNumbers:i,tableAnalytics:u,graphAnalytics:c}=q(l=>l.mediaCloud.mediaCloudMain),[g,T]=n.useState({label:"",value:`${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}`}),[f,L]=n.useState(`${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}`),I=async()=>{a({type:"FETCH_MEDIA_CLOUD_MAIN_START"});try{const l=await C.get(`${_.dashboard}`);l.status===200&&a({type:"FETCH_MEDIA_CLOUD_MAIN_SUCCESS",payload:{cardNumbers:l.data.numbers,tableAnalytics:{top5Sources:l.data.top5Sources,top5Articles:l.data.top5Articles},graphAnalytics:{...c,geographicalDistribution:l.data.geographicalDistribution}}})}catch(l){console.error(l),a({type:"FETCH_MEDIA_CLOUD_MAIN_FAILURE",payload:l.message})}};n.useEffect(()=>{I()},[]);const F=async()=>{a({type:"FETCH_MEDIA_CLOUD_MAIN_START"});try{const l=await C.post(`${_.dashboard}/post-count`,{date:g.value});l.status===200&&a({type:"FETCH_MEDIA_CLOUD_MAIN_SUCCESS",payload:{cardNumbers:i,tableAnalytics:u,graphAnalytics:{...c,postCountsByMonth:l.data.dailyPostCounts}}})}catch(l){console.error(l),a({type:"FETCH_MEDIA_CLOUD_MAIN_FAILURE",payload:l.message})}};n.useEffect(()=>{F()},[g]),n.useEffect(()=>{(async()=>{a({type:"FETCH_MEDIA_CLOUD_MAIN_START"});try{const m=await C.post(`${_.dashboard}/publication-frequency`,{date:f});console.log("result",m),m.status===200&&a({type:"FETCH_MEDIA_CLOUD_MAIN_SUCCESS",payload:{cardNumbers:i,tableAnalytics:u,graphAnalytics:{...c,publicationFrequency:m.data}}})}catch(m){console.error(m),a({type:"FETCH_MEDIA_CLOUD_MAIN_FAILURE",payload:m.message})}})()},[f]),n.useEffect(()=>(k.on("geographicalDistribution",l=>{a({type:"FETCH_MEDIA_CLOUD_MAIN_SUCCESS",payload:{cardNumbers:i,tableAnalytics:u,graphAnalytics:{...c,geographicalDistribution:l}}})}),()=>{k.off("geographicalDistribution")}),[a,i,u,c]);const H=[{title:"Total Sources",value:(i==null?void 0:i.totalSources)??0},{title:"Total Articles",value:(i==null?void 0:i.totalArticles)??0},{title:"Total Countries",value:(i==null?void 0:i.totalCountries)??0},{title:"Total Categories",value:(i==null?void 0:i.totalCategories)??0}];return e.jsxs("div",{className:"grid grid-cols-12 gap-5 p-2",children:[H.map((l,m)=>e.jsx("div",{"data-name":"feature_mediaCloud_main_number_analytics",className:"col-span-12 sm:col-span-6 lg:col-span-3",children:e.jsx(Z,{title:l.title,subTitle:l.subTitle,value:l.value,percentage:l.percentage})},m)),e.jsx("div",{"data-name":"feature_mediaCloud_main_last5MonthsPostCounts",className:"col-span-12 md:col-span-12",children:e.jsx(Q,{postCountSelectedMonth:g,setPostCountSelectedMonth:T,postCountData:c==null?void 0:c.postCountsByMonth,Title:"Post Counts"})}),e.jsx("div",{"data-name":"feature_mediaCloud_main_publicationFrequency",className:"col-span-12 md:col-span-6",children:e.jsx(te,{publicationFrequencySelectedDate:f,setPublicationFrequencySelectedDate:L,publicationFrequency:c==null?void 0:c.publicationFrequency})}),e.jsx("div",{"data-name":"feature_mediaCloud_main_heatMap",className:"col-span-12 md:col-span-6",children:e.jsx(ae,{geographicalDistribution:c==null?void 0:c.geographicalDistribution})}),e.jsx("div",{"data-name":"feature_mediaCloud_main_top5Sources",className:"col-span-12 lg:col-span-6",children:e.jsx(se,{title:"Top 5 Sources",data:u==null?void 0:u.top5Sources,columns:["Domain name","Total Posts"]})}),e.jsx("div",{"data-name":"feature_mediaCloud_main_top5Articles",className:"col-span-12 lg:col-span-6",children:e.jsx(re,{title:"Top 5 Articles",data:u==null?void 0:u.top5Articles,columns:["Title","Source","Date"]})})]})}export{me as default};
