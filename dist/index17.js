import{j as e,C as M,V as B,v as E,w as F,L as H,x as O,y as R,z as V,A as D,D as u,r as s,u as T,K as I}from"./index.js";import{V as Z,a as K}from"./axios.js";import{S as Y}from"./SingleSelectDropdown.js";import{R as W}from"./index35.js";import{d as $}from"./dayjs.min.js";import{t as q}from"./toastr.js";import{M as U}from"./MuiDialog.js";import{B as G}from"./index3.js";import"./chartjs-adapter-moment.esm.js";import{D as J}from"./Datepicker.js";import{g as Q}from"./index41.js";import"./index34.js";import"./DialogTitle.js";import"./useTheme.js";import"./Backdrop.js";import"./Modal.js";import"./resolveComponentProps.js";import"./useSlotProps.js";import"./Paper.js";import"./moment.js";import"./popover.js";import"./floating-ui.dom.js";import"./tslib.es6.js";function X({loading:t,selectedProject:c,historyData:a,setProjectAnalytics:n,setIsModalOpen:r}){return e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-xs rounded-xl relative mt-3",children:[e.jsx("header",{className:"px-5 py-4",children:e.jsxs("h2",{className:"font-semibold text-slate-700 dark:text-slate-100",children:["Total ",e.jsx("span",{className:"text-slate-400 dark:text-slate-500 font-medium",children:a==null?void 0:a.length})]})}),e.jsx("div",{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full dark:text-gray-300",children:[e.jsx("thead",{className:"text-xs font-semibold uppercase text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-900/20 border-t border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Date"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Max Results"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Keywords Count"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Topics Count"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Actions"})})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-slate-200 dark:divide-slate-700",children:t?e.jsx("tr",{children:e.jsx("td",{colSpan:"100%",style:{textAlign:"center",padding:"22px"},children:e.jsx(M,{})})}):a.length>0?a.map(l=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-medium text-sky-500",children:$(l.createdAt).format("MMMM D, YYYY")})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-100",children:l.maxResults})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-100",children:l.keywordMatches.length})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-100",children:l.topicOccurrences.length})}),e.jsx("td",{"data-name":"feature_videoBuzz_fetchHistory_viewDetails",className:"px-2 first:pl-5 last:pr-5 py-1 whitespace-nowrap w-px",children:e.jsx("div",{className:"space-x-1",children:e.jsx(B,{className:"text-violet-500",onClick:()=>{n(l),r(!0)},children:"Analytics"})})})]},l.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"100%",className:"text-slate-700 dark:text-slate-100",style:{textAlign:"center",padding:"22px"},children:e.jsx("em",{children:c?"No data available":"Select any project"})})})})]})})})]})}E.register(F,H,O,R,V,D);const k=({graphData:t})=>{const c=t==null?void 0:t.labels,a=t==null?void 0:t.data,n={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"}},scales:{x:{grid:{display:!1},title:{display:!0,text:new Date().toLocaleString("default",{month:"long"})},ticks:{color:u().theme.colors.gray[700],autoSkip:!1}},y:{grid:{display:!1},title:{display:!0,text:"Counts"},ticks:{beginAtZero:!0,color:u().theme.colors.gray[700]}}}},r={labels:c,datasets:[{barPercentage:.5,categoryPercentage:.5,label:"Count",data:a,backgroundColor:u().theme.colors.violet[500],hoverBackgroundColor:u().theme.colors.violet[600],borderRadius:4}]};return e.jsx("div",{className:"w-full mx-auto",style:{height:"300px"},children:e.jsx(G,{options:n,data:r})})};function L({projectAnalytics:t}){const[c,a]=s.useState({}),[n,r]=s.useState({});return s.useEffect(()=>{if(!t)return;const{keywordMatches:l,topicOccurrences:d}=t;a({labels:l.map(o=>o.keyword),data:l.map(o=>o.count)}),r({labels:d.map(o=>o.topic),data:d.map(o=>o.count)})},[t]),e.jsxs("div",{className:"p-3 bg-white dark:bg-gray-800 overflow-auto dark:text-slate-300 flex flex-col items-center justify-center min-h-screen",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("h3",{className:"text-md text-slate-700 dark:text-slate-100 font-semibold text-center",children:"Keyword Matches"}),e.jsx(k,{graphData:c})]}),e.jsxs("div",{className:"w-full mt-6",children:[e.jsx("h3",{className:"text-md text-slate-700 dark:text-slate-100 font-semibold text-center",children:"Topic Occurrences"}),e.jsx(k,{graphData:n})]})]})}function ee({projectsList:t,setCheckRendered:c}){var w;const[a,n]=s.useState(),[r,l]=s.useState(),[d,o]=s.useState(),[h,f]=s.useState([]),[m,p]=s.useState(1),[x,j]=s.useState(20),[g,S]=s.useState(0),[P,v]=s.useState(null),[_,b]=s.useState(!1),[z,y]=s.useState(!1);s.useEffect(()=>{var i;(t==null?void 0:t.length)>0&&n((i=t==null?void 0:t[0])==null?void 0:i.value)},[t]);const A=async()=>{if(a)try{y(!0);const i={pageSize:x,page:m,date_from:r,date_to:d},N=await Z.post(`${K.history}/${a}`,i),C=N.data.pagination.total;f([...N.data.data]),S(Math.ceil(C/x)),y(!1),c(!0)}catch(i){console.error("Error fetching project fetch history:",i),q.error("Error Occurred","Failed to fetch project history"),y(!1)}};return s.useEffect(()=>{A()},[a,m,x,r,d]),e.jsxs("div",{className:"grow",children:[e.jsxs("div",{className:"p-6 p-space-y-6 ",children:[e.jsxs("div",{className:"grid grid-cols-2",children:[e.jsx("div",{"data-name":"feature_videoBuzz_fetchHistory_dropDownFilter",children:e.jsx(Y,{label:"Select Project",options:t,selectedValue:a,onSelect:i=>{n(i)},clearable:!1})}),e.jsx("div",{"data-name":"feature_videoBuzz_fetchHistory_dateFilter",className:"ml-auto flex items-center",children:e.jsx(J,{initialDate:{from:r,to:d},setFrom:l,setTo:o})})]}),e.jsx(X,{loading:z,selectedProject:a,historyData:[...h],setProjectAnalytics:v,setIsModalOpen:b}),e.jsx("div",{className:"mt-8",children:e.jsx(W,{current:m,total:g,onPageChange:p})})]}),e.jsx(U,{id:"HistoryAnalytics-1234",open:_,setOpen:i=>{v(null),b(i)},title:`${(w=t.find(i=>i.value===a))==null?void 0:w.label}`,fullWidth:!0,maxWidth:"md",paperOverflow:!0,children:e.jsx(L,{projectAnalytics:P})})]})}const ke=()=>{const t=T(),c=t==null?void 0:t.userPermissions,a="module_videoBuzz",n="submodule_videoBuzz_fetchhistory",r=s.useMemo(()=>I(c,a,n),[c]),[l,d]=s.useState(!1),[o,h]=s.useState([]);return s.useEffect(()=>{(async()=>{const m=await Q();h(m)})()},[]),s.useEffect(()=>{requestAnimationFrame(()=>{document.querySelectorAll("[data-name]").forEach(p=>{const x=p.getAttribute("data-name"),j=r.find(g=>g.id===x);j&&(j.enable||p.remove())})})},[r,l]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-6 p-space-y-6",children:[e.jsx("div",{className:"mb-8",children:e.jsx("h1",{className:"text-2xl md:text-3xl text-slate-700 dark:text-slate-100 font-bold",children:"Video Buzz Fetch Historyâœ¨"})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl mb-8",children:e.jsx("div",{className:"flex flex-col md:flex-row md:-mr-px",children:e.jsx(ee,{projectsList:o,setCheckRendered:d})})})]})})};export{ke as default};
