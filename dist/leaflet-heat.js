(function(){function t(i){return this instanceof t?(this._canvas=i=typeof i=="string"?document.getElementById(i):i,this._ctx=i.getContext("2d"),this._width=i.width,this._height=i.height,this._max=1,void this.clear()):new t(i)}t.prototype={defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},data:function(i,s){return this._data=i,this},max:function(i){return this._max=i,this},add:function(i){return this._data.push(i),this},clear:function(){return this._data=[],this},radius:function(i,s){s=s||15;var a=this._circle=document.createElement("canvas"),e=a.getContext("2d"),n=this._r=i+s;return a.width=a.height=2*n,e.shadowOffsetX=e.shadowOffsetY=200,e.shadowBlur=s,e.shadowColor="black",e.beginPath(),e.arc(n-200,n-200,i,0,2*Math.PI,!0),e.closePath(),e.fill(),this},gradient:function(i){var s=document.createElement("canvas"),a=s.getContext("2d"),e=a.createLinearGradient(0,0,0,256);s.width=1,s.height=256;for(var n in i)e.addColorStop(n,i[n]);return a.fillStyle=e,a.fillRect(0,0,1,256),this._grad=a.getImageData(0,0,1,256).data,this},draw:function(i){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var s=this._ctx;s.clearRect(0,0,this._width,this._height);for(var a,e=0,n=this._data.length;n>e;e++)a=this._data[e],s.globalAlpha=Math.max(a[2]/this._max,i||.05),s.drawImage(this._circle,a[0]-this._r,a[1]-this._r);var o=s.getImageData(0,0,this._width,this._height);return this._colorize(o.data,this._grad),s.putImageData(o,0,0),this},_colorize:function(i,s){for(var a,e=3,n=i.length;n>e;e+=4)a=4*i[e],a&&(i[e-3]=s[a],i[e-2]=s[a+1],i[e-1]=s[a+2])}},window.simpleheat=t})(),L.HeatLayer=(L.Layer?L.Layer:L.Class).extend({initialize:function(t,i){this._latlngs=t,L.setOptions(this,i)},setLatLngs:function(t){return this._latlngs=t,this.redraw()},addLatLng:function(t){return this._latlngs.push(t),this.redraw()},setOptions:function(t){return L.setOptions(this,t),this._heat&&this._updateOptions(),this.redraw()},redraw:function(){return!this._heat||this._frame||this._map._animating||(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(t){this._map=t,this._canvas||this._initCanvas(),t._panes.overlayPane.appendChild(this._canvas),t.on("moveend",this._reset,this),t.options.zoomAnimation&&L.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._canvas),t.off("moveend",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},_initCanvas:function(){var t=this._canvas=L.DomUtil.create("canvas","leaflet-heatmap-layer leaflet-layer"),i=L.DomUtil.testProp(["transformOrigin","WebkitTransformOrigin","msTransformOrigin"]);t.style[i]="50% 50%";var s=this._map.getSize();t.width=s.x,t.height=s.y;var a=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(t,"leaflet-zoom-"+(a?"animated":"hide")),this._heat=simpleheat(t),this._updateOptions()},_updateOptions:function(){this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur),this.options.gradient&&this._heat.gradient(this.options.gradient),this.options.max&&this._heat.max(this.options.max)},_reset:function(){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,t);var i=this._map.getSize();this._heat._width!==i.x&&(this._canvas.width=this._heat._width=i.x),this._heat._height!==i.y&&(this._canvas.height=this._heat._height=i.y),this._redraw()},_redraw:function(){var t,i,s,a,e,n,o,l,r,m=[],d=this._heat._r,u=this._map.getSize(),f=new L.Bounds(L.point([-d,-d]),u.add([d,d])),g=this.options.max===void 0?1:this.options.max,p=this.options.maxZoom===void 0?this._map.getMaxZoom():this.options.maxZoom,v=1/Math.pow(2,Math.max(0,Math.min(p-this._map.getZoom(),12))),_=d/2,h=[],c=this._map._getMapPanePos(),w=c.x%_,y=c.y%_;for(t=0,i=this._latlngs.length;i>t;t++)if(s=this._map.latLngToContainerPoint(this._latlngs[t]),f.contains(s)){e=Math.floor((s.x-w)/_)+2,n=Math.floor((s.y-y)/_)+2;var x=this._latlngs[t].alt!==void 0?this._latlngs[t].alt:this._latlngs[t][2]!==void 0?+this._latlngs[t][2]:1;r=x*v,h[n]=h[n]||[],a=h[n][e],a?(a[0]=(a[0]*a[2]+s.x*r)/(a[2]+r),a[1]=(a[1]*a[2]+s.y*r)/(a[2]+r),a[2]+=r):h[n][e]=[s.x,s.y,r]}for(t=0,i=h.length;i>t;t++)if(h[t])for(o=0,l=h[t].length;l>o;o++)a=h[t][o],a&&m.push([Math.round(a[0]),Math.round(a[1]),Math.min(a[2],g)]);this._heat.data(m).draw(this.options.minOpacity),this._frame=null},_animateZoom:function(t){var i=this._map.getZoomScale(t.zoom),s=this._map._getCenterOffset(t.center)._multiplyBy(-i).subtract(this._map._getMapPanePos());L.DomUtil.setTransform?L.DomUtil.setTransform(this._canvas,s,i):this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(s)+" scale("+i+")"}}),L.heatLayer=function(t,i){return new L.HeatLayer(t,i)};
