import{j as e,r as s,W as E,X as D,C as L,u as T,K as _}from"./index.js";import{D as q}from"./DropdownEditMenu.js";import{t as S}from"./toastr.js";import{S as H}from"./SingleSelectDropdown.js";import{D as V,a as W,b as Y,c as B}from"./DialogTitle.js";import{d as O}from"./dayjs.min.js";import{R as $}from"./index35.js";import"./createSvgIcon2.js";import"./createSvgIcon.js";import"./resolveComponentProps.js";import"./IconButton.js";import"./Menu.js";import"./Modal.js";import"./Backdrop.js";import"./useTheme.js";import"./useSlotProps.js";import"./Paper.js";import"./Grow.js";import"./index34.js";function K({setIsModalOpen:i,setSelectedSchedule:c,data:a}){return e.jsx(q,{align:"right",children:e.jsx("li",{children:e.jsx("button",{"data-name":"feature_mediaCloud_cronJobs_editSchedule",className:"font-medium text-sm text-slate-600 dark:text-slate-300 hover:text-slate-700 dark:hover:text-slate-200 flex py-1 px-3",onClick:()=>{c(a),i(!0)},children:"Edit Schedule"})})})}const M=[{label:"Every Minute",value:"* * * * *"},{label:"Every 5 Minutes",value:"*/5 * * * *"},{label:"Every 15 Minutes",value:"*/15 * * * *"},{label:"Every 30 Minutes",value:"*/30 * * * *"},{label:"Every Hour",value:"0 * * * *"},{label:"Every 2 Hours",value:"0 */2 * * *"},{label:"Every 6 Hours",value:"0 */6 * * *"},{label:"Every 12 Hours",value:"0 */12 * * *"},{label:"Daily at Midnight",value:"0 0 * * *"},{label:"Daily at Noon",value:"0 12 * * *"},{label:"Weekly on Sunday at Midnight",value:"0 0 * * 0"},{label:"Weekly on Monday at 9 AM",value:"0 9 * * 1"},{label:"Monthly on the 1st at Midnight",value:"0 0 1 * *"},{label:"Monthly on the 15th at 3 PM",value:"0 15 15 * *"},{label:"Yearly on January 1st at Midnight",value:"0 0 1 1 *"},{label:"Every Weekday at 9 AM",value:"0 9 * * 1-5"},{label:"Every Saturday at Noon",value:"0 12 * * 6"},{label:"Every 10 Seconds (non-standard)",value:"*/10 * * * * *"}];function X({open:i,setOpen:c,data:a,reloadData:p}){const[l,m]=s.useState(null),[y,o]=s.useState(!1);s.useEffect(()=>{if(a!=null&&a.schedule){const n=M.find(d=>d.value===a.schedule.value);m(n||null)}},[a,i]);const u=()=>{c(!1),m(null)},f=async()=>{var n,d;if(!l){S.error("Please select a frequency.");return}try{o(!0);const x={label:l.label,value:l.value};(await E.put(`${D.cronJobs}/update/${a._id}`,x)).status===200&&(S.success("Cron Job updated successfully"),u(),p&&p(),o(!1))}catch(x){S.error(((d=(n=x.response)==null?void 0:n.data)==null?void 0:d.message)||"Failed to update cron job"),o(!1)}};return e.jsx(V,{fullWidth:!0,open:i,onClose:u,maxWidth:"sm",sx:{"& .MuiDialogContent-root":{height:"50vh",overflowY:"auto"},"& .MuiDialog-paper":{borderRadius:"10px"}},children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl overflow-auto dark:text-slate-300",children:[e.jsx(W,{className:"sticky top-0 px-5 py-4 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700/60 z-10",children:e.jsx("h3",{className:"text-xl md:text-xl text-slate-700 dark:text-slate-100 font-bold",children:"Edit Cron Schedule"})}),e.jsx(Y,{children:e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block mb-1",children:"Frequency"}),e.jsx(H,{options:M,labelNValue:!0,selectedValue:l==null?void 0:l.value,onSelect:m,label:"Select Frequency",buttonClassName:"border rounded",clearable:!1})]})}),e.jsxs(B,{className:"sticky bottom-0 px-5 py-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700/60 z-10",children:[e.jsx("button",{className:"btn bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700/60 hover:border-gray-300 dark:hover:border-gray-600 text-gray-800 dark:text-gray-300",onClick:u,children:"Cancel"}),e.jsxs("button",{onClick:f,className:"btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white disabled:border-gray-200 dark:disabled:border-gray-700 disabled:bg-white dark:disabled:bg-gray-800 disabled:text-gray-300 dark:disabled:text-gray-600 disabled:cursor-not-allowed",disabled:y,children:[y&&e.jsx("svg",{className:"animate-spin fill-current shrink-0",width:"16",height:"16",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M8 16a7.928 7.928 0 01-3.428-.77l.857-1.807A6.006 6.006 0 0014 8c0-3.309-2.691-6-6-6a6.006 6.006 0 00-5.422 8.572l-1.806.859A7.929 7.929 0 010 8c0-4.411 3.589-8 8-8s8 3.589 8 8-3.589 8-8 8z"})}),"Save Changes"]})]})]})})}function G({setCheckListRendered:i,selectedItems:c,data:a,total:p,reloadData:l,sortFilter:m,setConfig:y,loading:o}){const[u,f]=s.useState(!1),[n,d]=s.useState([]),[x,h]=s.useState(!1),[b,k]=s.useState(null);return s.useEffect(()=>{f(!1),d([])},[a]),s.useEffect(()=>{c(n)},[n]),e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-xs rounded-xl relative",children:[e.jsx("header",{className:"px-5 py-4",children:e.jsxs("h2",{className:"font-semibold text-slate-700 dark:text-slate-100",children:["All Cron Jobs"," ",e.jsx("span",{className:"text-slate-400 dark:text-slate-500 font-medium",children:p})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full dark:text-gray-300",children:[e.jsx("thead",{className:"text-xs font-semibold uppercase text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-900/20 border-t border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Name"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Last Run"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Schedule"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Timezone"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Status"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("span",{className:"sr-only",children:"Menu"})})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-slate-200 dark:divide-slate-700",children:o?e.jsx("tr",{children:e.jsx("td",{colSpan:"100%",style:{textAlign:"center",padding:"22px"},children:e.jsx(L,{})})}):a.map(t=>{var v;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:t==null?void 0:t.name})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:t!=null&&t.lastRun?O(t==null?void 0:t.lastRun).format("DD MMM YYYY HH:mm"):""})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:(v=t==null?void 0:t.schedule)==null?void 0:v.label})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:t==null?void 0:t.timezone})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left font-medium text-sky-500",children:t==null?void 0:t.status})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx(K,{setIsModalOpen:h,setSelectedSchedule:k,data:t,reloadData:l})})]},t==null?void 0:t._id)})})]})}),e.jsx(X,{open:x,setOpen:h,data:b,reloadData:l})]})}function ye(){const i=T(),c=i==null?void 0:i.userPermissions,a="module_mediaCloud",p="submodule_mediaCloud_cronJobs",l=s.useMemo(()=>_(c,a,p),[c]),[m,y]=s.useState(!1);s.useEffect(()=>{requestAnimationFrame(()=>{document.querySelectorAll("[data-name]").forEach(w=>{const P=w.getAttribute("data-name"),C=l.find(I=>I.id===P);C&&(C.enable||w.remove())})})},[l,m]);const[o,u]=s.useState(!1),[f,n]=s.useState([]),[d,x]=s.useState(10),[h,b]=s.useState(1),[k,t]=s.useState(0),[v,A]=s.useState(0),[N,R]=s.useState(""),[Q,z]=s.useState([]),[U,F]=s.useState(!1),J=r=>{z([...r])},j=async()=>{u(!0);try{const r={pageSize:d,page:h,searchValue:N},g=await E.post(`${D.cronJobs}/getAll`,r);if(g.status===200){const w=g.data.total;A(Math.ceil(w/d)),t(g.data.total),n(g.data.cronJobs)}u(!1)}catch(r){console.error(r),u(!1)}};return s.useEffect(()=>{b(1)},[N]),s.useEffect(()=>{const r=setTimeout(()=>{o||j()},100);return()=>clearTimeout(r)},[N,h]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-6 p-space-y-6",children:[e.jsxs("div",{className:"sm:flex sm:justify-between sm:items-center mb-8",children:[e.jsx("div",{className:"mb-4 sm:mb-0",children:e.jsx("h1",{className:"text-2xl md:text-3xl text-slate-700 dark:text-slate-100 font-bold",children:"Media Buzz Cron Job âœ¨"})}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"action-search",className:"sr-only",children:"Search"}),e.jsx("input",{id:"action-search",className:"form-input pl-9 bg-white dark:bg-slate-800",type:"search",placeholder:"Search Crons",value:N,onChange:r=>{R(r.target.value)}}),e.jsx("button",{className:"absolute inset-0 right-auto group",type:"submit","aria-label":"Search",children:e.jsxs("svg",{className:"w-4 h-4 shrink-0 fill-current text-slate-400 dark:text-slate-500 group-hover:text-slate-500 dark:group-hover:text-slate-400 ml-3 mr-2",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M7 14c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7zM7 2C4.243 2 2 4.243 2 7s2.243 5 5 5 5-2.243 5-5-2.243-5-5-5z"}),e.jsx("path",{d:"M15.707 14.293L13.314 11.9a8.019 8.019 0 01-1.414 1.414l2.393 2.393a.997.997 0 001.414 0 .999.999 0 000-1.414z"})]})})]})]}),e.jsx(G,{selectedItems:J,data:f,total:k,reloadData:j,setCheckListRendered:F,loading:o}),e.jsx("div",{className:"mt-8",children:e.jsx($,{current:h,total:v,onPageChange:b})})]})})}export{ye as default};
