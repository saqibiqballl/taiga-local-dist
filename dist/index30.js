import{j as e,J as X,r as t,C as F,M as fe,v as W,w as ee,L as se,P as je,G as ye,y as te,z as H,A as q,D as $,x as ve,E as we,u as Ne,K as ke}from"./index.js";import{W as D}from"./connection2.js";import{a as _}from"./apiBaseEndPoints.js";import{t as Y}from"./toastr.js";import{D as Se}from"./DropdownEditMenu.js";import{D as Ce}from"./DeleteModal.js";import{s as De,a as Me,T as _e,r as Pe}from"./index28.js";import{d as C}from"./dayjs.min.js";import{R as T}from"./index35.js";import{S as ae}from"./SingleSelectDropdown.js";import{D as E,a as U,b as le,c as Ye}from"./DialogTitle.js";import{L as ze,B as Ae,P as Le}from"./index3.js";import{D as re}from"./Datepicker.js";import{G as O}from"./Grid.js";import{B as Oe}from"./ButtonLoader.js";import"./createSvgIcon2.js";import"./createSvgIcon.js";import"./resolveComponentProps.js";import"./IconButton.js";import"./Menu.js";import"./Modal.js";import"./Backdrop.js";import"./useTheme.js";import"./useSlotProps.js";import"./Paper.js";import"./Grow.js";import"./Tabs.js";import"./KeyboardArrowRight.js";import"./socket.js";import"./Tooltip.js";import"./Divider.js";import"./index34.js";import"./popover.js";import"./floating-ui.dom.js";import"./tslib.es6.js";function Je({selectedItems:s,handleDeleteCrons:o}){return e.jsx("div",{"data-name":"feature_webshotBuzz_cronJob_deleteJob",className:`${s.length<1&&"hidden"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"hidden xl:block text-sm italic mr-2 whitespace-nowrap",children:[e.jsx("span",{children:s.length})," items selected"]}),e.jsx("button",{className:"btn bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 hover:border-slate-300 dark:hover:border-slate-600 text-rose-500",onClick:()=>{o()},children:"Delete"})]})})}const oe=async s=>{var o;try{return(await D.delete(_.cronJob+"/delete",{data:{cronIds:s}})).data}catch(a){(o=a==null?void 0:a.response)!=null&&o.data&&Y.error(a.response.data.message)}};function $e({setOpenCronModal:s,setDataToEdit:o,setCheckRendered:a,data:l,reloadData:n}){const h=X(),[c,i]=t.useState(!1),d=async()=>{const u=await oe([l._id]);u&&u.message&&(Y.success(u.message),setTimeout(()=>{n()},100))};return e.jsxs(e.Fragment,{children:[e.jsxs(Se,{align:"right",children:[e.jsx("li",{children:e.jsx("button",{"data-name":"feature_webshotBuzz_cronJob_editJob",className:"font-medium text-sm text-slate-600 dark:text-slate-300 hover:text-slate-700 dark:hover:text-slate-200 flex py-1 px-3",onClick:u=>{s(!0);const x=new Set,b=new Set;l.captureOptions.urls.forEach(r=>{r.collection_id===void 0?x.add(r.source_id):b.add(r.collection_id)});const v=Array.from(x),w=Array.from(b);h(De(v)),h(Me(w)),o(l)},children:"Edit"})}),e.jsx("li",{children:e.jsx("button",{"data-name":"feature_webshotBuzz_cronJob_deleteJob",className:"font-medium text-sm text-rose-500 hover:text-rose-600 flex py-1 px-3",onClick:()=>i(!0),children:"Delete"})})]}),e.jsx(Ce,{isOpen:c,onClose:()=>i(!1),onConfirm:d,title:"Delete Cron",description:`Are you sure you want to delete ${l.name}`,confirmText:"Delete",cancelText:"Cancel"})]})}function Be({setCheckRendered:s,selectedItems:o,setOpenCronModal:a,setDataToEdit:l,data:n,total:h,reloadData:c,loading:i}){const[d,u]=t.useState(!1),[x,b]=t.useState([]);t.useEffect(()=>{u(!1),b([])},[n]);const v=()=>{u(!d),b(n.map(r=>`${r._id}`)),d&&b([])},w=r=>{const{id:N,checked:m}=r.target;u(!1),b([...x,N]),m||b(x.filter(j=>j!==N))};return t.useEffect(()=>{o(x)},[x]),e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-xs rounded-xl relative",children:[e.jsx("header",{className:"px-5 py-4",children:e.jsxs("h2",{className:"font-semibold text-slate-700 dark:text-slate-100",children:["Crons"," ",e.jsx("span",{className:"text-slate-400 dark:text-slate-500 font-medium",children:h})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full dark:text-gray-300",children:[e.jsx("thead",{className:"text-xs font-semibold uppercase text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-900/20 border-t border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap w-px",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"inline-flex",children:[e.jsx("span",{className:"sr-only",children:"Select all"}),e.jsx("input",{className:"w-4 h-4 text-violet-600 bg-gray-100 border-gray-300 rounded focus:ring-violet-500 dark:focus:ring-violet-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-slate-300",type:"checkbox",checked:d,onChange:v})]})})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Name"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Frequency"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Last Run"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("span",{className:"sr-only",children:"Menu"})})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-slate-200 dark:divide-slate-700",children:i?e.jsx("tr",{children:e.jsx("td",{colSpan:"100%",style:{textAlign:"center",padding:"22px"},children:e.jsx(F,{})})}):n==null?void 0:n.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap w-px",children:e.jsx("div",{className:"flex items-center",children:e.jsx("label",{className:"inline-flex",children:e.jsx("input",{id:r._id,className:"w-4 h-4 text-violet-600 bg-gray-100 border-gray-300 rounded focus:ring-violet-500 dark:focus:ring-violet-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-slate-300",type:"checkbox",onChange:w,checked:x.includes(`${r._id}`)})})})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:`${r==null?void 0:r.name}`})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:`${r==null?void 0:r.frequency.label}`})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:r.lastRun?new C(r.lastRun).format("DD MMM YYYY HH:mm"):""})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap w-px",children:e.jsx($e,{setCheckRendered:s,setOpenCronModal:a,setDataToEdit:l,data:r,reloadData:c})})]},r._id))})]})})]})}const Ve=[{label:"Every Minute",value:"* * * * *"},{label:"Every 5 Minutes",value:"*/5 * * * *"},{label:"Every 15 Minutes",value:"*/15 * * * *"},{label:"Every 30 Minutes",value:"*/30 * * * *"},{label:"Every Hour",value:"0 * * * *"},{label:"Every 2 Hours",value:"0 */2 * * *"},{label:"Every 6 Hours",value:"0 */6 * * *"},{label:"Every 12 Hours",value:"0 */12 * * *"},{label:"Daily at Midnight",value:"0 0 * * *"},{label:"Daily at Noon",value:"0 12 * * *"},{label:"Weekly on Sunday at Midnight",value:"0 0 * * 0"},{label:"Weekly on Monday at 9 AM",value:"0 9 * * 1"},{label:"Monthly on the 1st at Midnight",value:"0 0 1 * *"},{label:"Monthly on the 15th at 3 PM",value:"0 15 15 * *"},{label:"Yearly on January 1st at Midnight",value:"0 0 1 1 *"},{label:"Every Weekday at 9 AM",value:"0 9 * * 1-5"},{label:"Every Saturday at Noon",value:"0 12 * * 6"},{label:"Every 10 Seconds (non-standard)",value:"*/10 * * * * *"}];function Ie({open:s,setOpen:o,setDataToEdit:a,dataToEdit:l,reloadData:n}){const h=X(),{choosedSources:c,choosedCollections:i}=fe(m=>m.webShotBuzz.cronJobReducer),[d,u]=t.useState(!1),[x,b]=t.useState(),[v,w]=t.useState(),r=()=>{o(!1),b(),a(),h(Pe())};t.useEffect(()=>{var m,j;l&&b({label:(m=l==null?void 0:l.frequency)==null?void 0:m.label,value:(j=l==null?void 0:l.frequency)==null?void 0:j.time})},[l]);const N=async()=>{try{const m=c.length===0&&i.length===0;if(x||Y.error("Please select Frequency and select at least one source or collection."),m&&Y.error("Please select at least one source or collection."),!m){u(!0);const j={frequency:{label:x.label,time:x.value},captureOptions:v};if(l){const y=await D.put(`${_.cronJob}/update/${l._id}`,j);y.data.status===200&&(Y.success(y.data.message),r(),n(),u(!1))}else{const y=await D.post(`${_.cronJob}/create`,j);y.data.status===200&&(Y.success(y.data.message),r(),n(),u(!1))}}}catch{Y.error("Internal Error"),u(!1)}};return e.jsx(E,{fullWidth:!0,open:s,onClose:r,maxWidth:"lg",sx:{"& .MuiDialog-paper":{borderRadius:"10px"}},children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 overflow-auto dark:text-slate-300",children:[e.jsx(U,{className:"sticky top-0 px-5 py-4 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700/60 z-10",children:e.jsx("h3",{className:"text-xl md:text-xl text-slate-700 dark:text-slate-100 font-bold",children:l!=null&&l._id?"Update Cron":"Set New Cron"})}),e.jsxs(le,{fullWidth:!0,children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"mb-4",children:"Frequency"}),e.jsx(ae,{options:Ve,labelNValue:!0,selectedValue:x==null?void 0:x.value,onSelect:m=>{b(m)},label:"Choose Frequency",buttonClassName:"border rounded"})]}),e.jsx(_e,{setCaptureOptions:w,fromCronJob:!0,dataToEdit:l})]}),e.jsxs(Ye,{className:"sticky bottom-0 px-5 py-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700/60",children:[e.jsx("button",{className:"btn bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700/60 hover:border-gray-300 dark:hover:border-gray-600 text-gray-800 dark:text-gray-300",onClick:m=>{m.preventDefault(),m.stopPropagation(),r()},children:e.jsx("span",{className:"hidden xs:block ",children:"Cancel"})}),e.jsxs("button",{onClick:N,className:"btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white disabled:border-gray-200 dark:disabled:border-gray-700 disabled:bg-white dark:disabled:bg-gray-800 disabled:text-gray-300 dark:disabled:text-gray-600 disabled:cursor-not-allowed",disabled:d,children:[d&&e.jsx("svg",{className:"animate-spin fill-current shrink-0",width:"16",height:"16",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M8 16a7.928 7.928 0 01-3.428-.77l.857-1.807A6.006 6.006 0 0014 8c0-3.309-2.691-6-6-6a6.006 6.006 0 00-5.422 8.572l-1.806.859A7.929 7.929 0 010 8c0-4.411 3.589-8 8-8s8 3.589 8 8-3.589 8-8 8z"})}),l!=null&&l._id?"Update":"Save"]})]})]})})}function Re({data:s,loading:o}){return e.jsx("div",{className:"bg-white dark:bg-gray-800 shadow-xs rounded-xl relative",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full dark:text-gray-300",children:[e.jsx("thead",{className:"text-xs font-semibold uppercase text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-900/20 border-t border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Original URL"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Screenshot URL"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Status"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Screenshot Details"})})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-slate-200 dark:divide-slate-700",children:o?e.jsx("tr",{children:e.jsx("td",{colSpan:"100%",style:{textAlign:"center",padding:"22px"},children:e.jsx(F,{})})}):s.map((a,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:a.original_url})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:e.jsx("a",{href:a.screenshot_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 underline",children:"View Screenshot"})})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:a.success?"Success":"Failed"})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Width:"})," ",a.screenshot_details.width]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Height:"})," ",a.screenshot_details.height]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Full Size:"})," ",a.screenshot_details.full_size?"Yes":"No"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Dark Mode:"})," ",a.screenshot_details.darkmode?"Yes":"No"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Scale:"})," ",a.screenshot_details.scale]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Format:"})," ",a.screenshot_details.format]}),a.screenshot_details.script&&e.jsxs("li",{children:[e.jsx("strong",{children:"Script:"})," ",a.screenshot_details.script]}),a.screenshot_details.css&&e.jsxs("li",{children:[e.jsx("strong",{children:"CSS:"})," ",a.screenshot_details.css]})]})})})]},l))})]})})})}const Ee=({from:s,to:o})=>{const[a,l]=t.useState([]),[n,h]=t.useState(1),[c,i]=t.useState(2),[d,u]=t.useState(0),[x,b]=t.useState(0),[v,w]=t.useState(!1),r=async()=>{try{w(!0);const N=await D.post(`${_.cronJob}/overview-table-data`,{page:n,limit:c,from:s,to:o}),{data:m,totalRecords:j,totalPages:y}=N.data;l(m),u(j),b(y),w(!1)}catch(N){console.error("Error fetching logs:",N),w(!1)}};return t.useEffect(()=>{r()},[n,c,s,o]),e.jsx("div",{className:"container pt-2 bg-white dark:bg-gray-800 overflow-auto dark:text-slate-300",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-12",children:e.jsx(Re,{data:a,loading:v})}),e.jsx("div",{className:"mt-8",children:e.jsx(T,{current:n,total:x,onPageChange:h})})]})})};W.register(ee,se,je,ye,te,H,q);const Fe=({data:s,width:o})=>{var h,c;const a=[$().theme.colors.violet[500],"rgba(255, 99, 132, 1)"],l={labels:s==null?void 0:s.labels,datasets:[{label:"Successful",data:(h=s==null?void 0:s.datasets)==null?void 0:h.successfulData,borderColor:a[0],fill:!1},{label:"Failed",data:(c=s==null?void 0:s.datasets)==null?void 0:c.failedData,borderColor:a[1],fill:!1}]},n={responsive:!0,plugins:{legend:{position:"top"},tooltip:{callbacks:{label:function(i){return`${i.dataset.label}: ${i.raw} Captures`}}}},scales:{x:{grid:{display:!1},title:{display:!0,text:"Date"},ticks:{maxRotation:45,minRotation:45}},y:{grid:{display:!1},title:{display:!0,text:"Captures"},beginAtZero:!0}}};return e.jsx("div",{className:"p-4",style:{width:o},children:e.jsx(ze,{data:l,options:n})})};W.register(ee,se,ve,te,H,q);const We=({allCaptures:s,height:o,width:a})=>{var c,i;const l=[$().theme.colors.violet[500],"rgba(255, 99, 132, 1)"],n={labels:s==null?void 0:s.labels,datasets:[{barPercentage:.5,categoryPercentage:.5,label:"Successful",data:(c=s==null?void 0:s.datasets)==null?void 0:c.successfulData,backgroundColor:l[0],borderRadius:4},{barPercentage:.5,categoryPercentage:.5,label:"Failed",data:(i=s==null?void 0:s.datasets)==null?void 0:i.failedData,backgroundColor:l[1],borderRadius:4}]},h={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},tooltip:{callbacks:{title:d=>s.labels[d[0].dataIndex]}}},scales:{x:{grid:{display:!1},ticks:{color:$().theme.colors.gray[700],autoSkip:!1}},y:{grid:{display:!1},title:{display:!0,text:"Captures"},ticks:{beginAtZero:!0,color:$().theme.colors.gray[700]}}}};return e.jsx("div",{className:"p-4",style:{height:o,width:a},children:e.jsx(Ae,{data:n,options:h})})};W.register(we,H,q);const He=({successFailureRatio:s,height:o,width:a})=>{const l=[$().theme.colors.violet[500],"rgba(255, 99, 132, 1)"],n={labels:s==null?void 0:s.labels,datasets:[{...s,data:s==null?void 0:s.datasets,backgroundColor:l,hoverBackgroundColor:l.map(c=>`${c}`),borderWidth:0}]},h={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top"},tooltip:{enabled:c=>{var d;return((d=c[0])==null?void 0:d.raw)!==0},callbacks:{label:function(c){const i=c.label,d=c.raw;return`${i}: ${d}`}}}}};return e.jsx("div",{className:"p-4",style:{height:o,width:a},children:e.jsx(Le,{data:n,options:h})})},qe=()=>{const s=new Date,o=s.getFullYear(),a=String(s.getMonth()+1).padStart(2,"0");return`${o}-${a}`},Te=()=>{const[s,o]=t.useState(qe()),[a,l]=t.useState(),[n,h]=t.useState(!1),c=async()=>{try{h(!0);const i=await D.post(`${_.cronJob}/overview-graphs`,{date:s});l(i.data.graphs)}catch(i){console.error("Error fetching graphs:",i),h(!1)}};return t.useEffect(()=>{c()},[s]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end items-center",children:e.jsx("div",{className:"w-36 mt-2",children:e.jsx("input",{type:"month",id:"monthPicker",name:"monthPicker",value:s,onChange:i=>{console.log("e.target.value",i.target.value),o(i.target.value)},className:"w-full border border-gray-300 rounded-md px-3 py-2 text-sm shadow-sm focus:outline-none focus:ring focus:ring-blue-200"})})}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"mb-4 sm:mb-0",children:e.jsx("h3",{className:"text-md text-slate-700 dark:text-slate-100 font-bold",children:"Success/Failure Ratio"})}),e.jsx("div",{className:"w-full flex justify-center items-center",children:e.jsx(He,{successFailureRatio:a==null?void 0:a.successFailureRatio,height:300,width:800})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"mb-4 sm:mb-0",children:e.jsx("h3",{className:"text-md text-slate-700 dark:text-slate-100 font-bold",children:"Success and Failure Captures"})}),e.jsx("div",{className:"w-full flex justify-center items-center",children:e.jsx(Fe,{data:a==null?void 0:a.lineChartData,height:300,width:800})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"mb-4 sm:mb-0",children:e.jsx("h3",{className:"text-md text-slate-700 dark:text-slate-100 font-bold",children:"All Captures"})}),e.jsx("div",{className:"w-full flex justify-center items-center",children:e.jsx(We,{allCaptures:a==null?void 0:a.allCaptures,height:300,width:800})})]})]})},Ue=({from:s,setFrom:o,to:a,setTo:l,screenshotStats:n})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 overflow-auto dark:text-slate-300",children:[e.jsx(U,{className:"sticky top-0 px-5 py-4 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700/60 z-10",children:e.jsxs("h3",{className:"text-xl md:text-xl text-slate-700 dark:text-slate-100 font-bold",children:["Overview",e.jsx("div",{"data-name":"",className:"ml-auto gap-2 flex items-center float-right",children:e.jsx(re,{initialDate:{from:s,to:a},setFrom:o,setTo:l})})]})}),e.jsxs(le,{children:[e.jsxs(O,{"data-name":"feature_mediaCloud_sourcesView_sourceInfo",container:!0,spacing:2,children:[e.jsx(O,{item:!0,md:3,children:e.jsx("div",{className:"col-span-full xl:col-span-6 2xl:col-span-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700",children:e.jsx("div",{className:"flex flex-col h-full p-5",children:e.jsxs("div",{className:"grow",children:[e.jsx("header",{className:"flex items-center mb-4",children:e.jsx("h3",{className:"text-md text-slate-700 dark:text-slate-100 font-semibold",children:"Total ScreenShots"})}),e.jsx("div",{className:"text-sm",children:n.totalScreenshots})]})})})}),e.jsx(O,{item:!0,md:3,children:e.jsx("div",{className:"col-span-full xl:col-span-6 2xl:col-span-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700",children:e.jsx("div",{className:"flex flex-col h-full p-5",children:e.jsxs("div",{className:"grow",children:[e.jsx("header",{className:"flex items-center mb-4",children:e.jsx("h3",{className:"text-md text-slate-700 dark:text-slate-100 font-semibold",children:"Successful Captures"})}),e.jsx("div",{className:"text-sm",children:n.successfulCaptures})]})})})}),e.jsx(O,{item:!0,md:3,children:e.jsx("div",{className:"col-span-full xl:col-span-6 2xl:col-span-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700",children:e.jsx("div",{className:"flex flex-col h-full p-5",children:e.jsxs("div",{className:"grow",children:[e.jsx("header",{className:"flex items-center mb-4",children:e.jsx("h3",{className:"text-md text-slate-700 dark:text-slate-100 font-semibold",children:"Failed Captures"})}),e.jsx("div",{className:"text-sm",children:n.failedCaptures})]})})})}),e.jsx(O,{item:!0,md:3,children:e.jsx("div",{className:"col-span-full xl:col-span-6 2xl:col-span-4 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700",children:e.jsx("div",{className:"flex flex-col h-full p-5",children:e.jsxs("div",{className:"grow",children:[e.jsx("header",{className:"flex items-center mb-4",children:e.jsx("h3",{className:"text-md text-slate-700 dark:text-slate-100 font-semibold",children:"Success Rate"})}),e.jsx("div",{className:"text-sm",children:n.successRate})]})})})})]}),e.jsx(O,{children:e.jsx(Ee,{from:s,to:a})}),e.jsx(Te,{})]})]})}),Ze=Ue;function Ke({handleSelectedItems:s,sourcesDropDownOptions:o,selectedSource:a,setSelectedSource:l,data:n,total:h,from:c,to:i,setFrom:d,setTo:u,totalRecords:x,loading:b}){const[v,w]=t.useState(!1),[r,N]=t.useState([]),[m,j]=t.useState(!1);t.useEffect(()=>{w(!1),N([])},[n]),t.useEffect(()=>{s(r)},[r]);const y=async()=>{j(!0);try{const g=await D.post(`${_.cronJob}/detailed-logs-csv`,{domain_name:a==null?void 0:a.label,from:c,to:i});A(g.data.logs),j(!1)}catch{j(!1)}},z=g=>{if(g.length===0)return"";const S=Object.keys(g[0]).join(",")+`
`,L=g.map(M=>Object.values(M).map(k=>C(k).isValid()?`"${C(k).format("MMM-DD-YYYY hh:mm A")}"`:typeof k=="string"&&k.includes(",")?`"${k}"`:k).join(",")).join(`
`);return S+L},A=g=>{const S=z(g),L=new Blob([S],{type:"text/csv"}),M=URL.createObjectURL(L),f=document.createElement("a");f.href=M,f.download="data.csv",document.body.appendChild(f),f.click(),document.body.removeChild(f)};return e.jsxs("div",{className:"bg-white dark:bg-gray-800 overflow-auto dark:text-slate-300",children:[e.jsx(U,{className:"sticky top-0 px-5 py-4 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700/60 z-10",children:e.jsxs("h3",{className:"text-xl md:text-xl text-slate-700 dark:text-slate-100 font-bold",children:["Detailed Log Table   ",e.jsx("span",{className:"text-slate-400 dark:text-slate-500 font-medium",children:h}),e.jsxs("div",{"data-name":"",className:"ml-auto flex gap-2 items-center flex-nowrap whitespace-nowrap float-right",children:[e.jsx("div",{children:e.jsx(ae,{options:o,labelNValue:!0,selectedValue:a==null?void 0:a.value,onSelect:l,label:"Select source domain name",buttonClassName:"border rounded"})}),e.jsx(re,{initialDate:{from:c,to:i},setFrom:d,setTo:u}),e.jsx("button",{"data-name":"feature_webshotBuzz_cronJob_downloadCsv",className:"btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white",onClick:g=>{y()},disabled:m,children:m?e.jsx(Oe,{}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-4 h-4 fill-current opacity-50 shrink-0",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M8 0a1 1 0 0 1 1 1v8.586l2.707-2.707a1 1 0 0 1 1.414 1.414l-4 4a1 1 0 0 1-1.414 0l-4-4a1 1 0 0 1 1.414-1.414L7 9.586V1a1 1 0 0 1 1-1z"}),e.jsx("path",{d:"M2 13a1 1 0 0 0-1 1v1h14v-1a1 1 0 0 0-1-1H2z"})]}),e.jsx("span",{className:"hidden xs:block ml-2",children:"Download CSV"})]})})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full dark:text-gray-300",children:[e.jsx("thead",{className:"text-xs font-semibold uppercase text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-900/20 border-t border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Website Url"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Timestamp"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Status"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Error"})})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-slate-200 dark:divide-slate-700",children:b?e.jsx("tr",{children:e.jsx("td",{colSpan:"100%",style:{textAlign:"center",padding:"22px"},children:e.jsx(F,{})})}):n.map((g,S)=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:`${g.website_label}`})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:C(g.timestamp).format("MMM-DD-YYYY hh:mm A")})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:g.status})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"text-left",children:g.error_message})})]},S))})]})})]})}const Ge=()=>{const[s,o]=t.useState([]),[a,l]=t.useState([]),[n,h]=t.useState(1),[c,i]=t.useState(10),[d,u]=t.useState(0),[x,b]=t.useState(0),[v,w]=t.useState(()=>C().subtract(2,"month").startOf("month").format("YYYY-MM-DD")),[r,N]=t.useState(()=>C().endOf("month").format("YYYY-MM-DD")),[m,j]=t.useState([]),[y,z]=t.useState(),[A,g]=t.useState(!1),S=async()=>{try{const f=await D.get("/Source/getSources");f.status===200&&j(f.data.source.map(k=>({value:k._id,label:k.domain_name})))}catch(f){console.error("Error fetching sources:",f)}};t.useEffect(()=>{S()},[]);const L=async()=>{g(!0);const f=C(v).startOf("day").format("YYYY-MM-DDTHH:mm:ss.SSS[+00:00]"),k=C(r).endOf("day").format("YYYY-MM-DDTHH:mm:ss.SSS[+00:00]");try{const J=await D.post(`${_.cronJob}/detailed-logs`,{page:n,limit:c,domain_name:y==null?void 0:y.label,from:f,to:k}),{logs:B,totalRecords:V}=J.data;l(B),u(V),b(Math.ceil(V/c)),g(!1)}catch(J){console.error("Error fetching logs:",J),g(!1)}},M=f=>{o([...f])};return t.useEffect(()=>{L()},[n,c,v,r,y]),e.jsxs(e.Fragment,{children:[e.jsx(Ke,{handleSelectedItems:M,sourcesDropDownOptions:m,selectedSource:y,setSelectedSource:z,data:a,total:d,from:v,to:r,setFrom:w,setTo:N,totalRecords:x,loading:A}),e.jsx("div",{className:"mt-8",children:e.jsx(T,{current:n,total:x,onPageChange:h})})]})},Qe=Ge;function Ls(){const[s,o]=t.useState([]),[a,l]=t.useState({key:"total_feed",direction:"ascending"}),[n,h]=t.useState([]),[c,i]=t.useState(!1),[d,u]=t.useState(""),[x,b]=t.useState(5),[v,w]=t.useState(1),[r,N]=t.useState(0),[m,j]=t.useState(0),[y,z]=t.useState(!1),[A,g]=t.useState(()=>C().subtract(2,"month").startOf("month").format("YYYY-MM-DD")),[S,L]=t.useState(()=>C().endOf("month").format("YYYY-MM-DD")),M=Ne(),f=M==null?void 0:M.userPermissions,k="module_webshotBuzz",J="submodule_webshotBuzz_cronJob",B=t.useMemo(()=>ke(f,k,J),[f]),[V,ne]=t.useState(!1),[ce,Z]=t.useState(!1),[ie,K]=t.useState(!1),[de,G]=t.useState(),[he,xe]=t.useState({});t.useEffect(()=>{requestAnimationFrame(()=>{document.querySelectorAll("[data-name]").forEach(R=>{const ge=R.getAttribute("data-name"),Q=B.find(be=>be.id===ge);Q&&(Q.enable||R.remove())})})},[B,V]);const me=p=>{o([...p])};t.useEffect(()=>{const p=setTimeout(()=>{c||I()},100);return()=>clearTimeout(p)},[d,v]),t.useEffect(()=>{w(1)},[d]);const I=async()=>{i(!0);try{const p={pageSize:x,page:v,searchValue:d},P=await D.post(`${_.cronJob}/getCrons`,p);if(P.status===200){const R=P.data.pagination.totalItems;j(Math.ceil(R/x)),N(P.data.pagination.totalItems),h(P.data.data),o([])}i(!1)}catch(p){console.error(p),i(!1)}},pe=async()=>{const p=await oe(s);p&&p.message&&(o([]),Y.success(p.message),setTimeout(()=>{I()},100))},ue=async()=>{try{const p={from:A,to:S},P=await D.post(`${_.cronJob}/screenshot-stats`,p);P.status===200&&xe(P.data.stats)}catch(p){console.error(p)}};return t.useEffect(()=>{ue()},[A,S]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-6 p-space-y-6",children:[e.jsxs("div",{className:"sm:flex sm:justify-between sm:items-center mb-8",children:[e.jsx("div",{className:"mb-4 sm:mb-0",children:e.jsx("h1",{className:"text-2xl md:text-3xl text-slate-700 dark:text-slate-100 font-bold",children:"Cron Jobs ✨"})}),e.jsxs("div",{className:"grid grid-flow-col sm:auto-cols-max justify-start sm:justify-end gap-2",children:[e.jsx(Je,{selectedItems:s,handleDeleteCrons:pe}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"action-search",className:"sr-only",children:"Search"}),e.jsx("input",{id:"action-search",className:"form-input pl-9 bg-white dark:bg-slate-800",type:"search",placeholder:"Search...",value:d,onChange:p=>{u(p.target.value)}}),e.jsx("button",{className:"absolute inset-0 right-auto group",type:"submit","aria-label":"Search",children:e.jsxs("svg",{className:"w-4 h-4 shrink-0 fill-current text-slate-400 dark:text-slate-500 group-hover:text-slate-500 dark:group-hover:text-slate-400 ml-3 mr-2",viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M7 14c-3.86 0-7-3.14-7-7s3.14-7 7-7 7 3.14 7 7-3.14 7-7 7zM7 2C4.243 2 2 4.243 2 7s2.243 5 5 5 5-2.243 5-5-2.243-5-5-5z"}),e.jsx("path",{d:"M15.707 14.293L13.314 11.9a8.019 8.019 0 01-1.414 1.414l2.393 2.393a.997.997 0 001.414 0 .999.999 0 000-1.414z"})]})})]}),e.jsxs("button",{"data-name":"feature_webshotBuzz_cronJob_createJob",className:"btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white",onClick:p=>{z(!0)},children:[e.jsx("svg",{className:"w-4 h-4 fill-current opacity-50 shrink-0",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M15 7H9V1c0-.6-.4-1-1-1S7 .4 7 1v6H1c-.6 0-1 .4-1 1s.4 1 1 1h6v6c0 .6.4 1 1 1s1-.4 1-1V9h6c.6 0 1-.4 1-1s-.4-1-1-1z"})}),e.jsx("span",{className:"hidden xs:block ml-2",children:"Add Cron Job"})]})]})]}),e.jsx(Be,{setCheckRendered:ne,selectedItems:me,data:n,total:r,setOpenCronModal:z,setDataToEdit:G,reloadData:I,sortFilter:a,setConfig:p=>{l(p)},loading:c}),e.jsx("div",{className:"mt-8",children:e.jsx(T,{current:v,total:m,onPageChange:w})}),e.jsxs("div",{className:"float-right flex space-x-4",children:[e.jsx("button",{"data-name":"feature_webshotBuzz_cronJob_overview",disabled:c,className:"btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white",onClick:p=>{Z(!0)},children:e.jsx("span",{className:"hidden xs:block",children:"OverView"})}),e.jsx("button",{"data-name":"feature_webshotBuzz_cronJob_detailedLogs",disabled:c,className:"btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white",onClick:p=>{K(!0)},children:e.jsx("span",{className:"hidden xs:block",children:"Detailed Logs"})})]}),e.jsx(E,{fullWidth:!0,open:ce,onClose:()=>{Z(!1)},maxWidth:"lg",sx:{"& .MuiDialog-paper":{borderRadius:"10px"}},children:e.jsx(Ze,{from:A,to:S,setFrom:g,setTo:L,screenshotStats:he})}),e.jsx(E,{fullWidth:!0,open:ie,onClose:()=>{K(!1)},maxWidth:"lg",sx:{"& .MuiDialog-paper":{borderRadius:"10px"}},children:e.jsx(Qe,{})})]}),e.jsx(Ie,{open:y,setOpen:z,dataToEdit:de,setDataToEdit:G,reloadData:I})]})}export{Ls as default};
