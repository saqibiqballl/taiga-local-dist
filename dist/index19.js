import{j as e,d as I,r}from"./index.js";import{M as F}from"./MuiDialog.js";import{I as P}from"./index45.js";import{S as L}from"./secureFetch.js";import{n as O}from"./notify.js";import{b as B,d as w}from"./index44.js";const J={primary:"bg-violet-100 hover:bg-white border-[1.5px] border-violet-300 active:border-violet-400 ",secondary:"bg-slate-100 border-[1.5px] border-slate-300 hover:bg-slate-300 text-black ",transparent:"hover:bg-slate-200 rounded-xs underline	",outline:"border border-slate-400 hover:bg-slate-200 text-black ",theme:"bg-violet-800 text-slate-100 hover:bg-violet-500",none:""},W={sm:"py-0 px-4 gap-2",md:"py-1 px-4 gap-3",lg:"py-2 px-6 gap-4",xl:"py-4 px-9 gap-4",none:""},g=({children:s,className:a,variant:l="primary",size:i="lg",rounded:u=!1,...o})=>e.jsx("button",{type:"button",className:` flex items-center disabled:opacity-50 disabled:pointer-events-none focus-visible:ring focus-visible:outline-0 ring-offset-2 font-medium ${u?"rounded-full":"rounded-xs"}  ${J[l]} ${W[i]} ${a}`,...o,children:s}),U={headers:{Accept:"application/json","Content-Type":"application/json","api-key":"SOCIALRADAR_kNfOdiOXgYycGCH8KA"}};function V(s){const{dates:a,topic:l,page:i,sortBy:u,search:o}=s,c={page:i,sortBy:u,search:o};if(a){const{from:p,to:h}=a,f=new Date(p);f.setMinutes(f.getMinutes()+f.getTimezoneOffset());const x=new Date(h);x.setMinutes(x.getMinutes()+x.getTimezoneOffset()),x.setDate(x.getDate()+1),c.dates={from:f,to:x}}return l!=="all"&&(c.topic=l),c}async function Y(s,a){const l={...U,method:"POST",body:JSON.stringify(a)},i=await fetch(`${I}/api/resource/${s}`,l),{resources:u,lastPage:o}=await i.json();return u}async function q(s){const a={method:"POST",body:JSON.stringify(s)};alert("I am before post request");const l=await L.post(`${I}/api/resource`,a);if(l.status===200)var i=await l.json();else return null;return i}async function G(s){const a={...U,method:"DELETE",body:JSON.stringify(s)};return(await L.post(`${I}/api/resource`,a)).status===200}async function H(s,a={}){let l=V(a);return Y(s,l)}const K="_label_35vaj_1",b={label:K},k={website:"Website",video:"Video",pdf:"PDF",image:"Image"};let A;const X=({resource:s,onClose:a})=>{const l=Date.now(),i=Date.now(),[u,o]=r.useState(""),[c,p]=r.useState(""),[h,f]=r.useState(""),[x,j]=r.useState("website"),[v,t]=r.useState(""),[d,y]=r.useState(""),[N,S]=r.useState([]),[C,R]=r.useState("unloaded");r.useEffect(()=>(s&&(o(s.name),p(s.author),f(s.url),j(s.type),s.imageurl&&(t(s.imageurl),y(s.imageurl))),()=>{clearTimeout(A)}),[]);function D(n){o(n.target.value)}function E(n){p(n.target.value)}function M(n){f(n.target.value)}function _(n){t(n.target.value),R("unloaded"),clearTimeout(A),A=setTimeout(()=>{y(n.target.value)},1e3)}async function $(){try{alert("I am executed create new resoure model");var n=null,m={authoredAt:l,fetchedAt:i,author:c,name:u,url:h,type:x,topics:N};v&&(m={...m,imageurl:v}),n=await q(m),n?(O("Resource saved to database."),a(),o(""),p(""),f(""),j("website")):O("An error occurred. Pleas make sure resource has a Name, Author, and URL.")}catch(T){O("An error occurred."),console.log(T)}}function z(n){if(N.find(m=>m===w[n])){const m=N.filter(T=>T!==w[n]);S(m)}else{const m=[...N,w[n]];S(m)}}return e.jsxs("div",{className:` ${b.NewResource} flex flex-col gap-y-2 px-6`,children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(B,{adjust:"mr-7",header:"Type of Resource",onSelect:n=>j(n),options:k,active:x}),e.jsxs("div",{children:[e.jsxs("label",{className:b.label,children:[`${k[x]} `," URL"]}),e.jsx("input",{className:"py-1 px-2 w-full",type:"text",value:h,onChange:M,placeholder:"Type in a URL"})]}),e.jsx("hr",{className:"border-b border-slate-300 my-2"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("label",{className:b.label,children:"Title: "}),e.jsx("input",{className:"py-1 px-2 w-full",type:"text",value:u,onChange:D,placeholder:"title of resource"})]}),e.jsx("div",{className:"flex gap-x-2 w-full",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:b.label,children:"Author: "}),e.jsx("input",{className:"py-1 px-2 w-full",type:"text",value:c,onChange:E,placeholder:"Author"})]})})]}),e.jsxs("div",{className:"flex flex-col ",children:[e.jsx("div",{className:"bg-slate-100 border border-slate-300 rounded-xs w-full h-[10rem]",children:e.jsxs("div",{className:"flex justify-center items-center h-full",children:[e.jsx("img",{src:d,onLoad:()=>R("success"),className:C==="success"?"w-full h-full object-scale-down ":"invisible w-0 h-0 basis-0 ",onError:()=>d&&R("fail")}),C==="unloaded"&&e.jsx("p",{className:"text-sm",children:"Image Preview"}),C==="fail"&&e.jsx("p",{className:"text-sm",children:"Image failed to load"})]})}),x!=="image"&&e.jsxs("div",{children:[e.jsx("label",{className:b.label,children:"Image URL: "}),e.jsx("input",{className:"py-1 px-2 w-full",type:"text",value:v,onChange:_,placeholder:"Image URL"})]})]})]})]}),e.jsx("label",{className:b.label,children:"Topics:"}),e.jsx("ul",{className:"flex flex-wrap gap-x-2 gap-y-4",children:Object.keys(w).map((n,m)=>e.jsxs("li",{className:"flex items-center gap-x-2 px-4 py-2 rounded-full bg-slate-100 w-fit",children:[e.jsx("input",{type:"checkbox",onChange:()=>z(n)}),e.jsx("label",{className:"inline-block w-fit",children:w[n]})]},m))}),e.jsxs("div",{className:"flex justify-end gap-x-3",children:[e.jsx(g,{variant:"outline",className:"w-fit",onClick:a,children:"Cancel"}),e.jsx(g,{className:"w-fit",onClick:$,children:s?e.jsx(e.Fragment,{children:"Save Changes"}):e.jsxs(e.Fragment,{children:[e.jsx(P,{type:"plus"})," Create Resource"]})})]})]})},Q=({onEditOpen:s,setActiveResource:a})=>{const[l,i]=r.useState([]),[u,o]=r.useState("loading"),[c,p]=r.useState(0);r.useEffect(()=>{h(c)},[]),r.useEffect(()=>{h(c)},[c]);async function h(t){let d;o("loading");try{d=await H(t),d&&d.length>0?(i(d),o("success")):o("fail")}catch{o("fail")}}function f(t){a(t),s(!0)}function x(t){const d=[...l],y=l.findIndex(S=>S.url===t);d.splice(y,1),G({url:t}),i(d)}function j(t){t<0&&(t=0),p(t)}function v(t){try{return new URL(t).hostname}catch(d){console.log(d)}return t}return e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{})}),e.jsxs("div",{className:"bg-slate-200 rounded-xs w-full flex justify-between items-center px-3 py-3",children:[e.jsx("p",{}),e.jsxs("div",{className:"text-sm gap-x-2 flex ",children:[e.jsx(g,{onClick:()=>j(c-1),size:"md",children:"Prev Page"}),e.jsx("p",{className:"px-3 py-1 rounded-xs bg-slate-100",children:c+1}),e.jsx(g,{onClick:()=>j(c+1),size:"md",children:"Next Page"})]})]}),u==="success"?e.jsx("ul",{className:"flex-1 overflow-overlay hoverscroll divide-y divide-slate-300 font-medium",children:l&&l.map((t,d)=>e.jsxs("li",{className:"py-4 px-4  ",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("a",{href:t.url,className:"underline hover:text-violet-800",target:"_blank",rel:"noreferrer",children:e.jsx("p",{className:"",children:t.name})}),e.jsx("p",{className:"px-2 bg-slate-100 rounded-xs text-sm w-fit mb-3 text-slate-700",children:t.type})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex gap-x-2 text-sm items-center",children:[e.jsx("p",{className:"px-4 py-1 bg-slate-100 rounded-xs text-slate-700",children:t.author}),e.jsx("p",{className:"text-slate-600",children:v(t.url)})]}),e.jsxs("div",{className:"flex gap-x-2 text-sm",children:[e.jsx(g,{onClick:()=>f(t),size:"md",children:"Edit"}),e.jsx(g,{onClick:()=>x(t.url),size:"md",children:"Delete"})]})]})]},d))}):e.jsx("div",{className:"flex-1 flex justify-center items-center",children:u==="loading"?"Loading...":"failed to load resources"})]})},Z=()=>{const[s,a]=r.useState(!1),[l,i]=r.useState(null);function u(){i(null),a(!0)}function o(){i(null),a(!1)}return e.jsxs("div",{className:"grow",children:[e.jsxs("div",{className:"p-6 p-space-y-6 ",children:[e.jsx("h2",{className:"text-2xl text-slate-700 dark:text-slate-100 font-bold mb-6",children:"Select Fetch Settings"}),e.jsxs("div",{className:" items-center",children:[e.jsx("h2",{className:"text-lg font-medium text-slate-700 mb-2",children:"Manage Resources"}),e.jsxs(g,{onClick:u,size:"md",className:"w-fit mb-6",children:[e.jsx(P,{type:"plus"}),"Add A New Resource"]})]}),e.jsx(Q,{onEditOpen:a,setActiveResource:i}),e.jsx(F,{open:s,setOpen:a,title:l?"Edit Resource":"Create New Resource",paperOverflow:!0,fullWidth:!0,maxWidth:"md",children:e.jsx(X,{onClose:o,resource:l})})]}),e.jsx("footer",{children:e.jsx("div",{className:"flex flex-col px-6 py-5 border-t border-slate-200 dark:border-slate-700",children:e.jsx("div",{className:"flex self-end",children:e.jsx("button",{onClick:c=>{c.preventDefault(),startFetching()},className:"btn bg-violet-500 hover:bg-violet-600 text-slate-300 ml-3",children:"Start Fetching"})})})})]})},ie=Object.freeze(Object.defineProperty({__proto__:null,default:Z},Symbol.toStringTag,{value:"Module"}));export{g as B,Z as R,ie as i};
