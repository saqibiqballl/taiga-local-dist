import{r as s,u as A,j as e,aB as le,B as O,d as ie,K as ne}from"./index.js";import{F as de}from"./index47.js";import{S as ce}from"./secureFetch.js";import{t as N}from"./toastr.js";import"./iconify.js";import{C as T}from"./CustomGraph.js";import{M as oe}from"./MuiDialog.js";import{P as me}from"./index43.js";import{d as xe}from"./dayjs.min.js";import{B as he}from"./Banner.js";import{G as D}from"./Grid.js";import"./index3.js";import"./DialogTitle.js";import"./useTheme.js";import"./Backdrop.js";import"./Modal.js";import"./resolveComponentProps.js";import"./useSlotProps.js";import"./Paper.js";import"./index46.js";import"./index34.js";import"./index39.js";import"./index45.js";function ue(t){var x;const[d,i]=s.useState(!1),m=s.useRef(null),c=s.useRef(null);return A(),s.useEffect(()=>{const n=({target:o})=>{c.current&&(!d||c.current.contains(o)||m.current.contains(o)||i(!1))};return document.addEventListener("click",n),()=>document.removeEventListener("click",n)}),s.useEffect(()=>{},[t==null?void 0:t.options]),s.useEffect(()=>{const n=({keyCode:o})=>{!d||o!==27||i(!1)};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)}),e.jsxs("div",{className:"relative inline-flex",children:[e.jsxs("button",{ref:m,className:"btn justify-between min-w-44 bg-white dark:bg-slate-800 border-slate-200 dark:border-slate-700 hover:border-slate-300 dark:hover:border-slate-600 text-slate-500 hover:text-slate-600 dark:text-slate-300 dark:hover:text-slate-200","aria-label":"Select date range","aria-haspopup":"true",onClick:()=>i(!d),"aria-expanded":d,children:[e.jsx("span",{className:"flex items-center",children:e.jsx("span",{children:(x=t==null?void 0:t.options[t==null?void 0:t.selected])==null?void 0:x.name})}),e.jsx("svg",{className:"shrink-0 ml-1 fill-current text-slate-400",width:"11",height:"7",viewBox:"0 0 11 7",children:e.jsx("path",{d:"M5.4 6.8L0 1.4 1.4 0l4 4 4-4 1.4 1.4z"})})]}),e.jsx(le,{show:d,tag:"div",className:"z-10 absolute top-full left-0 bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 py-1.5 rounded shadow-lg overflow-hidden mt-1",enter:"transition ease-out duration-100 transform",enterStart:"opacity-0 -translate-y-2",enterEnd:"opacity-100 translate-y-0",leave:"transition ease-out duration-100",leaveStart:"opacity-100",leaveEnd:"opacity-0",children:e.jsx("div",{ref:c,className:"font-medium text-sm text-slate-600 dark:text-slate-300 min-w-44",onFocus:()=>i(!0),onBlur:()=>i(!1),children:t==null?void 0:t.options.map((n,o)=>e.jsxs("button",{tabIndex:"0",className:`flex items-center w-full hover:bg-slate-50 hover:dark:bg-slate-700/20 py-1 px-3 cursor-pointer ${o===(t==null?void 0:t.selected)&&"text-violet-500"}`,onClick:()=>{t==null||t.setSelected(o),i(!1)},children:[e.jsx("svg",{className:`shrink-0 mr-2 fill-current text-violet-500 ${o!==(t==null?void 0:t.selected)&&"invisible"}`,width:"12",height:"9",viewBox:"0 0 12 9",children:e.jsx("path",{d:"M10.28.28L3.989 6.575 1.695 4.28A1 1 0 00.28 5.695l3 3a1 1 0 001.414 0l7-7A1 1 0 0010.28.28z"})}),e.jsx("span",{children:n==null?void 0:n.name})]},o))})})]})}const fe=t=>(s.useEffect(()=>{(async()=>{for(let i=0;i<=95;i+=5)await new Promise(m=>setTimeout(m,300)),t==null||t.setProgress(i)})()},[]),e.jsxs("div",{className:"mt-5",children:[e.jsx("h2",{children:"Task Progress"}),e.jsx("div",{style:{width:"300px",border:"1px solid #ccc",borderRadius:"5px",overflow:"hidden"},children:e.jsx("div",{style:{width:`${t==null?void 0:t.progress}%`,height:"30px",backgroundColor:"#4CAF50",color:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},children:`${t==null?void 0:t.progress}%`})})]}));function ge(t){const d=i=>{switch(i){case"Paid":return"text-emerald-500";case"Due":return"text-amber-500";case"Overdue":return"text-rose-500";default:return"text-slate-500"}};return e.jsxs("tr",{children:[e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap w-px",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"inline-flex",children:[e.jsx("span",{className:"sr-only",children:"Select"}),e.jsx("input",{id:t.id,className:"w-4 h-4 text-violet-600 bg-gray-100 border-gray-300 rounded focus:ring-violet-500 dark:focus:ring-violet-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-slate-300",type:"checkbox",onChange:t.handleClick,checked:t.isChecked})]})})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-medium text-sky-500",children:t.date})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-100",children:t.author})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-100",children:t.content.split(" ").slice(0,3).join(" ")+(t.content.split(" ").length>3?"...":"")})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:`font-medium ${d(t.status)}`,children:t.keywordcounts})}),e.jsx("td",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-medium text-slate-700 dark:text-slate-100",children:t.topiccounts})})]})}function be({fetchedPostsData:t,selectedItems:d}){const[i,m]=s.useState(!1),[c,x]=s.useState([]),[n,o]=s.useState([]),[h,f]=s.useState(!1);s.useEffect(()=>{o(t)},[t]);const w=()=>{m(!i),x(n.map(r=>r.id)),i&&x([])},g=r=>{const{id:j,checked:p}=r.target;m(!1),x([...c,j]),p||x(c.filter(y=>y!==j))};return s.useEffect(()=>{d(c)},[c]),e.jsxs("div",{className:"bg-white dark:bg-gray-800 shadow-xs rounded-xl relative mt-3 scrollbar-thin",children:[e.jsxs("header",{className:"px-5 py-4 flex justify-between",children:[e.jsxs("h2",{className:"font-semibold text-slate-700 dark:text-slate-100",children:["Total ",e.jsx("span",{className:"text-slate-400 dark:text-slate-500 font-medium",children:t==null?void 0:t.length})]}),!h&&e.jsx("button",{className:"btn bg-violet-500 hover:bg-violet-600 text-slate-300",onClick:()=>{f(!0)},children:"Display Posts"}),h&&e.jsxs("button",{onClick:()=>{f(!1)},type:"button",className:"w-full flex items-center justify-center w-1/2 px-5 py-2 text-sm text-slate-700 transition-colors duration-200 bg-white border rounded-xl gap-x-2 sm:w-auto dark:hover:bg-gray-800 dark:bg-gray-900 hover:bg-gray-100 dark:text-slate-200 dark:border-gray-700",children:[e.jsx("svg",{className:"w-5 h-5 rtl:rotate-180",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",children:e.jsx("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6.75 15.75L3 12m0 0l3.75-3.75M3 12h18"})}),e.jsx("span",{children:"Go back"})]})]}),h?e.jsx("div",{className:"w-96 flex flex-col gap-3 p-5",style:{minWidth:"35rem"},children:n==null?void 0:n.map(r=>e.jsx(me,{data:r},r._id))}):e.jsx("div",{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"table-auto w-full dark:text-gray-300",children:[e.jsx("thead",{className:"text-xs font-semibold uppercase text-slate-500 dark:text-slate-400 bg-slate-50 dark:bg-slate-900/20 border-t border-b border-slate-200 dark:border-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap w-px",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("label",{className:"inline-flex",children:[e.jsx("span",{className:"sr-only",children:"Select all"}),e.jsx("input",{className:"w-4 h-4 text-violet-600 bg-gray-100 border-gray-300 rounded focus:ring-violet-500 dark:focus:ring-violet-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-slate-300",type:"checkbox",checked:i,onChange:w})]})})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Date"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Auther"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Content"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Keywords Count"})}),e.jsx("th",{className:"px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap",children:e.jsx("div",{className:"font-semibold text-left",children:"Topics Count"})})]})}),e.jsx("tbody",{className:"text-sm divide-y divide-slate-200 dark:divide-slate-700",children:n.map(r=>e.jsx(ge,{id:r.raw.post.id,keywordcounts:r.keywords.length,topiccounts:r.topics.length,author:r==null?void 0:r.author,content:r.content,platformID:r==null?void 0:r.platformID,date:xe(r.authoredAt).format("MMMM D, YYYY"),handleClick:g,isChecked:c.includes(r.raw.post.id)},r.raw.post.id))})]})})})]})}function we(){const[t,d]=s.useState(0),[i,m]=s.useState(0),[c,x]=s.useState([]),[n,o]=s.useState(!1),[h,f]=s.useState(!1),[w,g]=s.useState(0),[r,j]=s.useState([]),[p,y]=s.useState(!1),[je,B]=s.useState([]),[S,I]=s.useState(!1),[G,$]=s.useState([]),[H,z]=s.useState([]),[F,K]=s.useState(!1),[Y,U]=s.useState([]),[V,W]=s.useState([]),[q,C]=s.useState(0),[J,_]=s.useState(!1),[Q,X]=s.useState(""),a=new Date,[v,Z]=s.useState([{name:"1 day ago",start_time:new Date(a).setDate(a.getDate()),end_time:new Date(a).setDate(a.getDate()-1)},{name:"2 days ago",start_time:new Date(a).setDate(a.getDate()-1),end_time:new Date(a).setDate(a.getDate()-2)},{name:"3 days ago",start_time:new Date(a).setDate(a.getDate()-2),end_time:new Date(a).setDate(a.getDate()-3)},{name:"4 days ago",start_time:new Date(a).setDate(a.getDate()-3),end_time:new Date(a).setDate(a.getDate()-4)},{name:"5 days ago",start_time:new Date(a).setDate(a.getDate()-4),end_time:new Date(a).setDate(a.getDate()-5)},{name:"6 days ago",start_time:new Date(a).setDate(a.getDate()-5),end_time:new Date(a).setDate(a.getDate()-6)},{name:"7 days ago",start_time:new Date(a).setDate(a.getDate()-5),end_time:new Date(a).setDate(a.getDate()-6)}]),ee=b=>{B([...b])},te=async()=>{var P,L,R,E,M;let b=`${ie}/api/fetch/fetchdata`;h&&(b+=`?retweet=${h}`);try{o(!0);const l=await ce.post(b,{...c[t],start_time:v[i].start_time,end_time:v[i].end_time});if(l.error)N.error(`Error: ${l.error}`);else if(l.data){j(l.result.posts),N.success("Tweet fetched and saved Successfully");const k=(P=l==null?void 0:l.result)==null?void 0:P.keywordcounts.map(u=>Object.keys(u)[0]),se=(L=l==null?void 0:l.result)==null?void 0:L.keywordcounts.map(u=>u[Object.keys(u)[0]]);$(k),z(se),I(!0);const ae=(R=l==null?void 0:l.result)==null?void 0:R.topiccounts.map(u=>Object.keys(u)[0]),re=(E=l==null?void 0:l.result)==null?void 0:E.topiccounts.map(u=>u[Object.keys(u)[0]]);g((M=l==null?void 0:l.result)==null?void 0:M.twitterApiLimit.remainingLimit),U(ae),W(re),K(!0),C(100)}else N.error(`Unexpected Response: ${JSON.stringify(l)}`)}catch(l){const k=l.response.data.error;g(k.rateLimit.remaining),X(k.data.detail??l.message),_(!0)}finally{o(!1)}};return e.jsx(O,{className:"grow",children:e.jsxs(O,{className:"p-6 p-space-y-6 ",children:[e.jsx(he,{type:"error",open:J,setOpen:_,children:Q}),e.jsxs("div",{className:"grid grid-cols-12 gap-6",children:[e.jsxs("div",{className:"col-span-6",children:[e.jsx("h5",{className:"text-sm text-slate-700 dark:text-slate-100 font-bold mb-2",children:"Select Fetch Settings"}),e.jsx(de,{selected:t,setSelected:d,options:c,setOptions:x})]}),e.jsx("div",{className:"col-span-6 flex justify-end text-right",children:e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-100 font-bold mb-2",children:["Remaining Fetch Limit: ",w]})}),e.jsxs("div",{className:"col-span-12",children:[e.jsx("h5",{className:"text-sm text-slate-700 dark:text-slate-100 font-bold mb-2",children:"Select Past Time"}),e.jsx(ue,{selected:i,setSelected:m,options:v,setOptions:Z})]}),e.jsxs("div",{className:"col-span-12",children:[e.jsx("h5",{className:"text-sm text-slate-700 dark:text-slate-100 font-bold mb-2",children:"Retweets"}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-3",children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-violet-600 bg-gray-100 border-gray-300 rounded focus:ring-violet-500 dark:focus:ring-violet-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-slate-300",checked:h,onChange:()=>f(!h)}),e.jsx("span",{className:"text-sm text-slate-700 dark:text-slate-100 font-bold",children:"Enable Retweets"})]})})]})]}),n&&e.jsx(fe,{progress:q,setProgress:C}),S&&e.jsx(T,{title:"Keywords Graph",labels:G,hits:H}),F&&e.jsx(T,{title:"Topics Graph",labels:Y,hits:V}),e.jsx("footer",{className:"mt-5",children:e.jsxs(D,{container:!0,justifyContent:"space-between",children:[e.jsx(D,{"data-name":"feature_socialRadar_vewFetchPosts",item:!0,xs:6,children:S&&F&&e.jsx("button",{className:"btn bg-violet-500 hover:bg-violet-600 text-slate-300 ml-3",onClick:()=>{y(!0)},children:"View Fetch Posts"})}),e.jsx(D,{"data-name":"feature_socialRadar_startFetching",item:!0,xs:6,style:{textAlign:"right"},children:e.jsxs("button",{onClick:b=>{b.preventDefault(),te()},className:"btn bg-gray-900 text-gray-100 hover:bg-gray-800 dark:bg-gray-100 dark:text-gray-800 dark:hover:bg-white disabled:border-gray-200 dark:disabled:border-gray-700 disabled:bg-white dark:disabled:bg-gray-800 disabled:text-gray-300 dark:disabled:text-gray-600 disabled:cursor-not-allowed",disabled:n,children:[n&&e.jsx("svg",{className:"animate-spin fill-current shrink-0",width:"16",height:"16",viewBox:"0 0 16 16",children:e.jsx("path",{d:"M8 16a7.928 7.928 0 01-3.428-.77l.857-1.807A6.006 6.006 0 0014 8c0-3.309-2.691-6-6-6a6.006 6.006 0 00-5.422 8.572l-1.806.859A7.929 7.929 0 010 8c0-4.411 3.589-8 8-8s8 3.589 8 8-3.589 8-8 8z"})}),"Start Fetching"]})})]})}),p&&e.jsx(oe,{id:"FetchedPostsModal-1234",open:p,setOpen:()=>y(!1),title:"Fetched Posts",fullWidth:!0,maxWidth:"md",paperOverflow:!0,children:e.jsx(be,{fetchedPostsData:r,selectedItems:ee})})]})})}const ze=()=>{const t=A(),d=t==null?void 0:t.userPermissions,i="module_socialRadar",m="submodule_socialRadar_fetchPosts",c=s.useMemo(()=>ne(d,i,m),[d]),[x,n]=s.useState(!1);return s.useEffect(()=>{requestAnimationFrame(()=>{document.querySelectorAll("[data-name]").forEach(f=>{const w=f.getAttribute("data-name"),g=c.find(r=>r.id===w);g&&(g.enable||f.remove())})})},[c,x]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-6 p-space-y-6",children:[e.jsx("div",{className:"mb-8",children:e.jsx("h1",{className:"text-2xl md:text-3xl text-slate-700 dark:text-slate-100 font-bold",children:"Social Buzz Settings ✨"})}),e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-xl mb-8",children:e.jsx("div",{className:"flex flex-col md:flex-row md:-mr-px",children:e.jsx(we,{})})})]})})};export{ze as default};
